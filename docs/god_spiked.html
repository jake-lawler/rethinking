<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 God Spiked the Integers | Statistical Rethinking Notes</title>
  <meta name="description" content="My notes on Richard McElreath’s ‘Statistical Rethinking.’" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 God Spiked the Integers | Statistical Rethinking Notes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="My notes on Richard McElreath’s ‘Statistical Rethinking.’" />
  <meta name="github-repo" content="jake-lawler/rethinking" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 God Spiked the Integers | Statistical Rethinking Notes" />
  
  <meta name="twitter:description" content="My notes on Richard McElreath’s ‘Statistical Rethinking.’" />
  

<meta name="author" content="Jake Lawler" />


<meta name="date" content="2022-03-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="big_entropy.html"/>
<link rel="next" href="monsters_mixtures.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="prague.html"><a href="prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague</a>
<ul>
<li class="chapter" data-level="1.1" data-path="prague.html"><a href="prague.html#chapter-notes"><i class="fa fa-check"></i><b>1.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="1.2" data-path="prague.html"><a href="prague.html#questions"><i class="fa fa-check"></i><b>1.2</b> Questions</a></li>
<li class="chapter" data-level="" data-path="prague.html"><a href="prague.html#further-reading"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small_worlds.html"><a href="small_worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="small_worlds.html"><a href="small_worlds.html#chapter-notes-1"><i class="fa fa-check"></i><b>2.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="2.2" data-path="small_worlds.html"><a href="small_worlds.html#questions-1"><i class="fa fa-check"></i><b>2.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#e1"><i class="fa fa-check"></i>2E1</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#e2"><i class="fa fa-check"></i>2E2</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#e3"><i class="fa fa-check"></i>2E3</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#e4"><i class="fa fa-check"></i>2E4</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#m1"><i class="fa fa-check"></i>2M1</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#m2"><i class="fa fa-check"></i>2M2</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#m3"><i class="fa fa-check"></i>2M3</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#m4"><i class="fa fa-check"></i>2M4</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#m5"><i class="fa fa-check"></i>2M5</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#m6"><i class="fa fa-check"></i>2M6</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#m7"><i class="fa fa-check"></i>2M7</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#h1"><i class="fa fa-check"></i>2H1</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#h2"><i class="fa fa-check"></i>2H2</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#h3"><i class="fa fa-check"></i>2H3</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#h4"><i class="fa fa-check"></i>2H4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#further-reading-1"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#chapter-notes-2"><i class="fa fa-check"></i><b>3.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="3.2" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#questions-2"><i class="fa fa-check"></i><b>3.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#e1-1"><i class="fa fa-check"></i>3E1</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#e2-1"><i class="fa fa-check"></i>3E2</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#e3-1"><i class="fa fa-check"></i>3E3</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#e4-1"><i class="fa fa-check"></i>3E4</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#e5"><i class="fa fa-check"></i>3E5</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#e6"><i class="fa fa-check"></i>3E6</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#e7"><i class="fa fa-check"></i>3E7</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#m1-1"><i class="fa fa-check"></i>3M1</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#m2-1"><i class="fa fa-check"></i>3M2</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#m3-1"><i class="fa fa-check"></i>3M3</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#m4-1"><i class="fa fa-check"></i>3M4</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#m5-1"><i class="fa fa-check"></i>3M5</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#m6-1"><i class="fa fa-check"></i>3M6</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#h1-1"><i class="fa fa-check"></i>3H1</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#h2-1"><i class="fa fa-check"></i>3H2</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#h3-1"><i class="fa fa-check"></i>3H3</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#h4-1"><i class="fa fa-check"></i>3H4</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#h5"><i class="fa fa-check"></i>3H5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#further-reading-2"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric.html"><a href="geocentric.html"><i class="fa fa-check"></i><b>4</b> Geocentric Models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric.html"><a href="geocentric.html#chapter-notes-3"><i class="fa fa-check"></i><b>4.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="geocentric.html"><a href="geocentric.html#model-using-grid-approximation"><i class="fa fa-check"></i><b>4.1.1</b> Model Using Grid Approximation</a></li>
<li class="chapter" data-level="4.1.2" data-path="geocentric.html"><a href="geocentric.html#model-using-quadratic-approximation"><i class="fa fa-check"></i><b>4.1.2</b> Model Using Quadratic Approximation</a></li>
<li class="chapter" data-level="4.1.3" data-path="geocentric.html"><a href="geocentric.html#adding-predictors"><i class="fa fa-check"></i><b>4.1.3</b> Adding Predictors</a></li>
<li class="chapter" data-level="4.1.4" data-path="geocentric.html"><a href="geocentric.html#polynomial-regression"><i class="fa fa-check"></i><b>4.1.4</b> Polynomial Regression</a></li>
<li class="chapter" data-level="4.1.5" data-path="geocentric.html"><a href="geocentric.html#b-splines"><i class="fa fa-check"></i><b>4.1.5</b> B-Splines</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="geocentric.html"><a href="geocentric.html#questions-3"><i class="fa fa-check"></i><b>4.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#e1-2"><i class="fa fa-check"></i>4E1</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#e2-2"><i class="fa fa-check"></i>4E2</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#e3-2"><i class="fa fa-check"></i>4E3</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#e4-2"><i class="fa fa-check"></i>4E4</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#e5-1"><i class="fa fa-check"></i>4E5</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#m1-2"><i class="fa fa-check"></i>4M1</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#m2-2"><i class="fa fa-check"></i>4M2</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#m3-2"><i class="fa fa-check"></i>4M3</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#m4-2"><i class="fa fa-check"></i>4M4</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#m5-2"><i class="fa fa-check"></i>4M5</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#m6-2"><i class="fa fa-check"></i>4M6</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#m7-1"><i class="fa fa-check"></i>4M7</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#further-reading-3"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="many_variables.html"><a href="many_variables.html"><i class="fa fa-check"></i><b>5</b> The Many Variables &amp; The Spurious Waffles</a>
<ul>
<li class="chapter" data-level="5.1" data-path="many_variables.html"><a href="many_variables.html#chapter-notes-4"><i class="fa fa-check"></i><b>5.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="5.2" data-path="many_variables.html"><a href="many_variables.html#questions-4"><i class="fa fa-check"></i><b>5.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="many_variables.html"><a href="many_variables.html#e1-3"><i class="fa fa-check"></i>5E1</a></li>
<li class="chapter" data-level="" data-path="many_variables.html"><a href="many_variables.html#e2-3"><i class="fa fa-check"></i>5E2</a></li>
<li class="chapter" data-level="" data-path="many_variables.html"><a href="many_variables.html#e3-3"><i class="fa fa-check"></i>5E3</a></li>
<li class="chapter" data-level="" data-path="many_variables.html"><a href="many_variables.html#e4-3"><i class="fa fa-check"></i>5E4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="many_variables.html"><a href="many_variables.html#further-reading-4"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="haunted_dag.html"><a href="haunted_dag.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; The Causal Terror</a>
<ul>
<li class="chapter" data-level="6.1" data-path="haunted_dag.html"><a href="haunted_dag.html#chapter-notes-5"><i class="fa fa-check"></i><b>6.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#multicollinearity"><i class="fa fa-check"></i>Multicollinearity</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#post-treatment-bias"><i class="fa fa-check"></i>Post-Treatment Bias</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#collider-bias"><i class="fa fa-check"></i>Collider Bias</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="haunted_dag.html"><a href="haunted_dag.html#questions-5"><i class="fa fa-check"></i><b>6.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#e1-4"><i class="fa fa-check"></i>6E1</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#e3-4"><i class="fa fa-check"></i>6E3</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#e4-4"><i class="fa fa-check"></i>6E4</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#m1-3"><i class="fa fa-check"></i>6M1</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#m2-3"><i class="fa fa-check"></i>6M2</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#m3-3"><i class="fa fa-check"></i>6M3</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#h1-2"><i class="fa fa-check"></i>6H1</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#h2-2"><i class="fa fa-check"></i>6H2</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#h3-2"><i class="fa fa-check"></i>6H3</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#h4-2"><i class="fa fa-check"></i>6H4</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#h5-1"><i class="fa fa-check"></i>6H5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#further-reading-5"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses.html"><a href="ulysses.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ulysses.html"><a href="ulysses.html#chapter-notes-6"><i class="fa fa-check"></i><b>7.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#brain-volume-model"><i class="fa fa-check"></i>Brain Volume model</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#log-pointwise-predictive-density"><i class="fa fa-check"></i>Log Pointwise Predictive Density</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#simulating-in-and-out-of-sample-deviance-for-varying-parameter-numbers"><i class="fa fa-check"></i>Simulating in and out of sample deviance for varying parameter numbers</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#predicting-predicitve-accuracy"><i class="fa fa-check"></i>Predicting Predicitve Accuracy</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses.html"><a href="ulysses.html#questions-6"><i class="fa fa-check"></i><b>7.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#e1-5"><i class="fa fa-check"></i>7E1</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#e2-4"><i class="fa fa-check"></i>7E2</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#e3-5"><i class="fa fa-check"></i>7E3</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#e4-5"><i class="fa fa-check"></i>7E4</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#m1-4"><i class="fa fa-check"></i>7M1</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#m2-4"><i class="fa fa-check"></i>7M2</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#m3-4"><i class="fa fa-check"></i>7M3</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#m4-3"><i class="fa fa-check"></i>7M4</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#m5-3"><i class="fa fa-check"></i>7M5</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#m6-3"><i class="fa fa-check"></i>7M6</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#h1-3"><i class="fa fa-check"></i>7H1</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#h2-3"><i class="fa fa-check"></i>7H2</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#h3-3"><i class="fa fa-check"></i>7H3</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#h4-3"><i class="fa fa-check"></i>7H4</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#h5-2"><i class="fa fa-check"></i>7H5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#further-reading-6"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional.html"><a href="conditional.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a>
<ul>
<li class="chapter" data-level="8.1" data-path="conditional.html"><a href="conditional.html#chapter-notes-7"><i class="fa fa-check"></i><b>8.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="conditional.html"><a href="conditional.html#ruggedness-gdp-model"><i class="fa fa-check"></i>Ruggedness &amp; GDP Model</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional.html"><a href="conditional.html#questions-7"><i class="fa fa-check"></i><b>8.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="conditional.html"><a href="conditional.html#e1-6"><i class="fa fa-check"></i>8E1</a></li>
<li class="chapter" data-level="" data-path="conditional.html"><a href="conditional.html#e2-5"><i class="fa fa-check"></i>8E2</a></li>
<li class="chapter" data-level="" data-path="conditional.html"><a href="conditional.html#e3-6"><i class="fa fa-check"></i>8E3</a></li>
<li class="chapter" data-level="" data-path="conditional.html"><a href="conditional.html#m1-5"><i class="fa fa-check"></i>8M1</a></li>
<li class="chapter" data-level="" data-path="conditional.html"><a href="conditional.html#m2-5"><i class="fa fa-check"></i>8M2</a></li>
<li class="chapter" data-level="" data-path="conditional.html"><a href="conditional.html#m3-5"><i class="fa fa-check"></i>8M3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="markov_chain.html"><a href="markov_chain.html"><i class="fa fa-check"></i><b>9</b> Markov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.1" data-path="markov_chain.html"><a href="markov_chain.html#chapter-notes-8"><i class="fa fa-check"></i><b>9.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="markov_chain.html"><a href="markov_chain.html#a-metropolis-algorithm"><i class="fa fa-check"></i>A Metropolis Algorithm</a></li>
<li class="chapter" data-level="" data-path="markov_chain.html"><a href="markov_chain.html#gibbs-sampling-and-hamiltonian-monte-carlo"><i class="fa fa-check"></i>Gibbs Sampling and Hamiltonian Monte Carlo</a></li>
<li class="chapter" data-level="" data-path="markov_chain.html"><a href="markov_chain.html#posterior-predictive-checks-with-stan"><i class="fa fa-check"></i>Posterior Predictive Checks with Stan</a></li>
<li class="chapter" data-level="" data-path="markov_chain.html"><a href="markov_chain.html#prior-predictive-checks-with-stan"><i class="fa fa-check"></i>Prior Predictive Checks with Stan</a></li>
<li class="chapter" data-level="" data-path="markov_chain.html"><a href="markov_chain.html#diagnostics-comparison---trace-plots-waic-psis"><i class="fa fa-check"></i>Diagnostics &amp; Comparison - Trace Plots, WAIC &amp; PSIS</a></li>
<li class="chapter" data-level="" data-path="markov_chain.html"><a href="markov_chain.html#care-and-feeding-of-your-markov-chain"><i class="fa fa-check"></i>Care and Feeding of Your Markov Chain</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="markov_chain.html"><a href="markov_chain.html#questions-8"><i class="fa fa-check"></i><b>9.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="markov_chain.html"><a href="markov_chain.html#e1-7"><i class="fa fa-check"></i>9E1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov_chain.html"><a href="markov_chain.html#further-reading-7"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big_entropy.html"><a href="big_entropy.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="10.1" data-path="big_entropy.html"><a href="big_entropy.html#chapter-notes-9"><i class="fa fa-check"></i><b>10.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="big_entropy.html"><a href="big_entropy.html#maximum-entropy"><i class="fa fa-check"></i>Maximum Entropy</a></li>
<li class="chapter" data-level="" data-path="big_entropy.html"><a href="big_entropy.html#generalized-linear-models"><i class="fa fa-check"></i>Generalized Linear Models</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big_entropy.html"><a href="big_entropy.html#questions-9"><i class="fa fa-check"></i><b>10.2</b> Questions</a></li>
<li class="chapter" data-level="" data-path="big_entropy.html"><a href="big_entropy.html#further-resources"><i class="fa fa-check"></i>Further Resources</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god_spiked.html"><a href="god_spiked.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a>
<ul>
<li class="chapter" data-level="11.1" data-path="god_spiked.html"><a href="god_spiked.html#chapter-notes-10"><i class="fa fa-check"></i><b>11.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#binomial-regression"><i class="fa fa-check"></i>Binomial Regression</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#poisson-regression"><i class="fa fa-check"></i>Poisson Regression</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#multinomial-and-categorical-models"><i class="fa fa-check"></i>Multinomial and Categorical Models</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god_spiked.html"><a href="god_spiked.html#questions-10"><i class="fa fa-check"></i><b>11.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#e1-8"><i class="fa fa-check"></i>11E1</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#e2-6"><i class="fa fa-check"></i>11E2</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#e3-7"><i class="fa fa-check"></i>11E3</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#e4-6"><i class="fa fa-check"></i>11E4</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#m1-6"><i class="fa fa-check"></i>11M1</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#m2-6"><i class="fa fa-check"></i>11M2</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#m3-6"><i class="fa fa-check"></i>11M3</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#m4-4"><i class="fa fa-check"></i>11M4</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#m5-4"><i class="fa fa-check"></i>11M5</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#m6-4"><i class="fa fa-check"></i>11M6</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#m7-2"><i class="fa fa-check"></i>11M7</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#m8"><i class="fa fa-check"></i>11M8</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#h1-4"><i class="fa fa-check"></i>11H1</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#h2-4"><i class="fa fa-check"></i>11H2</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#h3-4"><i class="fa fa-check"></i>11H3</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#h4-4"><i class="fa fa-check"></i>11H4</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#h5-3"><i class="fa fa-check"></i>11H5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#further-resources-1"><i class="fa fa-check"></i>Further Resources</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters_mixtures.html"><a href="monsters_mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a>
<ul>
<li class="chapter" data-level="12.1" data-path="monsters_mixtures.html"><a href="monsters_mixtures.html#chapter-notes-11"><i class="fa fa-check"></i><b>12.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="monsters_mixtures.html"><a href="monsters_mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i>Over-Dispersed Counts</a></li>
<li class="chapter" data-level="" data-path="monsters_mixtures.html"><a href="monsters_mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i>Zero-Inflated Outcomes</a></li>
<li class="chapter" data-level="" data-path="monsters_mixtures.html"><a href="monsters_mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i>Ordered Categorical Outcomes</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters_mixtures.html"><a href="monsters_mixtures.html#questions-11"><i class="fa fa-check"></i><b>12.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="monsters_mixtures.html"><a href="monsters_mixtures.html#e1-9"><i class="fa fa-check"></i>12E1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="monsters_mixtures.html"><a href="monsters_mixtures.html#further-resources-2"><i class="fa fa-check"></i>Further Resources</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="models_memory.html"><a href="models_memory.html"><i class="fa fa-check"></i><b>13</b> Models With Memory</a>
<ul>
<li class="chapter" data-level="13.1" data-path="models_memory.html"><a href="models_memory.html#chapter-notes-12"><i class="fa fa-check"></i><b>13.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="models_memory.html"><a href="models_memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i>More Than One Type of Cluster</a></li>
<li class="chapter" data-level="" data-path="models_memory.html"><a href="models_memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i>Divergent Transitions and Non-Centered Priors</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="models_memory.html"><a href="models_memory.html#questions-12"><i class="fa fa-check"></i><b>13.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="models_memory.html"><a href="models_memory.html#e1-10"><i class="fa fa-check"></i>13E1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="models_memory.html"><a href="models_memory.html#further-resources-3"><i class="fa fa-check"></i>Further Resources</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="covariance.html"><a href="covariance.html"><i class="fa fa-check"></i><b>14</b> Adventures in Covariance</a>
<ul>
<li class="chapter" data-level="14.1" data-path="covariance.html"><a href="covariance.html#chapter-notes-13"><i class="fa fa-check"></i><b>14.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="covariance.html"><a href="covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i>Varying Slopes by Construction</a></li>
<li class="chapter" data-level="" data-path="covariance.html"><a href="covariance.html#instruments-and-causal-designs"><i class="fa fa-check"></i>Instruments and Causal Designs</a></li>
<li class="chapter" data-level="" data-path="covariance.html"><a href="covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i>Continuous Categories and the Gaussian Process</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="covariance.html"><a href="covariance.html#questions-13"><i class="fa fa-check"></i><b>14.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="covariance.html"><a href="covariance.html#e1-11"><i class="fa fa-check"></i>14E1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="covariance.html"><a href="covariance.html#further-resources-4"><i class="fa fa-check"></i>Further Resources</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="missing_data.html"><a href="missing_data.html"><i class="fa fa-check"></i><b>15</b> Missing Data and Other Opportunities</a>
<ul>
<li class="chapter" data-level="15.1" data-path="missing_data.html"><a href="missing_data.html#chapter-notes-14"><i class="fa fa-check"></i><b>15.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="missing_data.html"><a href="missing_data.html#measurement-error"><i class="fa fa-check"></i>Measurement Error</a></li>
<li class="chapter" data-level="" data-path="missing_data.html"><a href="missing_data.html#missing-data"><i class="fa fa-check"></i>Missing Data</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="missing_data.html"><a href="missing_data.html#questions-14"><i class="fa fa-check"></i><b>15.2</b> Questions</a></li>
<li class="chapter" data-level="" data-path="missing_data.html"><a href="missing_data.html#further-reading-8"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="generalized.html"><a href="generalized.html"><i class="fa fa-check"></i><b>16</b> Generalized Linear Madness</a>
<ul>
<li class="chapter" data-level="16.1" data-path="generalized.html"><a href="generalized.html#chapter-notes-15"><i class="fa fa-check"></i><b>16.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="generalized.html"><a href="generalized.html#geometric-people"><i class="fa fa-check"></i>Geometric People</a></li>
<li class="chapter" data-level="" data-path="generalized.html"><a href="generalized.html#hidden-minds-and-observed-behaviour"><i class="fa fa-check"></i>Hidden Minds and Observed Behaviour</a></li>
<li class="chapter" data-level="" data-path="generalized.html"><a href="generalized.html#ordinary-differential-nut-cracking"><i class="fa fa-check"></i>Ordinary Differential Nut Cracking</a></li>
<li class="chapter" data-level="" data-path="generalized.html"><a href="generalized.html#population-dynamics"><i class="fa fa-check"></i>Population Dynamics</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="generalized.html"><a href="generalized.html#questions-15"><i class="fa fa-check"></i><b>16.2</b> Questions</a></li>
<li class="chapter" data-level="" data-path="generalized.html"><a href="generalized.html#further-reading-9"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Rethinking Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="god_spiked" class="section level1" number="11">
<h1><span class="header-section-number">Chapter 11</span> God Spiked the Integers</h1>
<div id="chapter-notes-10" class="section level2" number="11.1">
<h2><span class="header-section-number">11.1</span> Chapter Notes</h2>
<p>This chapter is about two kinds of count models - binomial and Poisson. Binomial regression is used when our outcome is binary and there is a (possibly, but not necessarily, known) fixed total for the two categories. Poisson regression is used when we have a count without a fixed maximum.</p>
<p>We’re going to need the inverse logit (or logistic) function:</p>
<div id="binomial-regression" class="section level3 unnumbered">
<h3>Binomial Regression</h3>
<p>The chapter introduces a case where we might want to use logistic regression. It describes an experiment in which chimpanzees were given the option to pull one of two levers (left or right). Each lever would deliver a tray to the chimpanzee, and also to the opposite end of the table where a partner chimpanzee may or may not be sitting. In all cases the trays delivered to the lever-pulling chimpanzee would contain food, but only one of the levers would deliver food to the partner. The aim of the experiment was to determine whether chimpanzees were more likely to pull the lever that delivers food to the other end of the table if a partner chimpanzee was present.</p>
<p>We start by loading the data and defining an index variable (“treatment”) that takes digits 1-4 with the following meaning:</p>
<ol style="list-style-type: decimal">
<li>Right-hand lever delivers food to both ends of the table, and no partner is present.</li>
<li>Left-hand lever delivers food to both ends of the table, and no partner is present.</li>
<li>Right-hand lever delivers food to both ends of the table, and a partner is present.</li>
<li>Left-hand lever delivers food to both ends of the table, and a partner is present.</li>
</ol>
<p>We model the outcome that the left lever is pulled like so:</p>
<p><span class="math display">\[
\begin{aligned}
L_i &amp;\sim \text{Binomial}(1,p_i) \\
\text{logit}(p_i) &amp;= \alpha_{actor[i]} + \beta_{treatment[i]} \\
\alpha_j &amp;\sim \text{Normal}(0,1.5) \\
\beta_k &amp;\sim \text{Normal}(0,0.5)
\end{aligned}
\]</span></p>
<p>In Stan:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="god_spiked.html#cb276-1" aria-hidden="true" tabindex="-1"></a>code_m11_4 <span class="ot">&lt;-</span> </span>
<span id="cb276-2"><a href="god_spiked.html#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;data{</span></span>
<span id="cb276-3"><a href="god_spiked.html#cb276-3" aria-hidden="true" tabindex="-1"></a><span class="st">    int&lt;lower = 1&gt; n;</span></span>
<span id="cb276-4"><a href="god_spiked.html#cb276-4" aria-hidden="true" tabindex="-1"></a><span class="st">    int pulled_left[n];</span></span>
<span id="cb276-5"><a href="god_spiked.html#cb276-5" aria-hidden="true" tabindex="-1"></a><span class="st">    int treatment[n];</span></span>
<span id="cb276-6"><a href="god_spiked.html#cb276-6" aria-hidden="true" tabindex="-1"></a><span class="st">    int actor[n];</span></span>
<span id="cb276-7"><a href="god_spiked.html#cb276-7" aria-hidden="true" tabindex="-1"></a><span class="st">    int&lt;lower = 0, upper = 1&gt; posterior; // a switch to evaluate the likelihood</span></span>
<span id="cb276-8"><a href="god_spiked.html#cb276-8" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb276-9"><a href="god_spiked.html#cb276-9" aria-hidden="true" tabindex="-1"></a><span class="st">parameters{</span></span>
<span id="cb276-10"><a href="god_spiked.html#cb276-10" aria-hidden="true" tabindex="-1"></a><span class="st">    vector[7] a;</span></span>
<span id="cb276-11"><a href="god_spiked.html#cb276-11" aria-hidden="true" tabindex="-1"></a><span class="st">    vector[4] b;</span></span>
<span id="cb276-12"><a href="god_spiked.html#cb276-12" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb276-13"><a href="god_spiked.html#cb276-13" aria-hidden="true" tabindex="-1"></a><span class="st">model{</span></span>
<span id="cb276-14"><a href="god_spiked.html#cb276-14" aria-hidden="true" tabindex="-1"></a><span class="st">    vector[n] p;</span></span>
<span id="cb276-15"><a href="god_spiked.html#cb276-15" aria-hidden="true" tabindex="-1"></a><span class="st">    b ~ normal( 0 , 0.5 );</span></span>
<span id="cb276-16"><a href="god_spiked.html#cb276-16" aria-hidden="true" tabindex="-1"></a><span class="st">    a ~ normal( 0 , 1.5 );</span></span>
<span id="cb276-17"><a href="god_spiked.html#cb276-17" aria-hidden="true" tabindex="-1"></a><span class="st">    for ( i in 1:n ) {</span></span>
<span id="cb276-18"><a href="god_spiked.html#cb276-18" aria-hidden="true" tabindex="-1"></a><span class="st">        p[i] = a[actor[i]] + b[treatment[i]];</span></span>
<span id="cb276-19"><a href="god_spiked.html#cb276-19" aria-hidden="true" tabindex="-1"></a><span class="st">        p[i] = inv_logit(p[i]);</span></span>
<span id="cb276-20"><a href="god_spiked.html#cb276-20" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb276-21"><a href="god_spiked.html#cb276-21" aria-hidden="true" tabindex="-1"></a><span class="st">    if(posterior==1){  </span></span>
<span id="cb276-22"><a href="god_spiked.html#cb276-22" aria-hidden="true" tabindex="-1"></a><span class="st">    pulled_left ~ binomial( 1 , p ); // here I&#39;ve implemented the switch</span></span>
<span id="cb276-23"><a href="god_spiked.html#cb276-23" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb276-24"><a href="god_spiked.html#cb276-24" aria-hidden="true" tabindex="-1"></a><span class="st">}&quot;</span></span>
<span id="cb276-25"><a href="god_spiked.html#cb276-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-26"><a href="god_spiked.html#cb276-26" aria-hidden="true" tabindex="-1"></a>compile_m11_4 <span class="ot">&lt;-</span> <span class="fu">stan_model</span>(<span class="at">model_name =</span> <span class="st">&quot;m11_4&quot;</span>, <span class="at">model_code =</span> code_m11_4)</span>
<span id="cb276-27"><a href="god_spiked.html#cb276-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-28"><a href="god_spiked.html#cb276-28" aria-hidden="true" tabindex="-1"></a>m11_4 <span class="ot">&lt;-</span> <span class="fu">sampling</span>(compile_m11_4,</span>
<span id="cb276-29"><a href="god_spiked.html#cb276-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> <span class="fu">c</span>(<span class="fu">compose_data</span>(data_chimp), <span class="at">posterior =</span> <span class="fu">list</span>(<span class="dv">1</span>) ), <span class="at">chains=</span><span class="dv">4</span>, <span class="at">cores=</span>parallel<span class="sc">::</span><span class="fu">detectCores</span>())<span class="sc">%&gt;%</span></span>
<span id="cb276-30"><a href="god_spiked.html#cb276-30" aria-hidden="true" tabindex="-1"></a>          <span class="fu">recover_types</span>()</span>
<span id="cb276-31"><a href="god_spiked.html#cb276-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-32"><a href="god_spiked.html#cb276-32" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(m11_4,file=&quot;models\\m11_4.rds&quot;)</span></span></code></pre></div>
<p>After transforming them into the outcome scale, we can plot the parameters that represent each actor (i.e. each chimpanzee). There are seven in the experiment.</p>
<p>There are a couple of ways we could do this. We could plot the sampled <span class="math inline">\(\alpha\)</span> parameters on the log-odds scale (i.e. un-transformed):</p>
<p><img src="11-god_spiked_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>On this scale, an <span class="math inline">\(\alpha\)</span> of 0 means that the parameter doesn’t suggest a propensity to pull either the left or right lever. Transformed into the probability space, the inverse logit of 0 is 0.5. High-values of <span class="math inline">\(\alpha\)</span> increase the probability of pulling left, and large negative values increase the probability of pulling right.</p>
<p>Another way to display the model results by actor is to take all of the sampled <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> pairs and transform them to the probability space, then group them by actor and display:</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="god_spiked.html#cb277-1" aria-hidden="true" tabindex="-1"></a>draws_chimp <span class="ot">&lt;-</span> <span class="fu">spread_draws</span>(m11_4, a[i],b[j],<span class="at">ndraws =</span> <span class="dv">1000</span>)<span class="sc">%&gt;%</span></span>
<span id="cb277-2"><a href="god_spiked.html#cb277-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">linpred =</span> a<span class="sc">+</span>b,</span>
<span id="cb277-3"><a href="god_spiked.html#cb277-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">p =</span> <span class="fu">inv_logit</span>(linpred))</span>
<span id="cb277-4"><a href="god_spiked.html#cb277-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-5"><a href="god_spiked.html#cb277-5" aria-hidden="true" tabindex="-1"></a>draws_chimp<span class="sc">%&gt;%</span></span>
<span id="cb277-6"><a href="god_spiked.html#cb277-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(i)<span class="sc">%&gt;%</span> <span class="co"># mean_qi() uses the groups in the data frame</span></span>
<span id="cb277-7"><a href="god_spiked.html#cb277-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(p, <span class="at">.width=</span><span class="fl">0.89</span>)<span class="sc">%&gt;%</span> <span class="co"># so this function returns 7 ranges for p, not just 1</span></span>
<span id="cb277-8"><a href="god_spiked.html#cb277-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> i, <span class="at">x =</span> p, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb277-9"><a href="god_spiked.html#cb277-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>()<span class="sc">+</span></span>
<span id="cb277-10"><a href="god_spiked.html#cb277-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Chimp&quot;</span>)<span class="sc">+</span></span>
<span id="cb277-11"><a href="god_spiked.html#cb277-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Probability of Pulling Left&quot;</span>)<span class="sc">+</span></span>
<span id="cb277-12"><a href="god_spiked.html#cb277-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span></code></pre></div>
<p><img src="11-god_spiked_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>This plot displays the probability that each chimp pulls the left lever, averaging over all the treatments. One interesting difference compared to the last plot is how different the variances look when transformed into the probability space. Actor 2 for example, only every pulled the left lever in the experiments, and so the model is quite confident about them. However just looking at the raw <span class="math inline">\(\alpha\)</span> parameter, this confidence is not at all obvious - the model looks quite uncertain.</p>
<p>Another way to plot this same data is to facet by the four treatment, instead of averaging over them:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="god_spiked.html#cb278-1" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;R/N&quot;</span>, <span class="st">&quot;L/N&quot;</span>, <span class="st">&quot;R/P&quot;</span>, <span class="st">&quot;L/P&quot;</span>)</span>
<span id="cb278-2"><a href="god_spiked.html#cb278-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-3"><a href="god_spiked.html#cb278-3" aria-hidden="true" tabindex="-1"></a>draws_chimp<span class="sc">%&gt;%</span></span>
<span id="cb278-4"><a href="god_spiked.html#cb278-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(i,j)<span class="sc">%&gt;%</span> <span class="co"># grouping as above</span></span>
<span id="cb278-5"><a href="god_spiked.html#cb278-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(p, <span class="at">.width=</span><span class="fl">0.89</span>)<span class="sc">%&gt;%</span> <span class="co"># this contains 7 * 4 ranges for p</span></span>
<span id="cb278-6"><a href="god_spiked.html#cb278-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> treatments[j])<span class="sc">%&gt;%</span></span>
<span id="cb278-7"><a href="god_spiked.html#cb278-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> i, <span class="at">x =</span> p, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb278-8"><a href="god_spiked.html#cb278-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>()<span class="sc">+</span></span>
<span id="cb278-9"><a href="god_spiked.html#cb278-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>treatment)<span class="sc">+</span></span>
<span id="cb278-10"><a href="god_spiked.html#cb278-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Chimp&quot;</span>)<span class="sc">+</span></span>
<span id="cb278-11"><a href="god_spiked.html#cb278-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Probability of Pulling Left&quot;</span>)<span class="sc">+</span></span>
<span id="cb278-12"><a href="god_spiked.html#cb278-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span></code></pre></div>
<p><img src="11-god_spiked_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Here:</p>
<ul>
<li>L means the left-hand lever delivers food to both ends of the table, R the opposite.</li>
<li>P means a partner is present, N the opposite.</li>
</ul>
<p>The plot in the chapter works differently to the above. It plots the inverse logit of the <span class="math inline">\(\alpha\)</span> parameter directly. Since the value of <span class="math inline">\(p\)</span> is the inverse logit of the sum of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> parameters, the inverse logit of <span class="math inline">\(\alpha\)</span> alone is the probability of the actor pulling the left lever if the treatment parameter was 0 - i.e. had no lean either way. However, I’m not sure this works since the <span class="math inline">\(\alpha\)</span>s and <span class="math inline">\(\beta\)</span>s are sampled together- does it make sense to set <span class="math inline">\(\beta\)</span> to 0 like this? Need to think more about this.</p>
<p>In any case, here’s the same plot for the treatment effects:</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="god_spiked.html#cb279-1" aria-hidden="true" tabindex="-1"></a>draws_chimp<span class="sc">%&gt;%</span></span>
<span id="cb279-2"><a href="god_spiked.html#cb279-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(i,j)<span class="sc">%&gt;%</span></span>
<span id="cb279-3"><a href="god_spiked.html#cb279-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(p, <span class="at">.width=</span><span class="fl">0.89</span>)<span class="sc">%&gt;%</span></span>
<span id="cb279-4"><a href="god_spiked.html#cb279-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> j, <span class="at">x =</span> p, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb279-5"><a href="god_spiked.html#cb279-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>()<span class="sc">+</span></span>
<span id="cb279-6"><a href="god_spiked.html#cb279-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>i)<span class="sc">+</span></span>
<span id="cb279-7"><a href="god_spiked.html#cb279-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Treatment&quot;</span>)<span class="sc">+</span></span>
<span id="cb279-8"><a href="god_spiked.html#cb279-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Probability of Pulling Left&quot;</span>)<span class="sc">+</span></span>
<span id="cb279-9"><a href="god_spiked.html#cb279-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">labels=</span>treatments)</span></code></pre></div>
<p><img src="11-god_spiked_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>The experiment is to test pro-social behaviour in chimps. If the chimps exhibited pro-social behaviour, we’d expect that the pro-social lever would be pulled more often in the presence of a partner. I.e. we want to compare R/P against R/N, and L/P against L/N. I’ve done this via a plot but it looks like the tidybayes function compare_levels() would allow a quick numerical comparison.</p>
<p>Here’s a plot of the model predictions:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="god_spiked.html#cb280-1" aria-hidden="true" tabindex="-1"></a>partner_status <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;N&quot;</span>,<span class="st">&quot;N&quot;</span>,<span class="st">&quot;Y&quot;</span>,<span class="st">&quot;Y&quot;</span>)</span>
<span id="cb280-2"><a href="god_spiked.html#cb280-2" aria-hidden="true" tabindex="-1"></a>prosocial_lever <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;R&quot;</span>,<span class="st">&quot;L&quot;</span>,<span class="st">&quot;R&quot;</span>,<span class="st">&quot;L&quot;</span>)</span>
<span id="cb280-3"><a href="god_spiked.html#cb280-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-4"><a href="god_spiked.html#cb280-4" aria-hidden="true" tabindex="-1"></a>draws_chimp<span class="sc">%&gt;%</span></span>
<span id="cb280-5"><a href="god_spiked.html#cb280-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(i,j)<span class="sc">%&gt;%</span></span>
<span id="cb280-6"><a href="god_spiked.html#cb280-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(p, <span class="at">.width=</span><span class="fl">0.5</span>)<span class="sc">%&gt;%</span> <span class="co"># 50% intervals</span></span>
<span id="cb280-7"><a href="god_spiked.html#cb280-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">partner_status=</span> partner_status[j],</span>
<span id="cb280-8"><a href="god_spiked.html#cb280-8" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Prosocial Lever</span><span class="st">`</span><span class="ot">=</span>prosocial_lever[j])<span class="sc">%&gt;%</span></span>
<span id="cb280-9"><a href="god_spiked.html#cb280-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>partner_status,<span class="at">y=</span>p,<span class="at">ymin =</span> .lower, <span class="at">ymax =</span> .upper, <span class="at">colour=</span><span class="st">`</span><span class="at">Prosocial Lever</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb280-10"><a href="god_spiked.html#cb280-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.3</span>))<span class="sc">+</span> <span class="co"># so the intervals don&#39;t overlap</span></span>
<span id="cb280-11"><a href="god_spiked.html#cb280-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span><span class="st">`</span><span class="at">Prosocial Lever</span><span class="st">`</span>))<span class="sc">+</span> <span class="co"># the grouping ensures the lines connect the right dots</span></span>
<span id="cb280-12"><a href="god_spiked.html#cb280-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>i, <span class="at">nrow=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb280-13"><a href="god_spiked.html#cb280-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Partner Present&quot;</span>)<span class="sc">+</span></span>
<span id="cb280-14"><a href="god_spiked.html#cb280-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Probability of Pulling Left&quot;</span>)<span class="sc">+</span></span>
<span id="cb280-15"><a href="god_spiked.html#cb280-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span></code></pre></div>
<p><img src="11-god_spiked_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>We have seven frames, one for each chimp. The vertical lines are the 50% intervals. Pro-social behaviour here would mean that as we move from having no partner present “N,” to having a partner present “Y” there is an increased tendency to pull left when the left lever is the pro-social option, and a decreased tendency to pull left when right is the pro-social option. I.e. the red lines should slope up and the blue lines should slope down.</p>
<p>We can see that when right is the pro-social option there is a slight tendency for the chimps to pull the right lever more when a partner is present. There is no similar tendency to pull the left lever more when a partner is present when the left lever is the pro-social choice.</p>
<p>Revisit - use the loo package to get model PSIS and WAIC. Believe I need the generated quantities block for this too. Use stancode().</p>
<p>There’s some discussion about relative effect sizes - looking at changes in odds when some predictor changes rather than the absolute probability changes plotted above. This allows you to say things like this sentence in the chapter:</p>
<blockquote>
<p>On average, the switch [from treatment 2 to 4] multiplies the odds of pulling the left lever by 0.92, an 8% reduction in odds.</p>
</blockquote>
<p>To get the odds you just exponentiate the right hand side of the linear predictor. Relative effects are the more common approach in logistic regression.</p>
<p>If we have a logistic regression like so:</p>
<p><span class="math display">\[
\frac{p_i}{1-p_i} =\exp(\alpha +\beta x_i)
\]</span>
You can find <span class="math inline">\(q\)</span>, the proportional odds or the number we multiply the odds by when we increase <span class="math inline">\(x_i\)</span> by 1, using the following formula:</p>
<p><span class="math display">\[
q=\frac{\exp(\alpha +\beta (x_i+1)}{\exp(\alpha +\beta x_i)} = \frac{\exp(\alpha) \exp(\beta x_i) \exp(\beta)}{\exp(\alpha) \exp(\beta x_i)} = \exp(\beta)
\]</span>
From the chapter:</p>
<blockquote>
<p>So if <span class="math inline">\(q\)</span> = 2, that means a unit increase in <span class="math inline">\(x_i\)</span> generates a doubling of the odds. This a relative risk, because if the intercept <span class="math inline">\(\alpha\)</span>, or any combination of other predictors, makes the event very unlikely or almost certain, then a doubling of the odds might not change the probability <span class="math inline">\(p_i\)</span> much.</p>
</blockquote>
<p>The last part of this section concerns aggregated binomial models. We arranged the chimp model like this:</p>
<p><span class="math display">\[
\begin{aligned}
L_i &amp;\sim \text{Binomial}(1,p_i) \\
\text{logit}(p_i) &amp;= \alpha_{actor[i]} + \beta_{treatment[i]} \\
\alpha_j &amp;\sim \text{Normal}(0,1.5) \\
\beta_k &amp;\sim \text{Normal}(0,0.5)
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(L_i\)</span> is 0 if the actor pulls right and 1 if they pull left. But we could just have easily used this model:</p>
<p><span class="math display">\[
\begin{aligned}
\text{Left pulls} &amp;\sim \text{Binomial}(18,p_i) \\
\text{logit}(p_i) &amp;= \alpha_{actor[i]} + \beta_{treatment[i]} \\
\alpha_j &amp;\sim \text{Normal}(0,1.5) \\
\beta_k &amp;\sim \text{Normal}(0,0.5)
\end{aligned}
\]</span></p>
<p>Where we count the number of left pulls across the 18 trials for each chimp for each treatment.</p>
<p>Our inferences would have been the same, but the chapter suggests that if you want to use PSIS or WAIC it’s better to disaggregate. Then the model sees the data as separable (instead of in clumps of 18 at a time) which is useful for the quasi-leave-one-out calculations that PSIS does.</p>
<p>The chapter discusses the well-known Berkeley graduate admissions data and Simpson’s paradox using an aggregated binomial model.</p>
</div>
<div id="poisson-regression" class="section level3 unnumbered">
<h3>Poisson Regression</h3>
<p>The chapter introduces the Poisson distribution, and then sets up an example model using data on tool-use among historical societies in Oceania.</p>
<p>We want to model tool use among these societies, with two predictors: (log) population size <span class="math inline">\(P\)</span>, and amount of contact with other populations (contact ID, or <span class="math inline">\(CID\)</span> where 1 is low, 2 is high). Our model is:</p>
<p><span class="math display">\[
\begin{aligned}
T_i &amp;\sim \text{Poisson}(\lambda_i) \\
\log \lambda_i &amp;= \alpha_{\text{CID}[i]}+ \beta_{\text{CID}[i]} \log P_i \\
\alpha_j &amp;\sim \text{Normal}(3,0.5) \\
\beta_j &amp;\sim \text{Normal}(0,0.2)\\
\end{aligned}
\]</span>
We load the data and shape the data:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="god_spiked.html#cb281-1" aria-hidden="true" tabindex="-1"></a>scale <span class="ot">&lt;-</span> <span class="cf">function</span>(x){(x<span class="sc">-</span><span class="fu">mean</span>(x))<span class="sc">/</span><span class="fu">sd</span>(x)}</span>
<span id="cb281-2"><a href="god_spiked.html#cb281-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-3"><a href="god_spiked.html#cb281-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Kline)</span>
<span id="cb281-4"><a href="god_spiked.html#cb281-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-5"><a href="god_spiked.html#cb281-5" aria-hidden="true" tabindex="-1"></a>data_tool <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Kline)<span class="sc">%&gt;%</span></span>
<span id="cb281-6"><a href="god_spiked.html#cb281-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">P =</span> <span class="fu">scale</span>(<span class="fu">log</span>(population)),          </span>
<span id="cb281-7"><a href="god_spiked.html#cb281-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">cid =</span> <span class="fu">if_else</span>(contact<span class="sc">==</span><span class="st">&quot;high&quot;</span>,<span class="dv">2</span>,<span class="dv">1</span>),</span>
<span id="cb281-8"><a href="god_spiked.html#cb281-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">cid =</span> <span class="fu">as_factor</span>(cid))</span>
<span id="cb281-9"><a href="god_spiked.html#cb281-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-10"><a href="god_spiked.html#cb281-10" aria-hidden="true" tabindex="-1"></a>data_model_tool <span class="ot">&lt;-</span> data_tool<span class="sc">%&gt;%</span></span>
<span id="cb281-11"><a href="god_spiked.html#cb281-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">T=</span>total_tools, P, cid)</span></code></pre></div>
<p>Here’s the model in Stan:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="god_spiked.html#cb282-1" aria-hidden="true" tabindex="-1"></a>code_m11_10 <span class="ot">&lt;-</span> </span>
<span id="cb282-2"><a href="god_spiked.html#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;data{</span></span>
<span id="cb282-3"><a href="god_spiked.html#cb282-3" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower =1&gt; n;</span></span>
<span id="cb282-4"><a href="god_spiked.html#cb282-4" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower = 1, upper =2&gt; cid[n];</span></span>
<span id="cb282-5"><a href="god_spiked.html#cb282-5" aria-hidden="true" tabindex="-1"></a><span class="st">  int T[n];</span></span>
<span id="cb282-6"><a href="god_spiked.html#cb282-6" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[n] P;</span></span>
<span id="cb282-7"><a href="god_spiked.html#cb282-7" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower = 0, upper = 1&gt; posterior;</span></span>
<span id="cb282-8"><a href="god_spiked.html#cb282-8" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb282-9"><a href="god_spiked.html#cb282-9" aria-hidden="true" tabindex="-1"></a><span class="st">parameters{</span></span>
<span id="cb282-10"><a href="god_spiked.html#cb282-10" aria-hidden="true" tabindex="-1"></a><span class="st">vector[2] a;</span></span>
<span id="cb282-11"><a href="god_spiked.html#cb282-11" aria-hidden="true" tabindex="-1"></a><span class="st">vector[2] b;</span></span>
<span id="cb282-12"><a href="god_spiked.html#cb282-12" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb282-13"><a href="god_spiked.html#cb282-13" aria-hidden="true" tabindex="-1"></a><span class="st">model{</span></span>
<span id="cb282-14"><a href="god_spiked.html#cb282-14" aria-hidden="true" tabindex="-1"></a><span class="st">    vector[10] lambda;</span></span>
<span id="cb282-15"><a href="god_spiked.html#cb282-15" aria-hidden="true" tabindex="-1"></a><span class="st">    b ~ normal( 0 , 0.2 );</span></span>
<span id="cb282-16"><a href="god_spiked.html#cb282-16" aria-hidden="true" tabindex="-1"></a><span class="st">    a ~ normal( 3 , 0.5 );</span></span>
<span id="cb282-17"><a href="god_spiked.html#cb282-17" aria-hidden="true" tabindex="-1"></a><span class="st">    for ( i in 1:10 ) {</span></span>
<span id="cb282-18"><a href="god_spiked.html#cb282-18" aria-hidden="true" tabindex="-1"></a><span class="st">        lambda[i] = a[cid[i]] + b[cid[i]] * P[i];</span></span>
<span id="cb282-19"><a href="god_spiked.html#cb282-19" aria-hidden="true" tabindex="-1"></a><span class="st">        lambda[i] = exp(lambda[i]);</span></span>
<span id="cb282-20"><a href="god_spiked.html#cb282-20" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb282-21"><a href="god_spiked.html#cb282-21" aria-hidden="true" tabindex="-1"></a><span class="st">    if(posterior==1){</span></span>
<span id="cb282-22"><a href="god_spiked.html#cb282-22" aria-hidden="true" tabindex="-1"></a><span class="st">    T ~ poisson( lambda );</span></span>
<span id="cb282-23"><a href="god_spiked.html#cb282-23" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb282-24"><a href="god_spiked.html#cb282-24" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb282-25"><a href="god_spiked.html#cb282-25" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities{</span></span>
<span id="cb282-26"><a href="god_spiked.html#cb282-26" aria-hidden="true" tabindex="-1"></a><span class="st">    vector[10] log_lik;</span></span>
<span id="cb282-27"><a href="god_spiked.html#cb282-27" aria-hidden="true" tabindex="-1"></a><span class="st">    vector[10] lambda;</span></span>
<span id="cb282-28"><a href="god_spiked.html#cb282-28" aria-hidden="true" tabindex="-1"></a><span class="st">    for ( i in 1:10 ) {</span></span>
<span id="cb282-29"><a href="god_spiked.html#cb282-29" aria-hidden="true" tabindex="-1"></a><span class="st">        lambda[i] = a[cid[i]] + b[cid[i]] * P[i];</span></span>
<span id="cb282-30"><a href="god_spiked.html#cb282-30" aria-hidden="true" tabindex="-1"></a><span class="st">        lambda[i] = exp(lambda[i]);</span></span>
<span id="cb282-31"><a href="god_spiked.html#cb282-31" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb282-32"><a href="god_spiked.html#cb282-32" aria-hidden="true" tabindex="-1"></a><span class="st">    for ( i in 1:10 ) log_lik[i] = poisson_lpmf( T[i] | lambda[i] );</span></span>
<span id="cb282-33"><a href="god_spiked.html#cb282-33" aria-hidden="true" tabindex="-1"></a><span class="st">}&quot;</span></span>
<span id="cb282-34"><a href="god_spiked.html#cb282-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-35"><a href="god_spiked.html#cb282-35" aria-hidden="true" tabindex="-1"></a>compile_m11_10 <span class="ot">&lt;-</span> <span class="fu">stan_model</span>(<span class="at">model_name =</span> <span class="st">&quot;m11_10&quot;</span>, <span class="at">model_code =</span> code_m11_10)</span>
<span id="cb282-36"><a href="god_spiked.html#cb282-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-37"><a href="god_spiked.html#cb282-37" aria-hidden="true" tabindex="-1"></a>m11_10 <span class="ot">&lt;-</span> <span class="fu">sampling</span>(compile_m11_10, <span class="at">data=</span><span class="fu">c</span>(<span class="fu">compose_data</span>(data_model_tool),<span class="at">posterior=</span><span class="fu">list</span>(<span class="dv">1</span>)),</span>
<span id="cb282-38"><a href="god_spiked.html#cb282-38" aria-hidden="true" tabindex="-1"></a>                   <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb282-39"><a href="god_spiked.html#cb282-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-40"><a href="god_spiked.html#cb282-40" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(m11_10,file=&quot;models\\m11_10.rds&quot;)</span></span></code></pre></div>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="god_spiked.html#cb283-1" aria-hidden="true" tabindex="-1"></a>m11_10 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;models</span><span class="sc">\\</span><span class="st">m11_10.rds&quot;</span>)</span></code></pre></div>
<p>Before I recreate the plot in the chapter, I’ll need the Pareto <span class="math inline">\(k\)</span> values. Still not entirely comfortable with the loo package.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="god_spiked.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Add PSIS to original data</span></span>
<span id="cb284-2"><a href="god_spiked.html#cb284-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-3"><a href="god_spiked.html#cb284-3" aria-hidden="true" tabindex="-1"></a>loo_tool <span class="ot">&lt;-</span> <span class="fu">loo</span>(<span class="fu">extract</span>(m11_10)[[<span class="st">&quot;log_lik&quot;</span>]]) <span class="co"># extract the log liklihoods and feed them to loo()</span></span>
<span id="cb284-4"><a href="god_spiked.html#cb284-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-5"><a href="god_spiked.html#cb284-5" aria-hidden="true" tabindex="-1"></a>data_plot_tool <span class="ot">&lt;-</span> data_tool<span class="sc">%&gt;%</span></span>
<span id="cb284-6"><a href="god_spiked.html#cb284-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pareto =</span> loo_tool<span class="sc">$</span>pointwise[,<span class="st">&quot;influence_pareto_k&quot;</span>])<span class="sc">%&gt;%</span> <span class="co"># the pointwise pareto k values are in loo_tool$pointwise</span></span>
<span id="cb284-7"><a href="god_spiked.html#cb284-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Population =</span> population, <span class="st">`</span><span class="at">Log Population (Standardised)</span><span class="st">`</span> <span class="ot">=</span> P)<span class="sc">%&gt;%</span></span>
<span id="cb284-8"><a href="god_spiked.html#cb284-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(<span class="st">&quot;Population&quot;</span>,<span class="st">&quot;Log Population (Standardised)&quot;</span>),<span class="at">names_to =</span> <span class="st">&quot;pop_format&quot;</span>,<span class="at">values_to=</span><span class="st">&quot;pop_value&quot;</span>)</span>
<span id="cb284-9"><a href="god_spiked.html#cb284-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-10"><a href="god_spiked.html#cb284-10" aria-hidden="true" tabindex="-1"></a><span class="do">### Extract draws</span></span>
<span id="cb284-11"><a href="god_spiked.html#cb284-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-12"><a href="god_spiked.html#cb284-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a grid of data points to predict over</span></span>
<span id="cb284-13"><a href="god_spiked.html#cb284-13" aria-hidden="true" tabindex="-1"></a>grid_tool <span class="ot">&lt;-</span> <span class="fu">data_grid</span>(data_tool,</span>
<span id="cb284-14"><a href="god_spiked.html#cb284-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">P=</span><span class="fu">seq_range</span>(P, <span class="at">n =</span> <span class="dv">21</span>))</span>
<span id="cb284-15"><a href="god_spiked.html#cb284-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-16"><a href="god_spiked.html#cb284-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create draws of the parameters in the model</span></span>
<span id="cb284-17"><a href="god_spiked.html#cb284-17" aria-hidden="true" tabindex="-1"></a><span class="co"># You can use the tidybayes function get_variables() to list all the variables you can include</span></span>
<span id="cb284-18"><a href="god_spiked.html#cb284-18" aria-hidden="true" tabindex="-1"></a>draws_tool <span class="ot">&lt;-</span> m11_10 <span class="sc">%&gt;%</span> </span>
<span id="cb284-19"><a href="god_spiked.html#cb284-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(a[cid], b[cid],<span class="at">ndraws=</span><span class="dv">50</span>)<span class="sc">%&gt;%</span></span>
<span id="cb284-20"><a href="god_spiked.html#cb284-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cid=</span><span class="fu">as.factor</span>(cid))</span>
<span id="cb284-21"><a href="god_spiked.html#cb284-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-22"><a href="god_spiked.html#cb284-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Stitch these two data frames together.</span></span>
<span id="cb284-23"><a href="god_spiked.html#cb284-23" aria-hidden="true" tabindex="-1"></a>pred_tool <span class="ot">&lt;-</span> </span>
<span id="cb284-24"><a href="god_spiked.html#cb284-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(grid_tool, draws_tool, <span class="at">by=</span><span class="fu">character</span>())<span class="sc">%&gt;%</span> <span class="co"># cross product of the two data frames</span></span>
<span id="cb284-25"><a href="god_spiked.html#cb284-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>()<span class="sc">%&gt;%</span> <span class="co"># Rowwise for rnorm to work</span></span>
<span id="cb284-26"><a href="god_spiked.html#cb284-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">linpred =</span> <span class="fu">exp</span>( a <span class="sc">+</span> b<span class="sc">*</span>P), <span class="co"># create the linear predictor</span></span>
<span id="cb284-27"><a href="god_spiked.html#cb284-27" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">total_tools</span><span class="st">`</span> <span class="ot">=</span> withr<span class="sc">::</span><span class="fu">with_seed</span>(<span class="dv">71</span>,<span class="fu">rpois</span>(<span class="dv">1</span>,linpred)), <span class="co"># sample from the posterior predictive. seed = 71</span></span>
<span id="cb284-28"><a href="god_spiked.html#cb284-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">nation =</span> <span class="fu">if_else</span>(cid<span class="sc">==</span><span class="dv">1</span>,<span class="st">&quot;Low Contact&quot;</span>,<span class="st">&quot;High Contact&quot;</span>),</span>
<span id="cb284-29"><a href="god_spiked.html#cb284-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">Population =</span> <span class="fu">exp</span>(P<span class="sc">*</span><span class="fu">sd</span>(<span class="fu">log</span>(data_tool<span class="sc">$</span>population))<span class="sc">+</span><span class="fu">mean</span>(<span class="fu">log</span>(data_tool<span class="sc">$</span>population))), <span class="co"># undoing p = scale(log(population))</span></span>
<span id="cb284-30"><a href="god_spiked.html#cb284-30" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Log Population (Standardised)</span><span class="st">`</span> <span class="ot">=</span> P)<span class="sc">%&gt;%</span></span>
<span id="cb284-31"><a href="god_spiked.html#cb284-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()<span class="sc">%&gt;%</span></span>
<span id="cb284-32"><a href="god_spiked.html#cb284-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(<span class="st">&quot;Population&quot;</span>,<span class="st">&quot;Log Population (Standardised)&quot;</span>),<span class="at">names_to =</span> <span class="st">&quot;pop_format&quot;</span>,<span class="at">values_to=</span><span class="st">&quot;pop_value&quot;</span>)</span>
<span id="cb284-33"><a href="god_spiked.html#cb284-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-34"><a href="god_spiked.html#cb284-34" aria-hidden="true" tabindex="-1"></a><span class="do">### Plot both original data and model predictions</span></span>
<span id="cb284-35"><a href="god_spiked.html#cb284-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-36"><a href="god_spiked.html#cb284-36" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_plot_tool,<span class="fu">aes</span>(<span class="at">x=</span>pop_value,<span class="at">y=</span>total_tools,<span class="at">colour=</span>cid))<span class="sc">+</span></span>
<span id="cb284-37"><a href="god_spiked.html#cb284-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_lineribbon</span>(<span class="at">data=</span>pred_tool,<span class="fu">aes</span>(<span class="at">fill=</span>cid),<span class="at">.width =</span> <span class="fl">0.50</span>, <span class="at">alpha=</span><span class="fl">0.4</span>)<span class="sc">+</span></span>
<span id="cb284-38"><a href="god_spiked.html#cb284-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size=</span>pareto))<span class="sc">+</span></span>
<span id="cb284-39"><a href="god_spiked.html#cb284-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>pop_format,<span class="at">scales=</span><span class="st">&quot;free_x&quot;</span>)<span class="sc">+</span></span>
<span id="cb284-40"><a href="god_spiked.html#cb284-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">format</span>(x, <span class="at">scientific =</span> <span class="cn">FALSE</span>))<span class="sc">+</span></span>
<span id="cb284-41"><a href="god_spiked.html#cb284-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb284-42"><a href="god_spiked.html#cb284-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Total Tools&quot;</span>)<span class="sc">+</span></span>
<span id="cb284-43"><a href="god_spiked.html#cb284-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="11-god_spiked_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Here blue dots are high contact, and red low contact societies. The size of the points is relative to their Pareto k-value.</p>
<p>The chapter notes that the model predicts a higher number of tools for low-contact societies than high-contact societies as population increases, and this doesn’t really make sense. It’s an artifact of Hawaii being the only very high population island in the data. The chapter then introduces a more theory-motivated model.</p>
<div id="negative-binomial-models" class="section level4 unnumbered">
<h4>Negative Binomial Models</h4>
<p>The chapter describes an extension of the Poisson generalised linear model that uses the negative binomial distribution. This adds the ability to adjust our model for data over varying exposures. A toy example is introduced to explain.</p>
<p>We own a monastery that produces manuscripts at a rate <span class="math inline">\(\lambda\)</span> of 1.5 per day. We simulate data over a month:</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="god_spiked.html#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">47</span>)</span>
<span id="cb285-2"><a href="god_spiked.html#cb285-2" aria-hidden="true" tabindex="-1"></a>num_days <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb285-3"><a href="god_spiked.html#cb285-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-4"><a href="god_spiked.html#cb285-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rpois</span>(num_days, <span class="fl">1.5</span>)</span></code></pre></div>
<p>We are considering acquiring a new monastery, and want to compare its productivity. However this one does not keep a daily record of manuscript production, but instead a weekly one. The <em>exposure</em> is different: seven days instead of one. Our task will be to model the rate of manuscript production at each monastery in order to inform our purchasing decision.</p>
<p>The (unknown to us) daily rate of the second monastery is actually 0.5 manuscripts per day, and we simulate 4 weeks worth of data on that basis:</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="god_spiked.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">47</span>)</span>
<span id="cb286-2"><a href="god_spiked.html#cb286-2" aria-hidden="true" tabindex="-1"></a>num_weeks <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb286-3"><a href="god_spiked.html#cb286-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-4"><a href="god_spiked.html#cb286-4" aria-hidden="true" tabindex="-1"></a>y_new <span class="ot">&lt;-</span> <span class="fu">rpois</span>(num_weeks, <span class="fl">0.5</span><span class="sc">*</span><span class="dv">7</span>)</span></code></pre></div>
<p>We collect these two sets of data into one data frame.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="god_spiked.html#cb287-1" aria-hidden="true" tabindex="-1"></a>data_manu <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">y_all =</span> <span class="fu">c</span>(y,y_new),</span>
<span id="cb287-2"><a href="god_spiked.html#cb287-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">exposure =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">30</span>),<span class="fu">rep</span>(<span class="dv">7</span>,<span class="dv">4</span>)),</span>
<span id="cb287-3"><a href="god_spiked.html#cb287-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">monastery =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">30</span>),<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">4</span>))) <span class="co"># monastery indicator</span></span></code></pre></div>
<p>The introduction of a new term into our model allows us to compare rates across our varying exposures. This term is the logarithm of the exposure.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="god_spiked.html#cb288-1" aria-hidden="true" tabindex="-1"></a>data_manu <span class="ot">&lt;-</span> data_manu <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">log_exp =</span> <span class="fu">log</span>(exposure))</span>
<span id="cb288-2"><a href="god_spiked.html#cb288-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-3"><a href="god_spiked.html#cb288-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb288-4"><a href="god_spiked.html#cb288-4" aria-hidden="true" tabindex="-1"></a>m11_12 <span class="ot">&lt;-</span> <span class="fu">quap</span>( <span class="fu">alist</span>( </span>
<span id="cb288-5"><a href="god_spiked.html#cb288-5" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> <span class="fu">dpois</span>( lambda ), </span>
<span id="cb288-6"><a href="god_spiked.html#cb288-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> log_exp <span class="sc">+</span> a <span class="sc">+</span> b<span class="sc">*</span>monastery, </span>
<span id="cb288-7"><a href="god_spiked.html#cb288-7" aria-hidden="true" tabindex="-1"></a>  a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">1</span> ), </span>
<span id="cb288-8"><a href="god_spiked.html#cb288-8" aria-hidden="true" tabindex="-1"></a>  b <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">1</span> )</span>
<span id="cb288-9"><a href="god_spiked.html#cb288-9" aria-hidden="true" tabindex="-1"></a>), <span class="at">data=</span>data_manu )</span></code></pre></div>
<p>(For this example we just use the quadratic approximation engine instead of MCMC.)</p>
<p>Why does the addition of this term adjust for the varying exposures?</p>
<p>If we think about <span class="math inline">\(\lambda\)</span> as a rate we can express it as a number of manuscripts <span class="math inline">\(\mu\)</span> produced over a number of days <span class="math inline">\(\tau\)</span>: <span class="math inline">\(\lambda = \mu/\tau\)</span>. If we return to the definition of the Poisson GLM with the log link function we can see how this helps us to scale our rate parameter to adjust for the varying exposures:</p>
<p><span class="math display">\[
\begin{aligned}
y_i &amp;\sim \text{Poisson}(\lambda_i) \\
\log \lambda_i &amp;= \log \left( \frac{\mu_i}{\tau_i} \right)= \alpha + \beta x_i \\
\implies \log \lambda_i &amp;= \log\mu_i - \log\tau_i = \alpha + \beta x_i \\
\implies \log\mu_i &amp;= \log\tau_i + \alpha + \beta x_i \\
\end{aligned}
\]</span>
We define a new model with the exposures on the daily scale.</p>
<p><span class="math display">\[
\begin{aligned}
y_i &amp;\sim \text{Poisson}(\mu_i) \\
\log \mu_i &amp;= \log \tau_i + \alpha + \beta x_i \\
\end{aligned}
\]</span></p>
<p>When the exposure <span class="math inline">\(\tau_i\)</span> equals one, <span class="math inline">\(\log(\tau_i) = 0\)</span> and we get back the initial model.</p>
<p>We can now compare the production of the two monasteries:</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="god_spiked.html#cb289-1" aria-hidden="true" tabindex="-1"></a>post_manu <span class="ot">&lt;-</span> <span class="fu">spread_draws</span>(m11_12,a,b)<span class="sc">%&gt;%</span></span>
<span id="cb289-2"><a href="god_spiked.html#cb289-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lambda_old =</span> <span class="fu">exp</span>(a), <span class="co"># there is no b term since we gave the old monastery the indicator 0 (b*0 = 0). </span></span>
<span id="cb289-3"><a href="god_spiked.html#cb289-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">lambda_new=</span><span class="fu">exp</span>(a<span class="sc">+</span>b))<span class="sc">%&gt;%</span></span>
<span id="cb289-4"><a href="god_spiked.html#cb289-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;lambda&quot;</span>),<span class="at">names_to=</span><span class="st">&quot;model&quot;</span>,<span class="at">values_to=</span><span class="st">&quot;lambda&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb289-5"><a href="god_spiked.html#cb289-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(model)<span class="sc">%&gt;%</span></span>
<span id="cb289-6"><a href="god_spiked.html#cb289-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(lambda,<span class="at">.width=</span><span class="fl">0.89</span>)</span>
<span id="cb289-7"><a href="god_spiked.html#cb289-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb289-8"><a href="god_spiked.html#cb289-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(post_manu, <span class="fu">aes</span>(<span class="at">x=</span>lambda,<span class="at">y=</span>model,<span class="at">xmin=</span>.lower,<span class="at">xmax=</span>.upper))<span class="sc">+</span></span>
<span id="cb289-9"><a href="god_spiked.html#cb289-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>()</span></code></pre></div>
<p><img src="11-god_spiked_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>These are daily rates. We can see that the new monastery is about a third as productive as the old, and we can adjust the price we’re willing to pay accordingly.</p>
</div>
</div>
<div id="multinomial-and-categorical-models" class="section level3 unnumbered">
<h3>Multinomial and Categorical Models</h3>
<p>The chapter introduces the multi-nomial distribution as an extension of the binomial. It has probability mass function:</p>
<p><span class="math display">\[
\text{Pr}(y_i, \dots , y_K | n, p_i, \dots , p_K) = \frac{n!}{\prod_i y_i!} \prod^K_{i=1}p_i^{y_i}
\]</span></p>
<p>Here there are <span class="math inline">\(K\)</span> kinds of events (not just two) and we observe <span class="math inline">\(y_i\)</span> events of each type <span class="math inline">\(i\)</span> over <span class="math inline">\(n\)</span> total trials. Imagine an urn filled with balls of <span class="math inline">\(K\)</span> different colours. We pull <span class="math inline">\(n\)</span> balls from the urn with replacement and count up how many of each colour we get. The</p>
<p><span class="math display">\[
\frac{n!}{\prod_i y_i!}
\]</span>
term is analogous to the</p>
<p><span class="math display">\[
{n \choose y} = \frac{n!}{y! (n-y)!}
\]</span>
term in the binomial PMF.</p>
<p>The equivalent to the inverse logit function we used in the binomial case is called the softmax function, and it looks like this:</p>
<p><span class="math display">\[
\text{Pr}(k| s_1, s_2, \dots, s_K) = \frac{\exp(s_k)}{\sum^K_{i=1} \exp(s_i)}
\]</span>
where <span class="math inline">\(s_i\)</span> is a <em>score</em> assigned to event type <span class="math inline">\(i\)</span>.</p>
<p>To illustrate, the chapter introduces a simulated example. We are trying to model career choice in 500 young adults. There are three career options, each comes with its own expected income.</p>
<p>The following code assigns an income to each career option, converts this to a score, and converts the score to a set of probabilities using the softmax function. Then the 500 individuals pick one of the three options, with the choice weighted by the calculated probabilities. We end up with a vector of length 500, where each entry is one of the three career options.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="god_spiked.html#cb290-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb290-2"><a href="god_spiked.html#cb290-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-3"><a href="god_spiked.html#cb290-3" aria-hidden="true" tabindex="-1"></a>income <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>)</span>
<span id="cb290-4"><a href="god_spiked.html#cb290-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-5"><a href="god_spiked.html#cb290-5" aria-hidden="true" tabindex="-1"></a>score <span class="ot">&lt;-</span> income<span class="sc">*</span><span class="fl">0.5</span></span>
<span id="cb290-6"><a href="god_spiked.html#cb290-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-7"><a href="god_spiked.html#cb290-7" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">softmax</span>(score)</span>
<span id="cb290-8"><a href="god_spiked.html#cb290-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-9"><a href="god_spiked.html#cb290-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-10"><a href="god_spiked.html#cb290-10" aria-hidden="true" tabindex="-1"></a>career <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,N)</span>
<span id="cb290-11"><a href="god_spiked.html#cb290-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-12"><a href="god_spiked.html#cb290-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">71</span>)</span>
<span id="cb290-13"><a href="god_spiked.html#cb290-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N){</span>
<span id="cb290-14"><a href="god_spiked.html#cb290-14" aria-hidden="true" tabindex="-1"></a>  career[i] <span class="ot">&lt;-</span> <span class="fu">sample</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">size =</span><span class="dv">1</span>, <span class="at">prob =</span> p)</span>
<span id="cb290-15"><a href="god_spiked.html#cb290-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb290-16"><a href="god_spiked.html#cb290-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-17"><a href="god_spiked.html#cb290-17" aria-hidden="true" tabindex="-1"></a>data_career <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">N=</span>N , <span class="at">K=</span><span class="dv">3</span> , <span class="at">career=</span>career , <span class="at">career_income=</span>income ) </span></code></pre></div>
<p>The chapter presents the code for the multi-nomial model in raw Stan code.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="god_spiked.html#cb291-1" aria-hidden="true" tabindex="-1"></a>code_m11_13 <span class="ot">&lt;-</span> </span>
<span id="cb291-2"><a href="god_spiked.html#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;data{</span></span>
<span id="cb291-3"><a href="god_spiked.html#cb291-3" aria-hidden="true" tabindex="-1"></a><span class="st">int N; // number of individuals </span></span>
<span id="cb291-4"><a href="god_spiked.html#cb291-4" aria-hidden="true" tabindex="-1"></a><span class="st">int K; // number of possible careers </span></span>
<span id="cb291-5"><a href="god_spiked.html#cb291-5" aria-hidden="true" tabindex="-1"></a><span class="st">int career[N]; // outcome </span></span>
<span id="cb291-6"><a href="god_spiked.html#cb291-6" aria-hidden="true" tabindex="-1"></a><span class="st">vector[K] career_income;</span></span>
<span id="cb291-7"><a href="god_spiked.html#cb291-7" aria-hidden="true" tabindex="-1"></a><span class="st">} </span></span>
<span id="cb291-8"><a href="god_spiked.html#cb291-8" aria-hidden="true" tabindex="-1"></a><span class="st">parameters{</span></span>
<span id="cb291-9"><a href="god_spiked.html#cb291-9" aria-hidden="true" tabindex="-1"></a><span class="st">vector[K-1] a; // intercepts </span></span>
<span id="cb291-10"><a href="god_spiked.html#cb291-10" aria-hidden="true" tabindex="-1"></a><span class="st">real&lt;lower=0&gt; b; // association of income with choice</span></span>
<span id="cb291-11"><a href="god_spiked.html#cb291-11" aria-hidden="true" tabindex="-1"></a><span class="st">} </span></span>
<span id="cb291-12"><a href="god_spiked.html#cb291-12" aria-hidden="true" tabindex="-1"></a><span class="st">model{</span></span>
<span id="cb291-13"><a href="god_spiked.html#cb291-13" aria-hidden="true" tabindex="-1"></a><span class="st">vector[K] p; </span></span>
<span id="cb291-14"><a href="god_spiked.html#cb291-14" aria-hidden="true" tabindex="-1"></a><span class="st">vector[K] s; </span></span>
<span id="cb291-15"><a href="god_spiked.html#cb291-15" aria-hidden="true" tabindex="-1"></a><span class="st">a ~ normal( 0 , 1 ); </span></span>
<span id="cb291-16"><a href="god_spiked.html#cb291-16" aria-hidden="true" tabindex="-1"></a><span class="st">b ~ normal( 0 , 0.5 ); </span></span>
<span id="cb291-17"><a href="god_spiked.html#cb291-17" aria-hidden="true" tabindex="-1"></a><span class="st">s[1] = a[1] + b*career_income[1]; </span></span>
<span id="cb291-18"><a href="god_spiked.html#cb291-18" aria-hidden="true" tabindex="-1"></a><span class="st">s[2] = a[2] + b*career_income[2]; </span></span>
<span id="cb291-19"><a href="god_spiked.html#cb291-19" aria-hidden="true" tabindex="-1"></a><span class="st">s[3] = 0; // pivot </span></span>
<span id="cb291-20"><a href="god_spiked.html#cb291-20" aria-hidden="true" tabindex="-1"></a><span class="st">p = softmax( s ); </span></span>
<span id="cb291-21"><a href="god_spiked.html#cb291-21" aria-hidden="true" tabindex="-1"></a><span class="st">career ~ categorical( p );</span></span>
<span id="cb291-22"><a href="god_spiked.html#cb291-22" aria-hidden="true" tabindex="-1"></a><span class="st">}&quot;</span></span></code></pre></div>
<p>The string of code is fed to Stan:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="god_spiked.html#cb292-1" aria-hidden="true" tabindex="-1"></a>compile_m11_13 <span class="ot">&lt;-</span> <span class="fu">stan_model</span>(<span class="at">model_name =</span> <span class="st">&quot;m11_13&quot;</span>, <span class="at">model_code =</span> code_m11_13)</span>
<span id="cb292-2"><a href="god_spiked.html#cb292-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-3"><a href="god_spiked.html#cb292-3" aria-hidden="true" tabindex="-1"></a>m11_13 <span class="ot">&lt;-</span> <span class="fu">sampling</span>(compile_m11_13, <span class="at">data=</span>data_career,</span>
<span id="cb292-4"><a href="god_spiked.html#cb292-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb292-5"><a href="god_spiked.html#cb292-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-6"><a href="god_spiked.html#cb292-6" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(m11_13,<span class="at">file=</span><span class="st">&quot;models</span><span class="sc">\\</span><span class="st">m11_13.rds&quot;</span>)</span></code></pre></div>
<p>Here’s a summary:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="god_spiked.html#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gather_draws</span>(m11_13, a[i], b)<span class="sc">%&gt;%</span></span>
<span id="cb293-2"><a href="god_spiked.html#cb293-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(<span class="at">.width=</span><span class="fl">0.89</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 8
##       i .variable .value  .lower .upper .width .point .interval
##   &lt;int&gt; &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1     1 a         -2.16  -2.55   -1.87    0.89 mean   qi       
## 2     2 a         -1.82  -2.42   -1.47    0.89 mean   qi       
## 3    NA b          0.150  0.0112  0.431   0.89 mean   qi</code></pre>
<p>Counterfactual simulation - what would doubling the salary of the second career do to the probabilities?</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="god_spiked.html#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">spread_draws</span>(m11_13,a[i], b)<span class="sc">%&gt;%</span></span>
<span id="cb295-2"><a href="god_spiked.html#cb295-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>i,<span class="at">values_from =</span> a)<span class="sc">%&gt;%</span></span>
<span id="cb295-3"><a href="god_spiked.html#cb295-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">a1=</span><span class="st">`</span><span class="at">1</span><span class="st">`</span>,<span class="at">a2=</span><span class="st">`</span><span class="at">2</span><span class="st">`</span>)<span class="sc">%&gt;%</span></span>
<span id="cb295-4"><a href="god_spiked.html#cb295-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">s1 =</span> a1<span class="sc">+</span>b<span class="sc">*</span>income[<span class="dv">1</span>],</span>
<span id="cb295-5"><a href="god_spiked.html#cb295-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">s2_orig =</span> a2<span class="sc">+</span>b<span class="sc">*</span>income[<span class="dv">2</span>], </span>
<span id="cb295-6"><a href="god_spiked.html#cb295-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">s2_new =</span> a2<span class="sc">+</span>b<span class="sc">*</span>income[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">2</span>, <span class="co"># doubling income from the second career</span></span>
<span id="cb295-7"><a href="god_spiked.html#cb295-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_orig =</span> <span class="fu">softmax</span>(s1,s2_orig,<span class="dv">0</span>), <span class="co"># the third career gets a score of 0 as it is the pivot outcome value in the model</span></span>
<span id="cb295-8"><a href="god_spiked.html#cb295-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_new =</span> <span class="fu">softmax</span>(s1,s2_new,<span class="dv">0</span>),</span>
<span id="cb295-9"><a href="god_spiked.html#cb295-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_diff =</span> p_new[,<span class="dv">2</span>] <span class="sc">-</span> p_orig[,<span class="dv">2</span>])<span class="sc">%&gt;%</span></span>
<span id="cb295-10"><a href="god_spiked.html#cb295-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(p_diff, <span class="at">.width =</span><span class="fl">0.89</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##   p_diff  .lower .upper .width .point .interval
##    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 0.0484 0.00309  0.154   0.89 mean   qi</code></pre>
<p>Not sure why I get a 5% increase in probability for career 2 and the chapter gets 13%. May need to revisit. Had a bit of trouble following the last couple of sections in this chapter.</p>
</div>
</div>
<div id="questions-10" class="section level2" number="11.2">
<h2><span class="header-section-number">11.2</span> Questions</h2>
<div id="e1-8" class="section level3 unnumbered">
<h3>11E1</h3>
<div id="question-81" class="section level4 unnumbered">
<h4>Question</h4>
<p>If an event has probability 0.35, what are the log-odds of this event?</p>
</div>
<div id="answer-81" class="section level4 unnumbered">
<h4>Answer</h4>
<p>We expect a ratio of 35 “successes” to 65 “failures,” which equates to odds of <span class="math inline">\(\frac{35}{65} = \frac{7}{13}\)</span>. Taking the natural log of this value gives <span class="math inline">\(-0.62\)</span>.</p>
</div>
</div>
<div id="e2-6" class="section level3 unnumbered">
<h3>11E2</h3>
<div id="question-82" class="section level4 unnumbered">
<h4>Question</h4>
<p>If an event has log-odds 3.2, what is the probability of this event?</p>
</div>
<div id="answer-82" class="section level4 unnumbered">
<h4>Answer</h4>
<p><span class="math display">\[
\begin{aligned}
\exp(3.2) = 24.53 &amp;= \frac{p}{1-p} \\
\implies p &amp;= 0.96
\end{aligned}
\]</span></p>
</div>
</div>
<div id="e3-7" class="section level3 unnumbered">
<h3>11E3</h3>
<div id="question-83" class="section level4 unnumbered">
<h4>Question</h4>
<p>Suppose that a coefficient in a logistic regression has value 1.7. What does this imply about the proportional change in odds of the outcome?</p>
</div>
<div id="answer-83" class="section level4 unnumbered">
<h4>Answer</h4>
<p>This question asks us to compute the <em>relative effect</em> of a parameter. If we exponentiate the coefficient then we get the proportional odds: $ exp(1.7) = 5.47 $ which suggests a 447% increase in the odds of the outcome when we increase the parameter in question by one unit.</p>
<p>As outlined in the Overthinking box on page 337, this works because the ratio in odds that we get with a one unit increase in the parameter is:</p>
<p><span class="math display">\[
\begin{aligned}
q &amp;= \frac{\exp(\alpha + \beta(x_i + 1) )}{\exp(\alpha + \beta(x_i))} = \frac{\exp(\alpha) \exp(\beta x_i) \exp(\beta)}{\exp(\alpha) \exp(\beta x_i)} \\
 &amp;= \exp(\beta)
\end{aligned}
\]</span></p>
</div>
</div>
<div id="e4-6" class="section level3 unnumbered">
<h3>11E4</h3>
<div id="question-84" class="section level4 unnumbered">
<h4>Question</h4>
<p>Why do Poisson regressions sometimes require the use of an offset? Provide an example.</p>
</div>
<div id="answer-84" class="section level4 unnumbered">
<h4>Answer</h4>
<p>Sometimes we get count data reported with varying exposures. The example in the chapter in one monastery reports daily counts of manuscripts produced, and one reports weekly. The offset allows us to compare rates across varying exposures. The offset is the logarithm of the exposure.</p>
<p>Why does the offset adjust for the varying exposures?</p>
<p>If we think about <span class="math inline">\(\lambda\)</span> as a rate we can express it as a number of manuscripts <span class="math inline">\(\mu\)</span> produced over a number of days <span class="math inline">\(\tau\)</span>: <span class="math inline">\(\lambda = \mu/\tau\)</span>. If we return to the definition of the Poisson GLM with the log link function we can see how this helps us to scale our rate parameter to adjust for the varying exposures:</p>
<p><span class="math display">\[
\begin{aligned}
\log \lambda_i &amp;= \log \left( \frac{\mu_i}{\tau_i} \right)= \alpha + \beta x_i \\
\implies \log \lambda_i &amp;= \log\mu_i - \log\tau_i = \alpha + \beta x_i \\
\implies \log\mu_i &amp;= \log\tau_i + \alpha + \beta x_i \\
\end{aligned}
\]</span></p>
<p>We can then define a new model with the exposures on the daily scale.</p>
<p><span class="math display">\[
\begin{aligned}
y_i &amp;\sim \text{Poisson}(\mu_i) \\
\log \mu_i &amp;= \log \tau_i + \alpha + \beta x_i \\
\end{aligned}
\]</span></p>
</div>
</div>
<div id="m1-6" class="section level3 unnumbered">
<h3>11M1</h3>
<div id="question-85" class="section level4 unnumbered">
<h4>Question</h4>
<p>As explained in the chapter, binomial data can be organized in aggregated and disaggregated forms, without any impact on inference. But the likelihood of the data does change when the data are converted between the two formats. Can you explain why?</p>
</div>
<div id="answer-85" class="section level4 unnumbered">
<h4>Answer</h4>
<p>Let’s follow the example explanation in the chapter (page 339) and talk about 9 trials with 6 successes. The likelihood of this data in the aggregate model is</p>
<p><span class="math display">\[
\text{Pr}(6|9,p) = \frac{6!}{6!(9-6)!}p^6(1-p)^{9-6}
\]</span></p>
<p>The fraction on the right hand side is <span class="math inline">\({9 \choose 6}\)</span> which multiplies the likelihood by the number of different ways you could see 6 successes in 9 trials.</p>
<p>The joint probability of the same disaggregated data is</p>
<p><span class="math display">\[
\text{Pr}(1,1,1,1,1,1,0,0,0,p) = p \times p \times p \times p \times p \times p \times (1-p) \times (1-p) \times (1-p) =p^6(1-p)^{9-6}.
\]</span></p>
</div>
</div>
<div id="m2-6" class="section level3 unnumbered">
<h3>11M2</h3>
<div id="question-86" class="section level4 unnumbered">
<h4>Question</h4>
<p>If a coefficient in a Poisson regression has value 1.7, what does this imply about the change in the outcome?</p>
</div>
<div id="answer-86" class="section level4 unnumbered">
<h4>Answer</h4>
<p>In a Possion regression with a log link our parameter is the exponentiation of the linear model:</p>
<p><span class="math display">\[
\log(\mu_i) = \alpha + \beta x_i
\]</span></p>
<p>with a one unit increase in the parameter we get</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\exp(\alpha + \beta(x_i + 1) )}{\exp(\alpha + \beta(x_i))} = \frac{\exp(\alpha) \exp(\beta x_i) \exp(\beta)}{\exp(\alpha) \exp(\beta x_i)}
 = \exp(\beta)
\end{aligned}
\]</span>
Our outcome value has been increased by a factor of <span class="math inline">\(\exp(\beta)\)</span>. In this case if the coefficient has value 1.7, then an increase of one unit in the parameter translates to an outcome value that has increased by a factor of 5.47.</p>
</div>
</div>
<div id="m3-6" class="section level3 unnumbered">
<h3>11M3</h3>
<div id="question-87" class="section level4 unnumbered">
<h4>Question</h4>
<p>Explain why the logit link is appropriate for a binomial generalized linear model.</p>
</div>
<div id="answer-87" class="section level4 unnumbered">
<h4>Answer</h4>
<p>In a binomial GLM we have observed a number of trials where there are two possible outcomes, and we are looking to make inferences about the unobserved “underlying” probabilities that influence these outcomes.</p>
<p>These probabilities must be between zero and one, and an inverse-logit transform of the linear model will constrain the parameter to these values.</p>
</div>
</div>
<div id="m4-4" class="section level3 unnumbered">
<h3>11M4</h3>
<div id="question-88" class="section level4 unnumbered">
<h4>Question</h4>
<p>Explain why the log link is appropriate for a Poisson generalized linear model.</p>
</div>
<div id="answer-88" class="section level4 unnumbered">
<h4>Answer</h4>
<p>In a Poisson GLM our observed outcomes are counts that occur over time or space, and we are looking to make inferences about the unobserved “underlying” rates that influence these outcomes.</p>
<p>A rate must be non-negative, and exponentiation (inverse log) of the linear model will constrain the parameter to these values.</p>
</div>
</div>
<div id="m5-4" class="section level3 unnumbered">
<h3>11M5</h3>
<div id="question-89" class="section level4 unnumbered">
<h4>Question</h4>
<p>What would it imply to use a logit link for the mean of a Poisson generalized linear model? Can you think of a real research problem for which this would make sense?</p>
</div>
<div id="answer-89" class="section level4 unnumbered">
<h4>Answer</h4>
<p>You would be constraining the mean rate to be between 0 and 1. If your research question is considering many small intervals, where for each interval the probability of observing an event is low then a logit function would be suitable.</p>
</div>
</div>
<div id="m6-4" class="section level3 unnumbered">
<h3>11M6</h3>
<div id="question-90" class="section level4 unnumbered">
<h4>Question</h4>
<p>State the constraints for which the binomial and Poisson distributions have maximum entropy. Are the constraints different at all for binomial and Poisson? Why or why not?</p>
</div>
<div id="answer-90" class="section level4 unnumbered">
<h4>Answer</h4>
<p>The binomial distribution has maximum entropy with constraints:</p>
<ol style="list-style-type: decimal">
<li>two unordered events</li>
<li>constant expected value</li>
</ol>
<p>The Poisson distribution is the binomial distribution as <span class="math inline">\(n \to \infty\)</span> and <span class="math inline">\(p \to 0\)</span> as <span class="math inline">\(np\)</span> remains constant. If <span class="math inline">\(n\)</span> is large and <span class="math inline">\(p\)</span> small enough to model with a Poisson distribution, it will have maximum entropy under the same constraints.</p>
</div>
</div>
<div id="m7-2" class="section level3 unnumbered">
<h3>11M7</h3>
<div id="question-91" class="section level4 unnumbered">
<h4>Question</h4>
<p>Use quap to construct a quadratic approximate posterior distribution for the chimpanzee model that includes a unique intercept for each actor, m11.4. Compare the quadratic approximation to the posterior distribution produced instead from MCMC.</p>
<p>Can you explain both the differences and the similarities between the approximate and the MCMC distributions? Relax the prior on the actor intercepts to Normal(0,10). Re-estimate the posterior using both ulam and quap.</p>
<p>Do the differences increase or decrease? Why?</p>
</div>
<div id="answer-91" class="section level4 unnumbered">
<h4>Answer</h4>
<p>Here’s m11.4 using quap instead of ulam:</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="god_spiked.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb297-2"><a href="god_spiked.html#cb297-2" aria-hidden="true" tabindex="-1"></a>m11.<span class="fl">4.</span>quap <span class="ot">&lt;-</span> <span class="fu">quap</span>(<span class="fu">alist</span>( </span>
<span id="cb297-3"><a href="god_spiked.html#cb297-3" aria-hidden="true" tabindex="-1"></a>  pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span> , p ) , </span>
<span id="cb297-4"><a href="god_spiked.html#cb297-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[actor] <span class="sc">+</span> b[treatment] , </span>
<span id="cb297-5"><a href="god_spiked.html#cb297-5" aria-hidden="true" tabindex="-1"></a>  a[actor] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">1.5</span> ), </span>
<span id="cb297-6"><a href="god_spiked.html#cb297-6" aria-hidden="true" tabindex="-1"></a>  b[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> )</span>
<span id="cb297-7"><a href="god_spiked.html#cb297-7" aria-hidden="true" tabindex="-1"></a> ), <span class="at">data=</span>data_chimp)</span></code></pre></div>
<p>And here are the two posterior plots side by side:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="god_spiked.html#cb298-1" aria-hidden="true" tabindex="-1"></a>post_chimp_quap <span class="ot">&lt;-</span> <span class="fu">fun_chimp_post</span>(m11.<span class="fl">4.</span>quap)</span>
<span id="cb298-2"><a href="god_spiked.html#cb298-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-3"><a href="god_spiked.html#cb298-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-4"><a href="god_spiked.html#cb298-4" aria-hidden="true" tabindex="-1"></a>plot_chimp_quap <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">precis</span>(<span class="fu">select</span>(post_chimp_quap,<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">&quot;a&quot;</span>))))<span class="sc">+</span></span>
<span id="cb298-5"><a href="god_spiked.html#cb298-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">rownames</span>(<span class="fu">precis</span>(<span class="fu">select</span>(post_chimp_quap,<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">&quot;a&quot;</span>)))),<span class="at">y=</span>mean,<span class="at">ymin=</span><span class="st">`</span><span class="at">5.5%</span><span class="st">`</span>,<span class="at">ymax=</span><span class="st">`</span><span class="at">94.5%</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb298-6"><a href="god_spiked.html#cb298-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;parameter&quot;</span>)<span class="sc">+</span></span>
<span id="cb298-7"><a href="god_spiked.html#cb298-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;value&quot;</span>)<span class="sc">+</span></span>
<span id="cb298-8"><a href="god_spiked.html#cb298-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb298-9"><a href="god_spiked.html#cb298-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb298-10"><a href="god_spiked.html#cb298-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;quap&quot;</span>)</span>
<span id="cb298-11"><a href="god_spiked.html#cb298-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-12"><a href="god_spiked.html#cb298-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(plot_chimp <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;MCMC&quot;</span>), plot_chimp_quap)</span></code></pre></div>
<p>Here is the same chart after relaxing the actor intercept prior to Normal(0,10).</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="god_spiked.html#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb299-2"><a href="god_spiked.html#cb299-2" aria-hidden="true" tabindex="-1"></a>m11.<span class="fl">4.10</span> <span class="ot">&lt;-</span> <span class="fu">ulam</span>( <span class="fu">alist</span>(</span>
<span id="cb299-3"><a href="god_spiked.html#cb299-3" aria-hidden="true" tabindex="-1"></a>  pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span> , p ) , </span>
<span id="cb299-4"><a href="god_spiked.html#cb299-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[actor] <span class="sc">+</span> b[treatment] , </span>
<span id="cb299-5"><a href="god_spiked.html#cb299-5" aria-hidden="true" tabindex="-1"></a>  a[actor] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">10</span> ), </span>
<span id="cb299-6"><a href="god_spiked.html#cb299-6" aria-hidden="true" tabindex="-1"></a>  b[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> )</span>
<span id="cb299-7"><a href="god_spiked.html#cb299-7" aria-hidden="true" tabindex="-1"></a>) , <span class="at">data=</span>data_chimp , <span class="at">chains=</span><span class="dv">4</span>, <span class="at">cmdstan =</span> <span class="cn">TRUE</span>)</span>
<span id="cb299-8"><a href="god_spiked.html#cb299-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-9"><a href="god_spiked.html#cb299-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb299-10"><a href="god_spiked.html#cb299-10" aria-hidden="true" tabindex="-1"></a>m11.<span class="dv">4</span>.<span class="fl">10.</span>quap <span class="ot">&lt;-</span> <span class="fu">quap</span>(<span class="fu">alist</span>( </span>
<span id="cb299-11"><a href="god_spiked.html#cb299-11" aria-hidden="true" tabindex="-1"></a>  pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span> , p ) , </span>
<span id="cb299-12"><a href="god_spiked.html#cb299-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[actor] <span class="sc">+</span> b[treatment] , </span>
<span id="cb299-13"><a href="god_spiked.html#cb299-13" aria-hidden="true" tabindex="-1"></a>  a[actor] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">10</span> ), </span>
<span id="cb299-14"><a href="god_spiked.html#cb299-14" aria-hidden="true" tabindex="-1"></a>  b[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> )</span>
<span id="cb299-15"><a href="god_spiked.html#cb299-15" aria-hidden="true" tabindex="-1"></a> ), <span class="at">data=</span>data_chimp)</span>
<span id="cb299-16"><a href="god_spiked.html#cb299-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-17"><a href="god_spiked.html#cb299-17" aria-hidden="true" tabindex="-1"></a>post_chimp_10 <span class="ot">&lt;-</span> <span class="fu">fun_chimp_post</span>(m11.<span class="fl">4.10</span>)</span>
<span id="cb299-18"><a href="god_spiked.html#cb299-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-19"><a href="god_spiked.html#cb299-19" aria-hidden="true" tabindex="-1"></a>plot_chimp_10 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">precis</span>(<span class="fu">select</span>(post_chimp_10,<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">&quot;a&quot;</span>))))<span class="sc">+</span></span>
<span id="cb299-20"><a href="god_spiked.html#cb299-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">rownames</span>(<span class="fu">precis</span>(<span class="fu">select</span>(post_chimp_10,<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">&quot;a&quot;</span>)))),<span class="at">y=</span>mean,<span class="at">ymin=</span><span class="st">`</span><span class="at">5.5%</span><span class="st">`</span>,<span class="at">ymax=</span><span class="st">`</span><span class="at">94.5%</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb299-21"><a href="god_spiked.html#cb299-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;parameter&quot;</span>)<span class="sc">+</span></span>
<span id="cb299-22"><a href="god_spiked.html#cb299-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;value&quot;</span>)<span class="sc">+</span></span>
<span id="cb299-23"><a href="god_spiked.html#cb299-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb299-24"><a href="god_spiked.html#cb299-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb299-25"><a href="god_spiked.html#cb299-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;MCMC&quot;</span>)</span>
<span id="cb299-26"><a href="god_spiked.html#cb299-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-27"><a href="god_spiked.html#cb299-27" aria-hidden="true" tabindex="-1"></a>post_chimp_10_quap <span class="ot">&lt;-</span> <span class="fu">fun_chimp_post</span>(m11.<span class="dv">4</span>.<span class="fl">10.</span>quap)</span>
<span id="cb299-28"><a href="god_spiked.html#cb299-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-29"><a href="god_spiked.html#cb299-29" aria-hidden="true" tabindex="-1"></a>plot_chimp_10_quap <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">precis</span>(<span class="fu">select</span>(post_chimp_10_quap,<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">&quot;a&quot;</span>))))<span class="sc">+</span></span>
<span id="cb299-30"><a href="god_spiked.html#cb299-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">rownames</span>(<span class="fu">precis</span>(<span class="fu">select</span>(post_chimp_10_quap,<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">&quot;a&quot;</span>)))),<span class="at">y=</span>mean,<span class="at">ymin=</span><span class="st">`</span><span class="at">5.5%</span><span class="st">`</span>,<span class="at">ymax=</span><span class="st">`</span><span class="at">94.5%</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb299-31"><a href="god_spiked.html#cb299-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;parameter&quot;</span>)<span class="sc">+</span></span>
<span id="cb299-32"><a href="god_spiked.html#cb299-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;value&quot;</span>)<span class="sc">+</span></span>
<span id="cb299-33"><a href="god_spiked.html#cb299-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb299-34"><a href="god_spiked.html#cb299-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb299-35"><a href="god_spiked.html#cb299-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;quap&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="god_spiked.html#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(plot_chimp_10, plot_chimp_10_quap)</span></code></pre></div>
<p>Can’t quite figure out what’s going on here. Don’t think I’ve made a coding error but will have to revisit later.</p>
</div>
</div>
<div id="m8" class="section level3 unnumbered">
<h3>11M8</h3>
<div id="question-92" class="section level4 unnumbered">
<h4>Question</h4>
<p>Revisit the data(Kline) islands example. This time drop Hawaii from the sample and refit the models. What changes do you observe?</p>
</div>
<div id="answer-92" class="section level4 unnumbered">
<h4>Answer</h4>
<p>Here is a comparison of the posterior predictions with and without Hawaii:</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="god_spiked.html#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Kline)</span>
<span id="cb301-2"><a href="god_spiked.html#cb301-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-3"><a href="god_spiked.html#cb301-3" aria-hidden="true" tabindex="-1"></a>data_tool_drop <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Kline)<span class="sc">%&gt;%</span></span>
<span id="cb301-4"><a href="god_spiked.html#cb301-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(culture<span class="sc">!=</span> <span class="st">&quot;Hawaii&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb301-5"><a href="god_spiked.html#cb301-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">P =</span> <span class="fu">scale</span>(<span class="fu">log</span>(population)),          <span class="co"># scale here subtracts the mean and divides by the standard deviation</span></span>
<span id="cb301-6"><a href="god_spiked.html#cb301-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">cid =</span> <span class="fu">if_else</span>(contact<span class="sc">==</span><span class="st">&quot;high&quot;</span>,<span class="dv">2</span>,<span class="dv">1</span>),</span>
<span id="cb301-7"><a href="god_spiked.html#cb301-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">cid =</span> <span class="fu">as_factor</span>(cid))<span class="sc">%&gt;%</span></span>
<span id="cb301-8"><a href="god_spiked.html#cb301-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">T=</span>total_tools, P, cid)</span>
<span id="cb301-9"><a href="god_spiked.html#cb301-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-10"><a href="god_spiked.html#cb301-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb301-11"><a href="god_spiked.html#cb301-11" aria-hidden="true" tabindex="-1"></a>m11.<span class="fl">10.</span>drop <span class="ot">&lt;-</span> <span class="fu">ulam</span>( <span class="fu">alist</span>( </span>
<span id="cb301-12"><a href="god_spiked.html#cb301-12" aria-hidden="true" tabindex="-1"></a>  T <span class="sc">~</span> <span class="fu">dpois</span>( lambda ), </span>
<span id="cb301-13"><a href="god_spiked.html#cb301-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> a[cid] <span class="sc">+</span> b[cid]<span class="sc">*</span>P, </span>
<span id="cb301-14"><a href="god_spiked.html#cb301-14" aria-hidden="true" tabindex="-1"></a>  a[cid] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">3</span> , <span class="fl">0.5</span> ), </span>
<span id="cb301-15"><a href="god_spiked.html#cb301-15" aria-hidden="true" tabindex="-1"></a>  b[cid] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.2</span> )</span>
<span id="cb301-16"><a href="god_spiked.html#cb301-16" aria-hidden="true" tabindex="-1"></a>), <span class="at">data=</span>data_tool_drop , <span class="at">chains=</span><span class="dv">4</span> , <span class="at">log_lik=</span><span class="cn">TRUE</span>, <span class="at">cmdstan =</span> <span class="cn">TRUE</span> )</span>
<span id="cb301-17"><a href="god_spiked.html#cb301-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-18"><a href="god_spiked.html#cb301-18" aria-hidden="true" tabindex="-1"></a>psis_tool_drop <span class="ot">&lt;-</span> <span class="fu">PSIS</span>( m11.<span class="fl">10.</span>drop , <span class="at">pointwise=</span><span class="cn">TRUE</span> )<span class="sc">$</span>k</span>
<span id="cb301-19"><a href="god_spiked.html#cb301-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-20"><a href="god_spiked.html#cb301-20" aria-hidden="true" tabindex="-1"></a><span class="do">###### working on log scale ######</span></span>
<span id="cb301-21"><a href="god_spiked.html#cb301-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-22"><a href="god_spiked.html#cb301-22" aria-hidden="true" tabindex="-1"></a>seq_P <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="at">from=</span><span class="sc">-</span><span class="fl">1.4</span> , <span class="at">to=</span><span class="dv">3</span> , <span class="at">length.out=</span><span class="dv">100</span> )</span>
<span id="cb301-23"><a href="god_spiked.html#cb301-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-24"><a href="god_spiked.html#cb301-24" aria-hidden="true" tabindex="-1"></a><span class="co"># mean and compatibility interval for low contact</span></span>
<span id="cb301-25"><a href="god_spiked.html#cb301-25" aria-hidden="true" tabindex="-1"></a>post_tool_lct <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">link</span>(m11.<span class="fl">10.</span>drop, <span class="at">data=</span> <span class="fu">tibble</span>(<span class="at">P =</span> seq_P, <span class="at">cid =</span> <span class="dv">1</span>)))</span>
<span id="cb301-26"><a href="god_spiked.html#cb301-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-27"><a href="god_spiked.html#cb301-27" aria-hidden="true" tabindex="-1"></a>tool_lct_lower <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(post_tool_lct ,quantile,<span class="at">probs=</span><span class="fl">0.025</span>,<span class="at">names=</span><span class="cn">FALSE</span>)</span>
<span id="cb301-28"><a href="god_spiked.html#cb301-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-29"><a href="god_spiked.html#cb301-29" aria-hidden="true" tabindex="-1"></a>tool_lct_mean <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(post_tool_lct ,mean)</span>
<span id="cb301-30"><a href="god_spiked.html#cb301-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-31"><a href="god_spiked.html#cb301-31" aria-hidden="true" tabindex="-1"></a>tool_lct_upper <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(post_tool_lct ,quantile,<span class="at">probs=</span><span class="fl">0.975</span>,<span class="at">names=</span><span class="cn">FALSE</span>)</span>
<span id="cb301-32"><a href="god_spiked.html#cb301-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-33"><a href="god_spiked.html#cb301-33" aria-hidden="true" tabindex="-1"></a><span class="co"># mean and compatibility interval for high contact</span></span>
<span id="cb301-34"><a href="god_spiked.html#cb301-34" aria-hidden="true" tabindex="-1"></a>post_tool_hct <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">link</span>(m11.<span class="fl">10.</span>drop, <span class="at">data=</span> <span class="fu">tibble</span>(<span class="at">P =</span> seq_P, <span class="at">cid =</span> <span class="dv">2</span>)))</span>
<span id="cb301-35"><a href="god_spiked.html#cb301-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-36"><a href="god_spiked.html#cb301-36" aria-hidden="true" tabindex="-1"></a>tool_hct_lower <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(post_tool_hct ,quantile,<span class="at">probs=</span><span class="fl">0.025</span>,<span class="at">names=</span><span class="cn">FALSE</span>)</span>
<span id="cb301-37"><a href="god_spiked.html#cb301-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-38"><a href="god_spiked.html#cb301-38" aria-hidden="true" tabindex="-1"></a>tool_hct_mean <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(post_tool_hct ,mean)</span>
<span id="cb301-39"><a href="god_spiked.html#cb301-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-40"><a href="god_spiked.html#cb301-40" aria-hidden="true" tabindex="-1"></a>tool_hct_upper <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(post_tool_hct ,quantile,<span class="at">probs=</span><span class="fl">0.975</span>,<span class="at">names=</span><span class="cn">FALSE</span>)</span>
<span id="cb301-41"><a href="god_spiked.html#cb301-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-42"><a href="god_spiked.html#cb301-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-43"><a href="god_spiked.html#cb301-43" aria-hidden="true" tabindex="-1"></a>post_plot_tool <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">log_pop =</span> seq_P, <span class="at">lct_lower =</span> tool_lct_lower, <span class="at">lct_mean =</span> tool_lct_mean, <span class="at">lct_upper =</span> tool_lct_upper,</span>
<span id="cb301-44"><a href="god_spiked.html#cb301-44" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">hct_lower =</span> tool_hct_lower, <span class="at">hct_mean =</span> tool_hct_mean, <span class="at">hct_upper =</span> tool_hct_upper)</span>
<span id="cb301-45"><a href="god_spiked.html#cb301-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-46"><a href="god_spiked.html#cb301-46" aria-hidden="true" tabindex="-1"></a><span class="co"># plot log scale</span></span>
<span id="cb301-47"><a href="god_spiked.html#cb301-47" aria-hidden="true" tabindex="-1"></a>plot_tool_log_drop <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> post_plot_tool)<span class="sc">+</span></span>
<span id="cb301-48"><a href="god_spiked.html#cb301-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">cbind</span>(data_tool_drop,psis_tool_drop), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> P, <span class="at">y =</span> T, <span class="at">size =</span> psis_tool_drop, <span class="at">colour =</span> cid))<span class="sc">+</span></span>
<span id="cb301-49"><a href="god_spiked.html#cb301-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_pop, <span class="at">y =</span> lct_mean), <span class="at">colour=</span> <span class="st">&quot;#F8766D&quot;</span>)<span class="sc">+</span> </span>
<span id="cb301-50"><a href="god_spiked.html#cb301-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> log_pop, <span class="at">y =</span> hct_mean), <span class="at">colour=</span> <span class="st">&quot;#00BFC4&quot;</span>)<span class="sc">+</span> </span>
<span id="cb301-51"><a href="god_spiked.html#cb301-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x=</span>log_pop,<span class="at">ymin=</span>lct_lower,<span class="at">ymax=</span>lct_upper),<span class="at">alpha=</span><span class="fl">0.1</span>,<span class="at">fill=</span><span class="st">&quot;#F8766D&quot;</span>)<span class="sc">+</span></span>
<span id="cb301-52"><a href="god_spiked.html#cb301-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x=</span>log_pop,<span class="at">ymin=</span>hct_lower,<span class="at">ymax=</span>hct_upper),<span class="at">alpha=</span><span class="fl">0.1</span>,<span class="at">fill=</span><span class="st">&quot;#00BFC4&quot;</span>)<span class="sc">+</span></span>
<span id="cb301-53"><a href="god_spiked.html#cb301-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;log population (std)&quot;</span>)<span class="sc">+</span></span>
<span id="cb301-54"><a href="god_spiked.html#cb301-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;total tools&quot;</span>)<span class="sc">+</span></span>
<span id="cb301-55"><a href="god_spiked.html#cb301-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span>  <span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb301-56"><a href="god_spiked.html#cb301-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>))</span>
<span id="cb301-57"><a href="god_spiked.html#cb301-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-58"><a href="god_spiked.html#cb301-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-59"><a href="god_spiked.html#cb301-59" aria-hidden="true" tabindex="-1"></a><span class="do">###### working on population scale ######</span></span>
<span id="cb301-60"><a href="god_spiked.html#cb301-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-61"><a href="god_spiked.html#cb301-61" aria-hidden="true" tabindex="-1"></a>seq_pop <span class="ot">&lt;-</span> <span class="fu">exp</span>( seq_P<span class="sc">*</span><span class="fl">1.53</span> <span class="sc">+</span> <span class="dv">9</span> )    <span class="co"># reversing the effect of the scale function (by multiplying by the sd and adding the mean) then exponentiating</span></span>
<span id="cb301-62"><a href="god_spiked.html#cb301-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-63"><a href="god_spiked.html#cb301-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-64"><a href="god_spiked.html#cb301-64" aria-hidden="true" tabindex="-1"></a>post_plot_tool_pop <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">pop =</span> seq_pop, <span class="at">lct_lower =</span> tool_lct_lower, <span class="at">lct_mean =</span> tool_lct_mean, <span class="at">lct_upper =</span> tool_lct_upper,</span>
<span id="cb301-65"><a href="god_spiked.html#cb301-65" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">hct_lower =</span> tool_hct_lower, <span class="at">hct_mean =</span> tool_hct_mean, <span class="at">hct_upper =</span> tool_hct_upper)</span>
<span id="cb301-66"><a href="god_spiked.html#cb301-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-67"><a href="god_spiked.html#cb301-67" aria-hidden="true" tabindex="-1"></a><span class="co"># plot population scale</span></span>
<span id="cb301-68"><a href="god_spiked.html#cb301-68" aria-hidden="true" tabindex="-1"></a>plot_tool_pop_drop <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> post_plot_tool_pop)<span class="sc">+</span></span>
<span id="cb301-69"><a href="god_spiked.html#cb301-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">cbind</span>(<span class="fu">filter</span>(Kline,culture <span class="sc">!=</span> <span class="st">&quot;Hawaii&quot;</span>),psis_tool_drop), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> population, <span class="at">y =</span> total_tools, <span class="at">size =</span> psis_tool_drop, <span class="at">colour =</span> contact))<span class="sc">+</span></span>
<span id="cb301-70"><a href="god_spiked.html#cb301-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> pop, <span class="at">y =</span> lct_mean), <span class="at">colour=</span> <span class="st">&quot;#F8766D&quot;</span>)<span class="sc">+</span> </span>
<span id="cb301-71"><a href="god_spiked.html#cb301-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> pop, <span class="at">y =</span> hct_mean), <span class="at">colour=</span> <span class="st">&quot;#00BFC4&quot;</span>)<span class="sc">+</span> </span>
<span id="cb301-72"><a href="god_spiked.html#cb301-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x=</span>pop,<span class="at">ymin=</span>lct_lower,<span class="at">ymax=</span>lct_upper),<span class="at">alpha=</span><span class="fl">0.1</span>,<span class="at">fill=</span><span class="st">&quot;#F8766D&quot;</span>)<span class="sc">+</span></span>
<span id="cb301-73"><a href="god_spiked.html#cb301-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x=</span>pop,<span class="at">ymin=</span>hct_lower,<span class="at">ymax=</span>hct_upper),<span class="at">alpha=</span><span class="fl">0.1</span>,<span class="at">fill=</span><span class="st">&quot;#00BFC4&quot;</span>)<span class="sc">+</span></span>
<span id="cb301-74"><a href="god_spiked.html#cb301-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;population&quot;</span>)<span class="sc">+</span></span>
<span id="cb301-75"><a href="god_spiked.html#cb301-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;total tools&quot;</span>)<span class="sc">+</span></span>
<span id="cb301-76"><a href="god_spiked.html#cb301-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span>  <span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb301-77"><a href="god_spiked.html#cb301-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>( <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">300000</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>))<span class="sc">+</span></span>
<span id="cb301-78"><a href="god_spiked.html#cb301-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">format</span>(x, <span class="at">scientific =</span> <span class="cn">FALSE</span>))<span class="sc">+</span></span>
<span id="cb301-79"><a href="god_spiked.html#cb301-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#00BFC4&quot;</span>,<span class="st">&quot;#F8766D&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="god_spiked.html#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(plot_tool_log<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">&quot;With Hawaii&quot;</span>), plot_tool_pop<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">&quot;&quot;</span>),plot_tool_log_drop<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">&quot;Without Hawaii&quot;</span>), plot_tool_pop_drop<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">&quot;&quot;</span>), <span class="at">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
<p>A couple things have changed here. The model is now a lot less confident about high population, low contact societies - the red compatibility interval gets much wider.
Also, as before the model expects that low contact societies will develop fewer tools than high contact societies, except now the prediction is uniform across the data range. Previously the model predicted that over a certain population size more tools would be produced by low contact societies. We now have reason to believe that this crossover point is an artifact of including Hawaii, with it’s large population and large number of tools, and the lack of data on any large population, high contact societies.</p>
<p>One annoying thing about removing Hawaii is that it changes the automatic scaling on the data point sizes - I should revisit this later to set the scaling manually for consistency.</p>
</div>
</div>
<div id="h1-4" class="section level3 unnumbered">
<h3>11H1</h3>
<div id="question-93" class="section level4 unnumbered">
<h4>Question</h4>
<p>Use WAIC or PSIS to compare the chimpanzee model that includes a unique intercept for each actor, m11.4 (page 330), to the simpler models fit in the same section. Interpret the results.</p>
</div>
<div id="answer-93" class="section level4 unnumbered">
<h4>Answer</h4>
<p>Here are the models we’ll be comparing:</p>
<ul>
<li>11.1 - model with no predictors and flat priors</li>
<li>11.2 - model includes treatment (but not actor) as predictor, flat priors</li>
<li>11.3 - model includes treatment (but not actor) as predictor, more informative priors</li>
<li>11.4 - model includes treatment and actor as predictors. more informative priors</li>
</ul>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="god_spiked.html#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="co"># no predictors, flat priors</span></span>
<span id="cb303-2"><a href="god_spiked.html#cb303-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-3"><a href="god_spiked.html#cb303-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb303-4"><a href="god_spiked.html#cb303-4" aria-hidden="true" tabindex="-1"></a>m11<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>( <span class="fu">alist</span>(</span>
<span id="cb303-5"><a href="god_spiked.html#cb303-5" aria-hidden="true" tabindex="-1"></a>pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span> , p ) , </span>
<span id="cb303-6"><a href="god_spiked.html#cb303-6" aria-hidden="true" tabindex="-1"></a><span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a , </span>
<span id="cb303-7"><a href="god_spiked.html#cb303-7" aria-hidden="true" tabindex="-1"></a>a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">10</span> )</span>
<span id="cb303-8"><a href="god_spiked.html#cb303-8" aria-hidden="true" tabindex="-1"></a>) , <span class="at">data=</span>data_chimp )</span>
<span id="cb303-9"><a href="god_spiked.html#cb303-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-10"><a href="god_spiked.html#cb303-10" aria-hidden="true" tabindex="-1"></a><span class="co"># A reminder about how the treatments are coded:</span></span>
<span id="cb303-11"><a href="god_spiked.html#cb303-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-12"><a href="god_spiked.html#cb303-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Right-hand lever delivers food to both ends of the table, and no partner is present.</span></span>
<span id="cb303-13"><a href="god_spiked.html#cb303-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Left-hand lever delivers food to both ends of the table, and no partner is present.</span></span>
<span id="cb303-14"><a href="god_spiked.html#cb303-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Right-hand lever delivers food to both ends of the table, and a partner is present.</span></span>
<span id="cb303-15"><a href="god_spiked.html#cb303-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Left-hand lever delivers food to both ends of the table, and a partner is present.</span></span>
<span id="cb303-16"><a href="god_spiked.html#cb303-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-17"><a href="god_spiked.html#cb303-17" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment as predictor, but not actor. flat priors</span></span>
<span id="cb303-18"><a href="god_spiked.html#cb303-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-19"><a href="god_spiked.html#cb303-19" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb303-20"><a href="god_spiked.html#cb303-20" aria-hidden="true" tabindex="-1"></a>m11<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>( <span class="fu">alist</span>(</span>
<span id="cb303-21"><a href="god_spiked.html#cb303-21" aria-hidden="true" tabindex="-1"></a>pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span> , p ) , </span>
<span id="cb303-22"><a href="god_spiked.html#cb303-22" aria-hidden="true" tabindex="-1"></a><span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a <span class="sc">+</span> b[treatment] , </span>
<span id="cb303-23"><a href="god_spiked.html#cb303-23" aria-hidden="true" tabindex="-1"></a>a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">1.5</span> ), </span>
<span id="cb303-24"><a href="god_spiked.html#cb303-24" aria-hidden="true" tabindex="-1"></a>b[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">10</span> )</span>
<span id="cb303-25"><a href="god_spiked.html#cb303-25" aria-hidden="true" tabindex="-1"></a>) , <span class="at">data=</span>data_chimp )</span>
<span id="cb303-26"><a href="god_spiked.html#cb303-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-27"><a href="god_spiked.html#cb303-27" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment as predictor, but not actor. more informative priors</span></span>
<span id="cb303-28"><a href="god_spiked.html#cb303-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-29"><a href="god_spiked.html#cb303-29" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb303-30"><a href="god_spiked.html#cb303-30" aria-hidden="true" tabindex="-1"></a>m11<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>( <span class="fu">alist</span>(</span>
<span id="cb303-31"><a href="god_spiked.html#cb303-31" aria-hidden="true" tabindex="-1"></a>pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span> , p ) , </span>
<span id="cb303-32"><a href="god_spiked.html#cb303-32" aria-hidden="true" tabindex="-1"></a><span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a <span class="sc">+</span> b[treatment] , </span>
<span id="cb303-33"><a href="god_spiked.html#cb303-33" aria-hidden="true" tabindex="-1"></a>a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">1.5</span> ), </span>
<span id="cb303-34"><a href="god_spiked.html#cb303-34" aria-hidden="true" tabindex="-1"></a>b[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> )</span>
<span id="cb303-35"><a href="god_spiked.html#cb303-35" aria-hidden="true" tabindex="-1"></a>) , <span class="at">data=</span>data_chimp )</span>
<span id="cb303-36"><a href="god_spiked.html#cb303-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-37"><a href="god_spiked.html#cb303-37" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment and actor as predictors. more informative priors</span></span>
<span id="cb303-38"><a href="god_spiked.html#cb303-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-39"><a href="god_spiked.html#cb303-39" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb303-40"><a href="god_spiked.html#cb303-40" aria-hidden="true" tabindex="-1"></a>m11.<span class="fl">4.</span>quap <span class="ot">&lt;-</span> <span class="fu">quap</span>(<span class="fu">alist</span>(</span>
<span id="cb303-41"><a href="god_spiked.html#cb303-41" aria-hidden="true" tabindex="-1"></a>  pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span> , p ) ,</span>
<span id="cb303-42"><a href="god_spiked.html#cb303-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[actor] <span class="sc">+</span> b[treatment] ,</span>
<span id="cb303-43"><a href="god_spiked.html#cb303-43" aria-hidden="true" tabindex="-1"></a>  a[actor] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">1.5</span> ),</span>
<span id="cb303-44"><a href="god_spiked.html#cb303-44" aria-hidden="true" tabindex="-1"></a>  b[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> )</span>
<span id="cb303-45"><a href="god_spiked.html#cb303-45" aria-hidden="true" tabindex="-1"></a> ), <span class="at">data=</span>data_chimp)</span>
<span id="cb303-46"><a href="god_spiked.html#cb303-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-47"><a href="god_spiked.html#cb303-47" aria-hidden="true" tabindex="-1"></a><span class="co"># used the quap version of 11.4 since it is fit with the same algorithm as 11.1-11.3.</span></span>
<span id="cb303-48"><a href="god_spiked.html#cb303-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-49"><a href="god_spiked.html#cb303-49" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(m11<span class="fl">.1</span>,m11<span class="fl">.2</span>,m11<span class="fl">.3</span>,m11.<span class="fl">4.</span>quap)</span></code></pre></div>
<p>It looks like including treatment effect does improve expected accuracy of the model, but it’s nowhere close to as important as including actor. This suggests that the most important predictor of a chimp pulling the left lever is simply handedness, rather than presence / absence of a partner and food for them. Comparing model 2 to 3, it also looks like we have enough data here to overwhelm even very bad priors.</p>
</div>
</div>
<div id="h2-4" class="section level3 unnumbered">
<h3>11H2</h3>
<div id="question-94" class="section level4 unnumbered">
<h4>Question</h4>
<p>The data contained in library(MASS);data(eagles) are records of salmon pirating attempts by Bald Eagles in Washington State. See ?eagles for details. While one eagle feeds, sometimes another will swoop in and try to steal the salmon from it. Call the feeding eagle the “victim” and the thief the “pirate.” Use the available data to build a binomial GLM of successful pirating attempts.</p>
<ol style="list-style-type: lower-alpha">
<li>Consider the following model:</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
y_i &amp;\sim \text{Binomial}(n_i,p_i) \\
\text{logit}(p_i) &amp;=  \alpha + \beta_P P_i + \beta_V V_i + \beta_A A_i \\
\alpha &amp;\sim \text{Normal}(0,1.5) \\
\beta_P, \beta_V, \beta_A &amp;\sim \text{Normal}(0,0.5) 
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(y\)</span> is the number of successful attempts, <span class="math inline">\(n\)</span> is the total number of attempts, <span class="math inline">\(P\)</span> is a dummy variable indicating whether or not the pirate had large body size, <span class="math inline">\(V\)</span> is a dummy variable indicating whether or not the victim had large body size, and finally <span class="math inline">\(A\)</span> is a dummy variable indicating whether or not the pirate was an adult.</p>
<p>Fit the model above to the eagles data, using both quap and ulam. Is the quadratic approximation okay?</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Now interpret the estimates. If the quadratic approximation turned out okay, then it’s okay to use the quap estimates. Otherwise stick to ulam estimates. Then plot the posterior predictions. Compute and display both:</li>
</ol>
<ol style="list-style-type: decimal">
<li><p>the predicted probability of success and its 89% interval for each row in the data, as well as</p></li>
<li><p>the predicted success count and its 89% interval.</p></li>
</ol>
<p>What different information does each type of posterior prediction provide?</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Now try to improve the model. Consider an interaction between the pirate’s size and age (immature or adult). Compare this model to the previous one, using WAIC. Interpret.</li>
</ol>
</div>
<div id="answer-94" class="section level4 unnumbered">
<h4>Answer</h4>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="god_spiked.html#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(eagles)</span>
<span id="cb304-2"><a href="god_spiked.html#cb304-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-3"><a href="god_spiked.html#cb304-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Coding:</span></span>
<span id="cb304-4"><a href="god_spiked.html#cb304-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   For large 0 is small, 1 is large</span></span>
<span id="cb304-5"><a href="god_spiked.html#cb304-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   For adult 0 is immature, 1 is adult</span></span>
<span id="cb304-6"><a href="god_spiked.html#cb304-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-7"><a href="god_spiked.html#cb304-7" aria-hidden="true" tabindex="-1"></a>data_eagles <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(eagles)<span class="sc">%&gt;%</span></span>
<span id="cb304-8"><a href="god_spiked.html#cb304-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pirate_large =</span> <span class="fu">if_else</span>(P <span class="sc">==</span> <span class="st">&quot;S&quot;</span>,<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb304-9"><a href="god_spiked.html#cb304-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">pirate_adult =</span> <span class="fu">if_else</span>(A <span class="sc">==</span> <span class="st">&quot;I&quot;</span>,<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb304-10"><a href="god_spiked.html#cb304-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">victim_large =</span> <span class="fu">if_else</span>(V <span class="sc">==</span> <span class="st">&quot;S&quot;</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb304-11"><a href="god_spiked.html#cb304-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-12"><a href="god_spiked.html#cb304-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb304-13"><a href="god_spiked.html#cb304-13" aria-hidden="true" tabindex="-1"></a>m11.H2a <span class="ot">&lt;-</span> <span class="fu">quap</span>( <span class="fu">alist</span>(</span>
<span id="cb304-14"><a href="god_spiked.html#cb304-14" aria-hidden="true" tabindex="-1"></a>y <span class="sc">~</span> <span class="fu">dbinom</span>( n , p ) , </span>
<span id="cb304-15"><a href="god_spiked.html#cb304-15" aria-hidden="true" tabindex="-1"></a><span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a <span class="sc">+</span> b_p <span class="sc">*</span> pirate_large <span class="sc">+</span> b_a <span class="sc">*</span> pirate_adult <span class="sc">+</span> b_v <span class="sc">*</span> victim_large  , </span>
<span id="cb304-16"><a href="god_spiked.html#cb304-16" aria-hidden="true" tabindex="-1"></a>a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">1.5</span> ) , </span>
<span id="cb304-17"><a href="god_spiked.html#cb304-17" aria-hidden="true" tabindex="-1"></a>b_p <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> ),</span>
<span id="cb304-18"><a href="god_spiked.html#cb304-18" aria-hidden="true" tabindex="-1"></a>b_a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> ),</span>
<span id="cb304-19"><a href="god_spiked.html#cb304-19" aria-hidden="true" tabindex="-1"></a>b_v <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> )</span>
<span id="cb304-20"><a href="god_spiked.html#cb304-20" aria-hidden="true" tabindex="-1"></a>) , <span class="at">data=</span>data_eagles)</span>
<span id="cb304-21"><a href="god_spiked.html#cb304-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-22"><a href="god_spiked.html#cb304-22" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb304-23"><a href="god_spiked.html#cb304-23" aria-hidden="true" tabindex="-1"></a>m11.H2b <span class="ot">&lt;-</span> <span class="fu">ulam</span>( <span class="fu">alist</span>(</span>
<span id="cb304-24"><a href="god_spiked.html#cb304-24" aria-hidden="true" tabindex="-1"></a>y <span class="sc">~</span> <span class="fu">dbinom</span>( n , p ) , </span>
<span id="cb304-25"><a href="god_spiked.html#cb304-25" aria-hidden="true" tabindex="-1"></a><span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a <span class="sc">+</span> b_p <span class="sc">*</span> pirate_large <span class="sc">+</span> b_a <span class="sc">*</span> pirate_adult <span class="sc">+</span> b_v <span class="sc">*</span> victim_large  , </span>
<span id="cb304-26"><a href="god_spiked.html#cb304-26" aria-hidden="true" tabindex="-1"></a>a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">1.5</span> ) , </span>
<span id="cb304-27"><a href="god_spiked.html#cb304-27" aria-hidden="true" tabindex="-1"></a>b_p <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> ),</span>
<span id="cb304-28"><a href="god_spiked.html#cb304-28" aria-hidden="true" tabindex="-1"></a>b_a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> ),</span>
<span id="cb304-29"><a href="god_spiked.html#cb304-29" aria-hidden="true" tabindex="-1"></a>b_v <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> )</span>
<span id="cb304-30"><a href="god_spiked.html#cb304-30" aria-hidden="true" tabindex="-1"></a>) , <span class="at">data=</span>data_eagles, <span class="at">chains=</span><span class="dv">4</span> , <span class="at">log_lik=</span><span class="cn">TRUE</span>, <span class="at">cmdstan =</span> <span class="cn">TRUE</span> )</span>
<span id="cb304-31"><a href="god_spiked.html#cb304-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-32"><a href="god_spiked.html#cb304-32" aria-hidden="true" tabindex="-1"></a><span class="co"># quap model</span></span>
<span id="cb304-33"><a href="god_spiked.html#cb304-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-34"><a href="god_spiked.html#cb304-34" aria-hidden="true" tabindex="-1"></a>extract_11H2a <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">extract.samples</span>(m11.H2a))</span>
<span id="cb304-35"><a href="god_spiked.html#cb304-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-36"><a href="god_spiked.html#cb304-36" aria-hidden="true" tabindex="-1"></a>mean_11H2a <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">8</span>)</span>
<span id="cb304-37"><a href="god_spiked.html#cb304-37" aria-hidden="true" tabindex="-1"></a>lower_11H2a <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">8</span>)</span>
<span id="cb304-38"><a href="god_spiked.html#cb304-38" aria-hidden="true" tabindex="-1"></a>upper_11H2a <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">8</span>)</span>
<span id="cb304-39"><a href="god_spiked.html#cb304-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-40"><a href="god_spiked.html#cb304-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data_eagles)){</span>
<span id="cb304-41"><a href="god_spiked.html#cb304-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb304-42"><a href="god_spiked.html#cb304-42" aria-hidden="true" tabindex="-1"></a>  mean_11H2a[i] <span class="ot">&lt;-</span> <span class="fu">with</span>(data_eagles,<span class="fu">mean</span>(<span class="fu">inverse_logit</span>(</span>
<span id="cb304-43"><a href="god_spiked.html#cb304-43" aria-hidden="true" tabindex="-1"></a>    extract_11H2a<span class="sc">$</span>a <span class="sc">+</span> extract_11H2a<span class="sc">$</span>b_p <span class="sc">*</span> pirate_large[i] <span class="sc">+</span> extract_11H2a<span class="sc">$</span>b_a <span class="sc">*</span> pirate_adult[i] <span class="sc">+</span> extract_11H2a<span class="sc">$</span>b_v <span class="sc">*</span> victim_large[i])))</span>
<span id="cb304-44"><a href="god_spiked.html#cb304-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb304-45"><a href="god_spiked.html#cb304-45" aria-hidden="true" tabindex="-1"></a>  lower_11H2a[i] <span class="ot">&lt;-</span> <span class="fu">with</span>(data_eagles,<span class="fu">quantile</span>(<span class="fu">inverse_logit</span>(</span>
<span id="cb304-46"><a href="god_spiked.html#cb304-46" aria-hidden="true" tabindex="-1"></a>    extract_11H2a<span class="sc">$</span>a <span class="sc">+</span> extract_11H2a<span class="sc">$</span>b_p <span class="sc">*</span> pirate_large[i] <span class="sc">+</span> extract_11H2a<span class="sc">$</span>b_a <span class="sc">*</span> pirate_adult[i] <span class="sc">+</span> extract_11H2a<span class="sc">$</span>b_v <span class="sc">*</span> victim_large[i]),<span class="at">probs=</span><span class="fl">0.055</span>))</span>
<span id="cb304-47"><a href="god_spiked.html#cb304-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb304-48"><a href="god_spiked.html#cb304-48" aria-hidden="true" tabindex="-1"></a>  upper_11H2a[i] <span class="ot">&lt;-</span> <span class="fu">with</span>(data_eagles,<span class="fu">quantile</span>(<span class="fu">inverse_logit</span>(</span>
<span id="cb304-49"><a href="god_spiked.html#cb304-49" aria-hidden="true" tabindex="-1"></a>    extract_11H2a<span class="sc">$</span>a <span class="sc">+</span> extract_11H2a<span class="sc">$</span>b_p <span class="sc">*</span> pirate_large[i] <span class="sc">+</span> extract_11H2a<span class="sc">$</span>b_a <span class="sc">*</span> pirate_adult[i] <span class="sc">+</span> extract_11H2a<span class="sc">$</span>b_v <span class="sc">*</span> victim_large[i]),<span class="at">probs=</span><span class="fl">0.945</span>))</span>
<span id="cb304-50"><a href="god_spiked.html#cb304-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb304-51"><a href="god_spiked.html#cb304-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb304-52"><a href="god_spiked.html#cb304-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-53"><a href="god_spiked.html#cb304-53" aria-hidden="true" tabindex="-1"></a>post_11H2a <span class="ot">&lt;-</span> data_eagles<span class="sc">%&gt;%</span></span>
<span id="cb304-54"><a href="god_spiked.html#cb304-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">lower =</span> lower_11H2a,<span class="at">mean =</span> mean_11H2a,<span class="at">upper =</span> upper_11H2a)<span class="sc">%&gt;%</span></span>
<span id="cb304-55"><a href="god_spiked.html#cb304-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">paste0</span>(P,A,V))<span class="sc">%&gt;%</span></span>
<span id="cb304-56"><a href="god_spiked.html#cb304-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count_lower =</span> n<span class="sc">*</span> lower,</span>
<span id="cb304-57"><a href="god_spiked.html#cb304-57" aria-hidden="true" tabindex="-1"></a>         <span class="at">count_mean =</span> n<span class="sc">*</span> mean,</span>
<span id="cb304-58"><a href="god_spiked.html#cb304-58" aria-hidden="true" tabindex="-1"></a>         <span class="at">count_upper =</span> n<span class="sc">*</span> upper)</span>
<span id="cb304-59"><a href="god_spiked.html#cb304-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-60"><a href="god_spiked.html#cb304-60" aria-hidden="true" tabindex="-1"></a><span class="co"># ulam model</span></span>
<span id="cb304-61"><a href="god_spiked.html#cb304-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-62"><a href="god_spiked.html#cb304-62" aria-hidden="true" tabindex="-1"></a>extract_11H2b <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">extract.samples</span>(m11.H2b))</span>
<span id="cb304-63"><a href="god_spiked.html#cb304-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-64"><a href="god_spiked.html#cb304-64" aria-hidden="true" tabindex="-1"></a>mean_11H2b <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">8</span>)</span>
<span id="cb304-65"><a href="god_spiked.html#cb304-65" aria-hidden="true" tabindex="-1"></a>lower_11H2b <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">8</span>)</span>
<span id="cb304-66"><a href="god_spiked.html#cb304-66" aria-hidden="true" tabindex="-1"></a>upper_11H2b <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">8</span>)</span>
<span id="cb304-67"><a href="god_spiked.html#cb304-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-68"><a href="god_spiked.html#cb304-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data_eagles)){</span>
<span id="cb304-69"><a href="god_spiked.html#cb304-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb304-70"><a href="god_spiked.html#cb304-70" aria-hidden="true" tabindex="-1"></a>  mean_11H2b[i] <span class="ot">&lt;-</span> <span class="fu">with</span>(data_eagles,<span class="fu">mean</span>(<span class="fu">inverse_logit</span>(</span>
<span id="cb304-71"><a href="god_spiked.html#cb304-71" aria-hidden="true" tabindex="-1"></a>    extract_11H2b<span class="sc">$</span>a <span class="sc">+</span> extract_11H2b<span class="sc">$</span>b_p <span class="sc">*</span> pirate_large[i] <span class="sc">+</span> extract_11H2b<span class="sc">$</span>b_a <span class="sc">*</span> pirate_adult[i] <span class="sc">+</span> extract_11H2b<span class="sc">$</span>b_v <span class="sc">*</span> victim_large[i])))</span>
<span id="cb304-72"><a href="god_spiked.html#cb304-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb304-73"><a href="god_spiked.html#cb304-73" aria-hidden="true" tabindex="-1"></a>  lower_11H2b[i] <span class="ot">&lt;-</span> <span class="fu">with</span>(data_eagles,<span class="fu">quantile</span>(<span class="fu">inverse_logit</span>(</span>
<span id="cb304-74"><a href="god_spiked.html#cb304-74" aria-hidden="true" tabindex="-1"></a>    extract_11H2b<span class="sc">$</span>a <span class="sc">+</span> extract_11H2b<span class="sc">$</span>b_p <span class="sc">*</span> pirate_large[i] <span class="sc">+</span> extract_11H2b<span class="sc">$</span>b_a <span class="sc">*</span> pirate_adult[i] <span class="sc">+</span> extract_11H2b<span class="sc">$</span>b_v <span class="sc">*</span> victim_large[i]),<span class="at">probs=</span><span class="fl">0.055</span>))</span>
<span id="cb304-75"><a href="god_spiked.html#cb304-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb304-76"><a href="god_spiked.html#cb304-76" aria-hidden="true" tabindex="-1"></a>  upper_11H2b[i] <span class="ot">&lt;-</span> <span class="fu">with</span>(data_eagles,<span class="fu">quantile</span>(<span class="fu">inverse_logit</span>(</span>
<span id="cb304-77"><a href="god_spiked.html#cb304-77" aria-hidden="true" tabindex="-1"></a>    extract_11H2b<span class="sc">$</span>a <span class="sc">+</span> extract_11H2b<span class="sc">$</span>b_p <span class="sc">*</span> pirate_large[i] <span class="sc">+</span> extract_11H2b<span class="sc">$</span>b_a <span class="sc">*</span> pirate_adult[i] <span class="sc">+</span> extract_11H2b<span class="sc">$</span>b_v <span class="sc">*</span> victim_large[i]),<span class="at">probs=</span><span class="fl">0.945</span>))</span>
<span id="cb304-78"><a href="god_spiked.html#cb304-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb304-79"><a href="god_spiked.html#cb304-79" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb304-80"><a href="god_spiked.html#cb304-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-81"><a href="god_spiked.html#cb304-81" aria-hidden="true" tabindex="-1"></a>post_11H2b <span class="ot">&lt;-</span> data_eagles<span class="sc">%&gt;%</span></span>
<span id="cb304-82"><a href="god_spiked.html#cb304-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">lower =</span> lower_11H2b,<span class="at">mean =</span> mean_11H2b,<span class="at">upper =</span> upper_11H2b)<span class="sc">%&gt;%</span></span>
<span id="cb304-83"><a href="god_spiked.html#cb304-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">paste0</span>(P,A,V))<span class="sc">%&gt;%</span></span>
<span id="cb304-84"><a href="god_spiked.html#cb304-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count_lower =</span> n<span class="sc">*</span> lower,</span>
<span id="cb304-85"><a href="god_spiked.html#cb304-85" aria-hidden="true" tabindex="-1"></a>         <span class="at">count_mean =</span> n<span class="sc">*</span> mean,</span>
<span id="cb304-86"><a href="god_spiked.html#cb304-86" aria-hidden="true" tabindex="-1"></a>         <span class="at">count_upper =</span> n<span class="sc">*</span> upper)</span>
<span id="cb304-87"><a href="god_spiked.html#cb304-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-88"><a href="god_spiked.html#cb304-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-89"><a href="god_spiked.html#cb304-89" aria-hidden="true" tabindex="-1"></a>plot_11H2a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>post_11H2a)<span class="sc">+</span></span>
<span id="cb304-90"><a href="god_spiked.html#cb304-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x=</span>name,<span class="at">y=</span>mean,<span class="at">ymin=</span>lower,<span class="at">ymax=</span>upper))<span class="sc">+</span></span>
<span id="cb304-91"><a href="god_spiked.html#cb304-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;parameter&quot;</span>)<span class="sc">+</span></span>
<span id="cb304-92"><a href="god_spiked.html#cb304-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;value&quot;</span>)<span class="sc">+</span></span>
<span id="cb304-93"><a href="god_spiked.html#cb304-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb304-94"><a href="god_spiked.html#cb304-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb304-95"><a href="god_spiked.html#cb304-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-96"><a href="god_spiked.html#cb304-96" aria-hidden="true" tabindex="-1"></a>plot_11H2b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>post_11H2b)<span class="sc">+</span></span>
<span id="cb304-97"><a href="god_spiked.html#cb304-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x=</span>name,<span class="at">y=</span>mean,<span class="at">ymin=</span>lower,<span class="at">ymax=</span>upper))<span class="sc">+</span></span>
<span id="cb304-98"><a href="god_spiked.html#cb304-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;parameter&quot;</span>)<span class="sc">+</span></span>
<span id="cb304-99"><a href="god_spiked.html#cb304-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;value&quot;</span>)<span class="sc">+</span></span>
<span id="cb304-100"><a href="god_spiked.html#cb304-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb304-101"><a href="god_spiked.html#cb304-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb304-102"><a href="god_spiked.html#cb304-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-103"><a href="god_spiked.html#cb304-103" aria-hidden="true" tabindex="-1"></a>plot_11H2a_count <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>post_11H2a)<span class="sc">+</span></span>
<span id="cb304-104"><a href="god_spiked.html#cb304-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x=</span>name,<span class="at">y=</span>count_mean,<span class="at">ymin=</span>count_lower,<span class="at">ymax=</span>count_upper))<span class="sc">+</span></span>
<span id="cb304-105"><a href="god_spiked.html#cb304-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;parameter&quot;</span>)<span class="sc">+</span></span>
<span id="cb304-106"><a href="god_spiked.html#cb304-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;value&quot;</span>)<span class="sc">+</span></span>
<span id="cb304-107"><a href="god_spiked.html#cb304-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>))<span class="sc">+</span></span>
<span id="cb304-108"><a href="god_spiked.html#cb304-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb304-109"><a href="god_spiked.html#cb304-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-110"><a href="god_spiked.html#cb304-110" aria-hidden="true" tabindex="-1"></a>plot_11H2b_count <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>post_11H2b)<span class="sc">+</span></span>
<span id="cb304-111"><a href="god_spiked.html#cb304-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x=</span>name,<span class="at">y=</span>count_mean,<span class="at">ymin=</span>count_lower,<span class="at">ymax=</span>count_upper))<span class="sc">+</span></span>
<span id="cb304-112"><a href="god_spiked.html#cb304-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;parameter&quot;</span>)<span class="sc">+</span></span>
<span id="cb304-113"><a href="god_spiked.html#cb304-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;value&quot;</span>)<span class="sc">+</span></span>
<span id="cb304-114"><a href="god_spiked.html#cb304-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>))<span class="sc">+</span></span>
<span id="cb304-115"><a href="god_spiked.html#cb304-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="god_spiked.html#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(plot_11H2a<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">&quot;prob quap&quot;</span>),plot_11H2b<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">&quot;prob ulam&quot;</span>),plot_11H2a_count<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">&quot;count quap&quot;</span>),plot_11H2b_count<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">&quot;count ulam&quot;</span>),<span class="at">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
<p>Here the first letter refers to the size of the pirate, large or small. The second refers to whether the pirate is adult or immature. The third refers to the size of the victim.</p>
<p>The plot of probabilities contains information about the proportion of successes expected in each scenario. The count predictions contain information on the number of attempts. The count plot can be thought of as predicting the number of successes for each scenario for 160 trials total.</p>
<p>Here’s a model with an interaction effect between the pirate’s size and age:</p>
<p><span class="math display">\[
\begin{aligned}
y_i &amp;\sim \text{Binomial}(n_i,p_i) \\
\text{logit}(p_i) &amp;=  \alpha + (\beta_P + \beta_A A_i)P_i + \beta_V V_i  \\
\alpha &amp;\sim \text{Normal}(0,1.5) \\
\beta_P, \beta_V, \beta_A &amp;\sim \text{Normal}(0,0.5) 
\end{aligned}
\]</span></p>
<p>Here’s a comparison of the two models by WAIC:</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="god_spiked.html#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb306-2"><a href="god_spiked.html#cb306-2" aria-hidden="true" tabindex="-1"></a>m11.H2c <span class="ot">&lt;-</span> <span class="fu">ulam</span>( <span class="fu">alist</span>(</span>
<span id="cb306-3"><a href="god_spiked.html#cb306-3" aria-hidden="true" tabindex="-1"></a>y <span class="sc">~</span> <span class="fu">dbinom</span>( n , p ) , </span>
<span id="cb306-4"><a href="god_spiked.html#cb306-4" aria-hidden="true" tabindex="-1"></a><span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a <span class="sc">+</span> (b_p <span class="sc">+</span> b_a <span class="sc">*</span> pirate_adult)<span class="sc">*</span>pirate_large  <span class="sc">+</span> b_v <span class="sc">*</span> victim_large  , </span>
<span id="cb306-5"><a href="god_spiked.html#cb306-5" aria-hidden="true" tabindex="-1"></a>a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">1.5</span> ) , </span>
<span id="cb306-6"><a href="god_spiked.html#cb306-6" aria-hidden="true" tabindex="-1"></a>b_p <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> ),</span>
<span id="cb306-7"><a href="god_spiked.html#cb306-7" aria-hidden="true" tabindex="-1"></a>b_a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> ),</span>
<span id="cb306-8"><a href="god_spiked.html#cb306-8" aria-hidden="true" tabindex="-1"></a>b_v <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> )</span>
<span id="cb306-9"><a href="god_spiked.html#cb306-9" aria-hidden="true" tabindex="-1"></a>) , <span class="at">data=</span>data_eagles, <span class="at">chains=</span><span class="dv">4</span> , <span class="at">log_lik=</span><span class="cn">TRUE</span>, <span class="at">cmdstan =</span> <span class="cn">TRUE</span> )</span></code></pre></div>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="god_spiked.html#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(m11.H2b,m11.H2c)</span></code></pre></div>
</div>
</div>
<div id="h3-4" class="section level3 unnumbered">
<h3>11H3</h3>
<div id="question-95" class="section level4 unnumbered">
<h4>Question</h4>
<p>The data contained in data(salamanders) are counts of salamanders (Plethodon elongatus) from <span class="math inline">\(47\)</span> different <span class="math inline">\(49m^2\)</span> plots in northern California. The column SALAMAN is the count in each plot, and the columns PCTCOVER and FORESTAGE are percent of ground cover and age of trees in the plot, respectively. You will model SALAMAN as a Poisson variable.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Model the relationship between density and percent cover, using a log-link (same as the example in the book and lecture). Use weakly informative priors of your choosing. Check the quadratic approximation again, by comparing quap to ulam. Then plot the expected counts and their 89% interval against percent cover. In which ways does the model do a good job? A bad job?</p></li>
<li><p>Can you improve the model by using the other predictor, FORESTAGE? Try any models you think useful. Can you explain why FORESTAGE helps or does not help with prediction?</p></li>
</ol>
</div>
<div id="answer-95" class="section level4 unnumbered">
<h4>Answer</h4>
<p>This is the second questions that asks me to check the performance of the quadratic approximation against Hamiltonian Monte Carlo in ulam before looking at parameter estimates, and I’m not sure how to do this. I’ve been warned against model comparison using WAIC or PSIS when using two different algorithms. I could use a pairs plot to check whether the posterior distribution looks broadly Gaussian. Need to revisit this.</p>
<p>Also I’ve been a bit lazy with my use of ulam over this chapter. I should really be pre-processing all of my variables and only feeding ulam a list of the data I want it to use, rather than a data frame that contains unnecessary columns. Hopefully this will speed up and set me up well for using data with varying lengths once I get to multi-level models.</p>
<p>Alright, this starts off as a fairly straightforward-looking Poisson model, with only percentage ground cover as a predictor. I think it should look like this:</p>
<p><span class="math display">\[
\begin{aligned}
y_i &amp;\sim \text{Poisson}(\lambda_i) \\
\log(\lambda_i) &amp;= \alpha + \beta_{C}(x_i-\bar{x})
\end{aligned}
\]</span></p>
<p>We use the log link since we want our salamander estimates to be non-negative. Here is my data prep:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="god_spiked.html#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;salamanders&quot;</span>)</span>
<span id="cb308-2"><a href="god_spiked.html#cb308-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-3"><a href="god_spiked.html#cb308-3" aria-hidden="true" tabindex="-1"></a><span class="co"># scaling PCTCOVER to be between 0 and 1 and then centering.</span></span>
<span id="cb308-4"><a href="god_spiked.html#cb308-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-5"><a href="god_spiked.html#cb308-5" aria-hidden="true" tabindex="-1"></a>data_sal <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(salamanders)<span class="sc">%&gt;%</span></span>
<span id="cb308-6"><a href="god_spiked.html#cb308-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cov_cen =</span> <span class="fu">scale</span>(PCTCOVER))</span>
<span id="cb308-7"><a href="god_spiked.html#cb308-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-8"><a href="god_spiked.html#cb308-8" aria-hidden="true" tabindex="-1"></a>list_sal <span class="ot">&lt;-</span> <span class="fu">with</span>(data_sal,<span class="fu">list</span>(<span class="at">sal =</span>SALAMAN,<span class="at">cov_cen =</span> cov_cen)) </span></code></pre></div>
<p>And now for some prior simulation. After some messing around I settled on Normal(1.2,1) for the intercept, and Normal(0,0.2) for <span class="math inline">\(\beta_C\)</span>.</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="god_spiked.html#cb309-1" aria-hidden="true" tabindex="-1"></a>plot_prior_11H3a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb309-2"><a href="god_spiked.html#cb309-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">100</span>,<span class="fl">1.2</span>,<span class="dv">1</span>))))<span class="sc">+</span> <span class="co"># intercept only</span></span>
<span id="cb309-3"><a href="god_spiked.html#cb309-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Salamanders&quot;</span>)<span class="sc">+</span></span>
<span id="cb309-4"><a href="god_spiked.html#cb309-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Intercept only: a ~ Normal(1.2,1)&quot;</span>)</span>
<span id="cb309-5"><a href="god_spiked.html#cb309-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-6"><a href="god_spiked.html#cb309-6" aria-hidden="true" tabindex="-1"></a><span class="co"># sequence of predictor values (cover, which is standardised)</span></span>
<span id="cb309-7"><a href="god_spiked.html#cb309-7" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">length.out=</span><span class="dv">100</span>)</span>
<span id="cb309-8"><a href="god_spiked.html#cb309-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-9"><a href="god_spiked.html#cb309-9" aria-hidden="true" tabindex="-1"></a><span class="co"># calculates salamanders for each point in x above, for a Normal(1.2,1) and b Normal(0,0.2). Simulation repeated 50 times.</span></span>
<span id="cb309-10"><a href="god_spiked.html#cb309-10" aria-hidden="true" tabindex="-1"></a>prior_sim_sal <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfc</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, <span class="cf">function</span>(.x) <span class="fu">exp</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="fl">1.2</span>,<span class="dv">1</span>)<span class="sc">+</span> x<span class="sc">*</span><span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="fl">0.2</span>)))<span class="sc">%&gt;%</span></span>
<span id="cb309-11"><a href="god_spiked.html#cb309-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">paste0</span>(<span class="st">&quot;y_&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>))<span class="sc">%&gt;%</span></span>
<span id="cb309-12"><a href="god_spiked.html#cb309-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(x,.)<span class="sc">%&gt;%</span></span>
<span id="cb309-13"><a href="god_spiked.html#cb309-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;y&quot;</span>),<span class="at">names_to =</span> <span class="st">&quot;variable&quot;</span>,<span class="at">values_to =</span> <span class="st">&quot;y_value&quot;</span>)</span>
<span id="cb309-14"><a href="god_spiked.html#cb309-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-15"><a href="god_spiked.html#cb309-15" aria-hidden="true" tabindex="-1"></a><span class="co"># the only trick here is the group aesthetic, which is like colour except it doesn&#39;t do anything but create a new line.</span></span>
<span id="cb309-16"><a href="god_spiked.html#cb309-16" aria-hidden="true" tabindex="-1"></a>plot_prior_11H3b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> prior_sim_sal)<span class="sc">+</span></span>
<span id="cb309-17"><a href="god_spiked.html#cb309-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> y_value,<span class="at">group=</span>variable))<span class="sc">+</span></span>
<span id="cb309-18"><a href="god_spiked.html#cb309-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Salamanders&quot;</span>)<span class="sc">+</span></span>
<span id="cb309-19"><a href="god_spiked.html#cb309-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Cover (std)&quot;</span>)<span class="sc">+</span></span>
<span id="cb309-20"><a href="god_spiked.html#cb309-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;w/ Predictor: b ~ Normal(0,0.2)&quot;</span> )</span>
<span id="cb309-21"><a href="god_spiked.html#cb309-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-22"><a href="god_spiked.html#cb309-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(plot_prior_11H3a,plot_prior_11H3b)</span></code></pre></div>
<p>These prior simulations are displayed two different ways. On the left is a density plot of the number of salamanders in the intercept only model when <span class="math inline">\(a \sim \text{Normal}(1.2,1)\)</span>. The plot on the right shows 50 simulations of how the number of salamanders might vary with the amount of ground cover, when <span class="math inline">\(a\)</span> is as above and <span class="math inline">\(b \sim \text{Normal}(0,0.2)\)</span>.</p>
<p>Now to fit the model and plot the results.</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="god_spiked.html#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb310-2"><a href="god_spiked.html#cb310-2" aria-hidden="true" tabindex="-1"></a>m11.H3a <span class="ot">&lt;-</span> <span class="fu">ulam</span>( <span class="fu">alist</span>(</span>
<span id="cb310-3"><a href="god_spiked.html#cb310-3" aria-hidden="true" tabindex="-1"></a>sal <span class="sc">~</span> <span class="fu">dpois</span>(lambda) , </span>
<span id="cb310-4"><a href="god_spiked.html#cb310-4" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> a <span class="sc">+</span> b_c <span class="sc">*</span> cov_cen  , </span>
<span id="cb310-5"><a href="god_spiked.html#cb310-5" aria-hidden="true" tabindex="-1"></a>a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="fl">1.2</span> , <span class="dv">1</span> ) , </span>
<span id="cb310-6"><a href="god_spiked.html#cb310-6" aria-hidden="true" tabindex="-1"></a>b_c <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.2</span> )</span>
<span id="cb310-7"><a href="god_spiked.html#cb310-7" aria-hidden="true" tabindex="-1"></a>) , <span class="at">data=</span>list_sal, <span class="at">chains=</span><span class="dv">4</span> , <span class="at">log_lik=</span><span class="cn">TRUE</span>, <span class="at">cmdstan =</span> <span class="cn">TRUE</span> )</span></code></pre></div>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="god_spiked.html#cb311-1" aria-hidden="true" tabindex="-1"></a>seq_cov_cen <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(data_sal<span class="sc">$</span>cov_cen),<span class="fu">max</span>(data_sal<span class="sc">$</span>cov_cen),<span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb311-2"><a href="god_spiked.html#cb311-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mean and compatibility interval</span></span>
<span id="cb311-3"><a href="god_spiked.html#cb311-3" aria-hidden="true" tabindex="-1"></a>post_11H3 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">link</span>(m11.H3a, <span class="at">data=</span> <span class="fu">tibble</span>(<span class="at">cov_cen =</span> seq_cov_cen)))</span>
<span id="cb311-4"><a href="god_spiked.html#cb311-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-5"><a href="god_spiked.html#cb311-5" aria-hidden="true" tabindex="-1"></a>sal_lower <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(post_11H3 ,quantile,<span class="at">probs=</span><span class="fl">0.055</span>,<span class="at">names=</span><span class="cn">FALSE</span>)</span>
<span id="cb311-6"><a href="god_spiked.html#cb311-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-7"><a href="god_spiked.html#cb311-7" aria-hidden="true" tabindex="-1"></a>sal_mean <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(post_11H3 ,mean)</span>
<span id="cb311-8"><a href="god_spiked.html#cb311-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-9"><a href="god_spiked.html#cb311-9" aria-hidden="true" tabindex="-1"></a>sal_upper <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(post_11H3 ,quantile,<span class="at">probs=</span><span class="fl">0.945</span>,<span class="at">names=</span><span class="cn">FALSE</span>)</span>
<span id="cb311-10"><a href="god_spiked.html#cb311-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-11"><a href="god_spiked.html#cb311-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-12"><a href="god_spiked.html#cb311-12" aria-hidden="true" tabindex="-1"></a>seq_cov <span class="ot">&lt;-</span> seq_cov_cen<span class="sc">*</span><span class="fu">sd</span>(data_sal<span class="sc">$</span>PCTCOVER) <span class="sc">+</span> <span class="fu">mean</span>(data_sal<span class="sc">$</span>PCTCOVER)    <span class="co"># reversing the effect of the scale function</span></span>
<span id="cb311-13"><a href="god_spiked.html#cb311-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-14"><a href="god_spiked.html#cb311-14" aria-hidden="true" tabindex="-1"></a>post_plot_sal <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">PctCover =</span> seq_cov, <span class="at">lower =</span> sal_lower, <span class="at">mean =</span> sal_mean, <span class="at">upper =</span> sal_upper)</span>
<span id="cb311-15"><a href="god_spiked.html#cb311-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-16"><a href="god_spiked.html#cb311-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> post_plot_sal)<span class="sc">+</span></span>
<span id="cb311-17"><a href="god_spiked.html#cb311-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_sal, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> PCTCOVER, <span class="at">y =</span> SALAMAN, <span class="at">colour =</span> <span class="st">&quot;#F8766D&quot;</span>))<span class="sc">+</span></span>
<span id="cb311-18"><a href="god_spiked.html#cb311-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> PctCover, <span class="at">y =</span> sal_mean), <span class="at">colour=</span> <span class="st">&quot;#F8766D&quot;</span>)<span class="sc">+</span> </span>
<span id="cb311-19"><a href="god_spiked.html#cb311-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x=</span>PctCover,<span class="at">ymin=</span>sal_lower,<span class="at">ymax=</span>sal_upper),<span class="at">alpha=</span><span class="fl">0.1</span>,<span class="at">fill=</span><span class="st">&quot;#F8766D&quot;</span>)<span class="sc">+</span></span>
<span id="cb311-20"><a href="god_spiked.html#cb311-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Pct Cover&quot;</span>)<span class="sc">+</span></span>
<span id="cb311-21"><a href="god_spiked.html#cb311-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Salamanders&quot;</span>)<span class="sc">+</span></span>
<span id="cb311-22"><a href="god_spiked.html#cb311-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span>  <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p>I think the model does a good job of capturing the broad relationship here: salamanders like ground cover. The model does a poor job of capturing the variation above 75%.</p>
<p>The next part of the question asks us to add age of trees into the model, using “any model you think useful.” Just for fun, I might create a new index variable for cover (high or low, with the boundary at 75%) and then plot salamander population against forest age.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="god_spiked.html#cb312-1" aria-hidden="true" tabindex="-1"></a>data_sal_2 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(salamanders)<span class="sc">%&gt;%</span></span>
<span id="cb312-2"><a href="god_spiked.html#cb312-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cov_in =</span> <span class="fu">if_else</span>(PCTCOVER <span class="sc">&gt;=</span> <span class="dv">75</span>,<span class="dv">2</span>,<span class="dv">1</span>),</span>
<span id="cb312-3"><a href="god_spiked.html#cb312-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">cov_in =</span> <span class="fu">as_factor</span>(cov_in),</span>
<span id="cb312-4"><a href="god_spiked.html#cb312-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_std =</span> <span class="fu">scale</span>(FORESTAGE))</span>
<span id="cb312-5"><a href="god_spiked.html#cb312-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-6"><a href="god_spiked.html#cb312-6" aria-hidden="true" tabindex="-1"></a>list_sal_2 <span class="ot">&lt;-</span> <span class="fu">with</span>(data_sal_2,<span class="fu">list</span>(<span class="at">sal =</span>SALAMAN,<span class="at">cov_in =</span> cov_in,<span class="at">age_std=</span>age_std)) </span>
<span id="cb312-7"><a href="god_spiked.html#cb312-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-8"><a href="god_spiked.html#cb312-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb312-9"><a href="god_spiked.html#cb312-9" aria-hidden="true" tabindex="-1"></a>m11.H3b <span class="ot">&lt;-</span> <span class="fu">ulam</span>( <span class="fu">alist</span>( </span>
<span id="cb312-10"><a href="god_spiked.html#cb312-10" aria-hidden="true" tabindex="-1"></a>  sal <span class="sc">~</span> <span class="fu">dpois</span>( lambda ), </span>
<span id="cb312-11"><a href="god_spiked.html#cb312-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> a[cov_in] <span class="sc">+</span> b[cov_in]<span class="sc">*</span>age_std, </span>
<span id="cb312-12"><a href="god_spiked.html#cb312-12" aria-hidden="true" tabindex="-1"></a>  a[cov_in] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="fl">1.2</span> , <span class="dv">1</span> ), </span>
<span id="cb312-13"><a href="god_spiked.html#cb312-13" aria-hidden="true" tabindex="-1"></a>  b[cov_in] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.2</span> )</span>
<span id="cb312-14"><a href="god_spiked.html#cb312-14" aria-hidden="true" tabindex="-1"></a>), <span class="at">data=</span>list_sal_2, <span class="at">chains=</span><span class="dv">4</span> , <span class="at">log_lik=</span><span class="cn">TRUE</span>, <span class="at">cmdstan =</span> <span class="cn">TRUE</span> )</span></code></pre></div>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="god_spiked.html#cb313-1" aria-hidden="true" tabindex="-1"></a>seq_age_std <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(data_sal_2<span class="sc">$</span>age_std),<span class="fu">max</span>(data_sal_2<span class="sc">$</span>age_std),<span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb313-2"><a href="god_spiked.html#cb313-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-3"><a href="god_spiked.html#cb313-3" aria-hidden="true" tabindex="-1"></a><span class="co"># mean and compatibility interval - low cover</span></span>
<span id="cb313-4"><a href="god_spiked.html#cb313-4" aria-hidden="true" tabindex="-1"></a>post_11H3b_lcv <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">link</span>(m11.H3b, <span class="at">data=</span> <span class="fu">tibble</span>(<span class="at">age_std =</span> seq_age_std,<span class="at">cov_in=</span><span class="dv">1</span>)))</span>
<span id="cb313-5"><a href="god_spiked.html#cb313-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-6"><a href="god_spiked.html#cb313-6" aria-hidden="true" tabindex="-1"></a>sal_lcv_lower <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(post_11H3b_lcv ,quantile,<span class="at">probs=</span><span class="fl">0.055</span>,<span class="at">names=</span><span class="cn">FALSE</span>)</span>
<span id="cb313-7"><a href="god_spiked.html#cb313-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-8"><a href="god_spiked.html#cb313-8" aria-hidden="true" tabindex="-1"></a>sal_lcv_mean <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(post_11H3b_lcv ,mean)</span>
<span id="cb313-9"><a href="god_spiked.html#cb313-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-10"><a href="god_spiked.html#cb313-10" aria-hidden="true" tabindex="-1"></a>sal_lcv_upper <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(post_11H3b_lcv ,quantile,<span class="at">probs=</span><span class="fl">0.945</span>,<span class="at">names=</span><span class="cn">FALSE</span>)</span>
<span id="cb313-11"><a href="god_spiked.html#cb313-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-12"><a href="god_spiked.html#cb313-12" aria-hidden="true" tabindex="-1"></a><span class="co"># mean and compatibility interval - high cover</span></span>
<span id="cb313-13"><a href="god_spiked.html#cb313-13" aria-hidden="true" tabindex="-1"></a>post_11H3b_hcv <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">link</span>(m11.H3b, <span class="at">data=</span> <span class="fu">tibble</span>(<span class="at">age_std =</span> seq_age_std,<span class="at">cov_in=</span><span class="dv">2</span>)))</span>
<span id="cb313-14"><a href="god_spiked.html#cb313-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-15"><a href="god_spiked.html#cb313-15" aria-hidden="true" tabindex="-1"></a>sal_hcv_lower <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(post_11H3b_hcv ,quantile,<span class="at">probs=</span><span class="fl">0.055</span>,<span class="at">names=</span><span class="cn">FALSE</span>)</span>
<span id="cb313-16"><a href="god_spiked.html#cb313-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-17"><a href="god_spiked.html#cb313-17" aria-hidden="true" tabindex="-1"></a>sal_hcv_mean <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(post_11H3b_hcv ,mean)</span>
<span id="cb313-18"><a href="god_spiked.html#cb313-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-19"><a href="god_spiked.html#cb313-19" aria-hidden="true" tabindex="-1"></a>sal_hcv_upper <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(post_11H3b_hcv ,quantile,<span class="at">probs=</span><span class="fl">0.945</span>,<span class="at">names=</span><span class="cn">FALSE</span>)</span>
<span id="cb313-20"><a href="god_spiked.html#cb313-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-21"><a href="god_spiked.html#cb313-21" aria-hidden="true" tabindex="-1"></a><span class="co"># reversing the effect of the scale function</span></span>
<span id="cb313-22"><a href="god_spiked.html#cb313-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-23"><a href="god_spiked.html#cb313-23" aria-hidden="true" tabindex="-1"></a>seq_age <span class="ot">&lt;-</span> seq_age_std<span class="sc">*</span><span class="fu">sd</span>(data_sal_2<span class="sc">$</span>FORESTAGE) <span class="sc">+</span> <span class="fu">mean</span>(data_sal_2<span class="sc">$</span>FORESTAGE)    </span>
<span id="cb313-24"><a href="god_spiked.html#cb313-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-25"><a href="god_spiked.html#cb313-25" aria-hidden="true" tabindex="-1"></a>post_plot_sal_b <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">age =</span> seq_age, <span class="at">lcv_lower =</span> sal_lcv_lower, <span class="at">lcv_mean =</span> sal_lcv_mean, <span class="at">lcv_upper =</span> sal_lcv_upper,</span>
<span id="cb313-26"><a href="god_spiked.html#cb313-26" aria-hidden="true" tabindex="-1"></a>                        <span class="at">hcv_lower =</span> sal_hcv_lower, <span class="at">hcv_mean =</span> sal_hcv_mean, <span class="at">hcv_upper =</span> sal_hcv_upper)</span>
<span id="cb313-27"><a href="god_spiked.html#cb313-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-28"><a href="god_spiked.html#cb313-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> post_plot_sal_b)<span class="sc">+</span></span>
<span id="cb313-29"><a href="god_spiked.html#cb313-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_sal_2, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> FORESTAGE, <span class="at">y =</span> SALAMAN, <span class="at">colour =</span> cov_in))<span class="sc">+</span></span>
<span id="cb313-30"><a href="god_spiked.html#cb313-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> seq_age, <span class="at">y =</span> sal_lcv_mean), <span class="at">colour=</span> <span class="st">&quot;#F8766D&quot;</span>)<span class="sc">+</span> </span>
<span id="cb313-31"><a href="god_spiked.html#cb313-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x=</span>seq_age,<span class="at">ymin=</span>sal_lcv_lower,<span class="at">ymax=</span>sal_lcv_upper),<span class="at">alpha=</span><span class="fl">0.1</span>,<span class="at">fill=</span><span class="st">&quot;#F8766D&quot;</span>)<span class="sc">+</span></span>
<span id="cb313-32"><a href="god_spiked.html#cb313-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> seq_age, <span class="at">y =</span> sal_hcv_mean), <span class="at">colour=</span> <span class="st">&quot;#00BFC4&quot;</span>)<span class="sc">+</span> </span>
<span id="cb313-33"><a href="god_spiked.html#cb313-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x=</span>seq_age,<span class="at">ymin=</span>sal_hcv_lower,<span class="at">ymax=</span>sal_hcv_upper),<span class="at">alpha=</span><span class="fl">0.1</span>,<span class="at">fill=</span><span class="st">&quot;#00BFC4&quot;</span>)<span class="sc">+</span></span>
<span id="cb313-34"><a href="god_spiked.html#cb313-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Forest Age&quot;</span>)<span class="sc">+</span></span>
<span id="cb313-35"><a href="god_spiked.html#cb313-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Salamanders&quot;</span>)<span class="sc">+</span></span>
<span id="cb313-36"><a href="god_spiked.html#cb313-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span>  <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p>Here red is low cover, blue is high cover.</p>
<p>The slope should be able to vary here, it looks like forest age doesn’t seem to have much effect no matter the level of cover.</p>
</div>
</div>
<div id="h4-4" class="section level3 unnumbered">
<h3>11H4</h3>
<div id="question-96" class="section level4 unnumbered">
<h4>Question</h4>
<p>The data in data(NWOGrants) are outcomes for scientific funding applications for the Netherlands Organization for Scientific Research (NWO) from 2010–2012 (see van der Lee and Ellemers (2015) for data and context). These data have a very similar structure to the UCBAdmit data discussed in the chapter. I want you to consider a similar question: What are the total and indirect causal effects of gender on grant awards? Consider a mediation path (a pipe) through discipline. Draw the corresponding DAG and then use one or more binomial GLMs to answer the question. What is your causal interpretation? If NWO’s goal is to equalize rates of funding between men and women, what type of intervention would be most effective?</p>
</div>
<div id="answer-96" class="section level4 unnumbered">
<h4>Answer</h4>
<ul>
<li>G - Gender</li>
<li>D - Department</li>
<li>A - Award</li>
</ul>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="god_spiked.html#cb314-1" aria-hidden="true" tabindex="-1"></a>dag_11H4 <span class="ot">&lt;-</span> <span class="fu">dagitty</span>( <span class="st">&quot;dag{ G -&gt; A; D -&gt; A; G-&gt; D }&quot;</span> ) </span>
<span id="cb314-2"><a href="god_spiked.html#cb314-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(dag_11H4) <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">x=</span><span class="fu">c</span>(<span class="at">G=</span><span class="dv">0</span>,<span class="at">D=</span><span class="dv">1</span>,<span class="at">A=</span><span class="dv">2</span>) , <span class="at">y=</span><span class="fu">c</span>(<span class="at">G=</span><span class="dv">0</span>,<span class="at">A=</span><span class="dv">0</span>,<span class="at">D=</span><span class="dv">1</span>) )</span>
<span id="cb314-3"><a href="god_spiked.html#cb314-3" aria-hidden="true" tabindex="-1"></a><span class="fu">drawdag</span>( dag_11H4 )</span></code></pre></div>
<p>I’ll start with a model that only includes gender, and not department. This will give us an estimate of the total effect of gender.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="god_spiked.html#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(NWOGrants)</span>
<span id="cb315-2"><a href="god_spiked.html#cb315-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-3"><a href="god_spiked.html#cb315-3" aria-hidden="true" tabindex="-1"></a>data_11H4 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(NWOGrants)<span class="sc">%&gt;%</span></span>
<span id="cb315-4"><a href="god_spiked.html#cb315-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gen =</span> <span class="fu">if_else</span>(gender<span class="sc">==</span><span class="st">&quot;f&quot;</span>,<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb315-5"><a href="god_spiked.html#cb315-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">dep =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>,<span class="at">each=</span><span class="dv">2</span>))</span>
<span id="cb315-6"><a href="god_spiked.html#cb315-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-7"><a href="god_spiked.html#cb315-7" aria-hidden="true" tabindex="-1"></a>list_11H4 <span class="ot">&lt;-</span> <span class="fu">with</span>(data_11H4,<span class="fu">list</span>(<span class="at">applications=</span>applications, <span class="at">awards=</span>awards,<span class="at">gen=</span>gen))</span>
<span id="cb315-8"><a href="god_spiked.html#cb315-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-9"><a href="god_spiked.html#cb315-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb315-10"><a href="god_spiked.html#cb315-10" aria-hidden="true" tabindex="-1"></a>m11.H4 <span class="ot">&lt;-</span> <span class="fu">ulam</span>( <span class="fu">alist</span>(</span>
<span id="cb315-11"><a href="god_spiked.html#cb315-11" aria-hidden="true" tabindex="-1"></a>awards <span class="sc">~</span> <span class="fu">dbinom</span>( applications , p ) , </span>
<span id="cb315-12"><a href="god_spiked.html#cb315-12" aria-hidden="true" tabindex="-1"></a><span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[gen] , </span>
<span id="cb315-13"><a href="god_spiked.html#cb315-13" aria-hidden="true" tabindex="-1"></a>a[gen] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">1.5</span> )</span>
<span id="cb315-14"><a href="god_spiked.html#cb315-14" aria-hidden="true" tabindex="-1"></a>) , <span class="at">data=</span>list_11H4 , <span class="at">chains=</span><span class="dv">4</span>, <span class="at">cmdstan =</span> <span class="cn">TRUE</span> )</span></code></pre></div>
<p>Here are the results:</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="god_spiked.html#cb316-1" aria-hidden="true" tabindex="-1"></a>post_11H4 <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m11.H4)</span>
<span id="cb316-2"><a href="god_spiked.html#cb316-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-3"><a href="god_spiked.html#cb316-3" aria-hidden="true" tabindex="-1"></a>diff_a <span class="ot">&lt;-</span> post_11H4<span class="sc">$</span>a[,<span class="dv">2</span>] <span class="sc">-</span> post_11H4<span class="sc">$</span>a[,<span class="dv">1</span>] </span>
<span id="cb316-4"><a href="god_spiked.html#cb316-4" aria-hidden="true" tabindex="-1"></a>diff_p <span class="ot">&lt;-</span> <span class="fu">inv_logit</span>(post_11H4<span class="sc">$</span>a[,<span class="dv">2</span>]) <span class="sc">-</span> <span class="fu">inv_logit</span>(post_11H4<span class="sc">$</span>a[,<span class="dv">1</span>])</span>
<span id="cb316-5"><a href="god_spiked.html#cb316-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-6"><a href="god_spiked.html#cb316-6" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>( <span class="fu">list</span>( <span class="at">diff_a=</span>diff_a , <span class="at">diff_p=</span>diff_p ) )[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span></code></pre></div>
<p>On the probability scale, applications from women are 1-5% less likely to succeed.</p>
<p>Now we add department to the model, blocking the pipe to estimate the direct effects on gender.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="god_spiked.html#cb317-1" aria-hidden="true" tabindex="-1"></a>list_11H4b <span class="ot">&lt;-</span> <span class="fu">with</span>(data_11H4,<span class="fu">list</span>(<span class="at">applications=</span>applications, <span class="at">awards=</span>awards,<span class="at">gen=</span>gen,<span class="at">dep=</span>dep))</span>
<span id="cb317-2"><a href="god_spiked.html#cb317-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-3"><a href="god_spiked.html#cb317-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb317-4"><a href="god_spiked.html#cb317-4" aria-hidden="true" tabindex="-1"></a>m11.H4b <span class="ot">&lt;-</span> <span class="fu">ulam</span>( <span class="fu">alist</span>(</span>
<span id="cb317-5"><a href="god_spiked.html#cb317-5" aria-hidden="true" tabindex="-1"></a>awards <span class="sc">~</span> <span class="fu">dbinom</span>( applications , p ) , </span>
<span id="cb317-6"><a href="god_spiked.html#cb317-6" aria-hidden="true" tabindex="-1"></a><span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[gen] <span class="sc">+</span> delta[dep] , </span>
<span id="cb317-7"><a href="god_spiked.html#cb317-7" aria-hidden="true" tabindex="-1"></a>a[gen] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">1.5</span> ),</span>
<span id="cb317-8"><a href="god_spiked.html#cb317-8" aria-hidden="true" tabindex="-1"></a>delta[dep] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">1.5</span> )</span>
<span id="cb317-9"><a href="god_spiked.html#cb317-9" aria-hidden="true" tabindex="-1"></a>) , <span class="at">data=</span>list_11H4b , <span class="at">chains=</span><span class="dv">4</span>, <span class="at">cmdstan =</span> <span class="cn">TRUE</span> )</span></code></pre></div>
<p>And the results:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="god_spiked.html#cb318-1" aria-hidden="true" tabindex="-1"></a>post_11H4b <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m11.H4b)</span>
<span id="cb318-2"><a href="god_spiked.html#cb318-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-3"><a href="god_spiked.html#cb318-3" aria-hidden="true" tabindex="-1"></a>diff_a <span class="ot">&lt;-</span> post_11H4b<span class="sc">$</span>a[,<span class="dv">2</span>] <span class="sc">-</span> post_11H4b<span class="sc">$</span>a[,<span class="dv">1</span>] </span>
<span id="cb318-4"><a href="god_spiked.html#cb318-4" aria-hidden="true" tabindex="-1"></a>diff_p <span class="ot">&lt;-</span> <span class="fu">inv_logit</span>(post_11H4b<span class="sc">$</span>a[,<span class="dv">2</span>]) <span class="sc">-</span> <span class="fu">inv_logit</span>(post_11H4b<span class="sc">$</span>a[,<span class="dv">1</span>]) <span class="co"># taken from the text, but can you do this? logit(p) != a, it = a + delta.  </span></span>
<span id="cb318-5"><a href="god_spiked.html#cb318-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-6"><a href="god_spiked.html#cb318-6" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>( <span class="fu">list</span>( <span class="at">diff_a=</span>diff_a , <span class="at">diff_p=</span>diff_p ) )[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span></code></pre></div>
<p>See comment above, unsure about this one. revisit this.</p>
</div>
</div>
<div id="h5-3" class="section level3 unnumbered">
<h3>11H5</h3>
<div id="question-97" class="section level4 unnumbered">
<h4>Question</h4>
<p>Suppose that the NWO Grants sample has an unobserved confound that influences both choice of discipline and the probability of an award. One example of such a confound could be the career stage of each applicant. Suppose that in some disciplines, junior scholars apply for most of the grants. In other disciplines, scholars from all career stages compete. As a result, career stage influences discipline as well as the probability of being awarded a grant. Add these influences to your DAG from the previous problem.</p>
<p>What happens now when you condition on discipline? Does it provide an un-confounded estimate of the direct path from gender to an award? Why or why not? Justify your answer with the backdoor criterion. If you have trouble thinking this though, try simulating fake data, assuming your DAG is true. Then analyze it using the model from the previous problem. What do you conclude? Is it possible for gender to have a real direct causal influence but for a regression conditioning on both gender and discipline to suggest zero influence?</p>
</div>
<div id="answer-97" class="section level4 unnumbered">
<h4>Answer</h4>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="god_spiked.html#cb319-1" aria-hidden="true" tabindex="-1"></a>dag_11H4b <span class="ot">&lt;-</span> <span class="fu">dagitty</span>( <span class="st">&quot;dag{ C [latent]; G -&gt; A; D -&gt; A; G-&gt; D; C -&gt; D; C-&gt; A }&quot;</span> ) </span>
<span id="cb319-2"><a href="god_spiked.html#cb319-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(dag_11H4b) <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">x=</span><span class="fu">c</span>(<span class="at">G=</span><span class="dv">0</span>,<span class="at">D=</span><span class="dv">1</span>,<span class="at">A=</span><span class="dv">2</span>,<span class="at">C=</span><span class="dv">2</span>) , <span class="at">y=</span><span class="fu">c</span>(<span class="at">G=</span><span class="dv">0</span>,<span class="at">A=</span><span class="dv">0</span>,<span class="at">D=</span><span class="dv">1</span>,<span class="at">C=</span><span class="dv">1</span>) )</span>
<span id="cb319-3"><a href="god_spiked.html#cb319-3" aria-hidden="true" tabindex="-1"></a><span class="fu">drawdag</span>( dag_11H4b )</span></code></pre></div>
</div>
</div>
</div>
<div id="further-resources-1" class="section level2 unnumbered">
<h2>Further Resources</h2>
<p>On the link between Bayesian conditioning and entropy maximisation:</p>
<p>Williams (1980): Bayesian Conditionalisation and the Principle of Minimum Information (<a href="http://www.yaroslavvb.com/papers/williams-conditionalization.pdf" class="uri">http://www.yaroslavvb.com/papers/williams-conditionalization.pdf</a>)</p>
<p>Caticha, A. and Griffin, A. (2007). Updating probabilities. In Mohammad-Djafari, A., editor, Bayesian Inference and Maximum Entropy Methods in Science and Engineering, volume 872 ofAIP Conf. Proc.</p>
<p>Griffin (2008): Maximum Entropy: The Universal Method for Inference (<a href="https://arxiv.org/ftp/arxiv/papers/0901/0901.2987.pdf" class="uri">https://arxiv.org/ftp/arxiv/papers/0901/0901.2987.pdf</a>)</p>
<p>Conrad’s paper deriving various maximum entropy distributions. <a href="https://kconrad.math.uconn.edu/blurbs/analysis/entropypost.pdf" class="uri">https://kconrad.math.uconn.edu/blurbs/analysis/entropypost.pdf</a>
Work through this and fill out the Gaussian and Binomial arguments above.</p>
<p>An example of multinomial logistic regression in the literature:</p>
<ol start="179" style="list-style-type: decimal">
<li>See Koster and McElreath (2017) for a published Stan example with varying effects, applied to behavioral choice.
(<a href="https://pure.mpg.de/rest/items/item_2479179_5/component/file_2479178/content" class="uri">https://pure.mpg.de/rest/items/item_2479179_5/component/file_2479178/content</a>)</li>
</ol>
<p>Subject of question 11.H.2 on logistic regression:</p>
<p>Knight, R. L. and Skagen, S. K. (1988) Agonistic asymmetries and the foraging ecology of Bald Eagles. Ecology 69, 1188–1194.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="big_entropy.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="monsters_mixtures.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/11-god_spiked.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
