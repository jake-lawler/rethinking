<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 14 Adventures in Covariance | Statistical Rethinking Notes</title>
  <meta name="description" content="My notes on Richard McElreath’s ‘Statistical Rethinking.’" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 14 Adventures in Covariance | Statistical Rethinking Notes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="My notes on Richard McElreath’s ‘Statistical Rethinking.’" />
  <meta name="github-repo" content="jake-lawler/rethinking" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 14 Adventures in Covariance | Statistical Rethinking Notes" />
  
  <meta name="twitter:description" content="My notes on Richard McElreath’s ‘Statistical Rethinking.’" />
  

<meta name="author" content="Jake Lawler" />


<meta name="date" content="2022-02-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="models_memory.html"/>
<link rel="next" href="missing_data.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="prague.html"><a href="prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague</a>
<ul>
<li class="chapter" data-level="1.1" data-path="prague.html"><a href="prague.html#chapter-notes"><i class="fa fa-check"></i><b>1.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="1.2" data-path="prague.html"><a href="prague.html#questions"><i class="fa fa-check"></i><b>1.2</b> Questions</a></li>
<li class="chapter" data-level="" data-path="prague.html"><a href="prague.html#further-reading"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small_worlds.html"><a href="small_worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="small_worlds.html"><a href="small_worlds.html#chapter-notes-1"><i class="fa fa-check"></i><b>2.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="2.2" data-path="small_worlds.html"><a href="small_worlds.html#questions-1"><i class="fa fa-check"></i><b>2.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#e1"><i class="fa fa-check"></i>2E1</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#e2"><i class="fa fa-check"></i>2E2</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#e3"><i class="fa fa-check"></i>2E3</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#e4"><i class="fa fa-check"></i>2E4</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#m1"><i class="fa fa-check"></i>2M1</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#m2"><i class="fa fa-check"></i>2M2</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#m3"><i class="fa fa-check"></i>2M3</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#m4"><i class="fa fa-check"></i>2M4</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#m5"><i class="fa fa-check"></i>2M5</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#m6"><i class="fa fa-check"></i>2M6</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#m7"><i class="fa fa-check"></i>2M7</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#h1"><i class="fa fa-check"></i>2H1</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#h2"><i class="fa fa-check"></i>2H2</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#h3"><i class="fa fa-check"></i>2H3</a></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#h4"><i class="fa fa-check"></i>2H4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="small_worlds.html"><a href="small_worlds.html#further-reading-1"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#chapter-notes-2"><i class="fa fa-check"></i><b>3.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="3.2" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#questions-2"><i class="fa fa-check"></i><b>3.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#e1-1"><i class="fa fa-check"></i>3E1</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#e2-1"><i class="fa fa-check"></i>3E2</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#e3-1"><i class="fa fa-check"></i>3E3</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#e4-1"><i class="fa fa-check"></i>3E4</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#e5"><i class="fa fa-check"></i>3E5</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#e6"><i class="fa fa-check"></i>3E6</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#e7"><i class="fa fa-check"></i>3E7</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#m1-1"><i class="fa fa-check"></i>3M1</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#m2-1"><i class="fa fa-check"></i>3M2</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#m3-1"><i class="fa fa-check"></i>3M3</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#m4-1"><i class="fa fa-check"></i>3M4</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#m5-1"><i class="fa fa-check"></i>3M5</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#m6-1"><i class="fa fa-check"></i>3M6</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#h1-1"><i class="fa fa-check"></i>3H1</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#h2-1"><i class="fa fa-check"></i>3H2</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#h3-1"><i class="fa fa-check"></i>3H3</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#h4-1"><i class="fa fa-check"></i>3H4</a></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#h5"><i class="fa fa-check"></i>3H5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sampling_imaginary.html"><a href="sampling_imaginary.html#further-reading-2"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric.html"><a href="geocentric.html"><i class="fa fa-check"></i><b>4</b> Geocentric Models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric.html"><a href="geocentric.html#chapter-notes-3"><i class="fa fa-check"></i><b>4.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="geocentric.html"><a href="geocentric.html#model-using-grid-approximation"><i class="fa fa-check"></i><b>4.1.1</b> Model Using Grid Approximation</a></li>
<li class="chapter" data-level="4.1.2" data-path="geocentric.html"><a href="geocentric.html#model-using-quadratic-approximation"><i class="fa fa-check"></i><b>4.1.2</b> Model Using Quadratic Approximation</a></li>
<li class="chapter" data-level="4.1.3" data-path="geocentric.html"><a href="geocentric.html#adding-predictors"><i class="fa fa-check"></i><b>4.1.3</b> Adding Predictors</a></li>
<li class="chapter" data-level="4.1.4" data-path="geocentric.html"><a href="geocentric.html#polynomial-regression"><i class="fa fa-check"></i><b>4.1.4</b> Polynomial Regression</a></li>
<li class="chapter" data-level="4.1.5" data-path="geocentric.html"><a href="geocentric.html#b-splines"><i class="fa fa-check"></i><b>4.1.5</b> B-Splines</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="geocentric.html"><a href="geocentric.html#questions-3"><i class="fa fa-check"></i><b>4.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#e1-2"><i class="fa fa-check"></i>4E1</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#e2-2"><i class="fa fa-check"></i>4E2</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#e3-2"><i class="fa fa-check"></i>4E3</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#e4-2"><i class="fa fa-check"></i>4E4</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#e5-1"><i class="fa fa-check"></i>4E5</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#m1-2"><i class="fa fa-check"></i>4M1</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#m2-2"><i class="fa fa-check"></i>4M2</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#m3-2"><i class="fa fa-check"></i>4M3</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#m4-2"><i class="fa fa-check"></i>4M4</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#m5-2"><i class="fa fa-check"></i>4M5</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#m6-2"><i class="fa fa-check"></i>4M6</a></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#m7-1"><i class="fa fa-check"></i>4M7</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="geocentric.html"><a href="geocentric.html#further-reading-3"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="many_variables.html"><a href="many_variables.html"><i class="fa fa-check"></i><b>5</b> The Many Variables &amp; The Spurious Waffles</a>
<ul>
<li class="chapter" data-level="5.1" data-path="many_variables.html"><a href="many_variables.html#chapter-notes-4"><i class="fa fa-check"></i><b>5.1</b> Chapter Notes</a></li>
<li class="chapter" data-level="5.2" data-path="many_variables.html"><a href="many_variables.html#questions-4"><i class="fa fa-check"></i><b>5.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="many_variables.html"><a href="many_variables.html#e1-3"><i class="fa fa-check"></i>5E1</a></li>
<li class="chapter" data-level="" data-path="many_variables.html"><a href="many_variables.html#e2-3"><i class="fa fa-check"></i>5E2</a></li>
<li class="chapter" data-level="" data-path="many_variables.html"><a href="many_variables.html#e3-3"><i class="fa fa-check"></i>5E3</a></li>
<li class="chapter" data-level="" data-path="many_variables.html"><a href="many_variables.html#e4-3"><i class="fa fa-check"></i>5E4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="many_variables.html"><a href="many_variables.html#further-reading-4"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="haunted_dag.html"><a href="haunted_dag.html"><i class="fa fa-check"></i><b>6</b> The Haunted DAG &amp; The Causal Terror</a>
<ul>
<li class="chapter" data-level="6.1" data-path="haunted_dag.html"><a href="haunted_dag.html#chapter-notes-5"><i class="fa fa-check"></i><b>6.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#multicollinearity"><i class="fa fa-check"></i>Multicollinearity</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="haunted_dag.html"><a href="haunted_dag.html#questions-5"><i class="fa fa-check"></i><b>6.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#e1-4"><i class="fa fa-check"></i>6E1</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#e3-4"><i class="fa fa-check"></i>6E3</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#e4-4"><i class="fa fa-check"></i>6E4</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#m1-3"><i class="fa fa-check"></i>6M1</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#m2-3"><i class="fa fa-check"></i>6M2</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#m3-3"><i class="fa fa-check"></i>6M3</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#h1-2"><i class="fa fa-check"></i>6H1</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#h2-2"><i class="fa fa-check"></i>6H2</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#h3-2"><i class="fa fa-check"></i>6H3</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#h4-2"><i class="fa fa-check"></i>6H4</a></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#h5-1"><i class="fa fa-check"></i>6H5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="haunted_dag.html"><a href="haunted_dag.html#further-reading-5"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ulysses.html"><a href="ulysses.html"><i class="fa fa-check"></i><b>7</b> Ulysses’ Compass</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ulysses.html"><a href="ulysses.html#chapter-notes-6"><i class="fa fa-check"></i><b>7.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#brain-volume-model"><i class="fa fa-check"></i>Brain Volume model</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#log-pointwise-predictive-density"><i class="fa fa-check"></i>Log Pointwise Predictive Density</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#simulating-in-and-out-of-sample-deviance-for-varying-parameter-numbers"><i class="fa fa-check"></i>Simulating in and out of sample deviance for varying parameter numbers</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ulysses.html"><a href="ulysses.html#questions-6"><i class="fa fa-check"></i><b>7.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#e1-5"><i class="fa fa-check"></i>7E1</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#e2-4"><i class="fa fa-check"></i>7E2</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#e3-5"><i class="fa fa-check"></i>7E3</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#e4-5"><i class="fa fa-check"></i>7E4</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#m1-4"><i class="fa fa-check"></i>7M1</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#m2-4"><i class="fa fa-check"></i>7M2</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#m3-4"><i class="fa fa-check"></i>7M3</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#m4-3"><i class="fa fa-check"></i>7M4</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#m5-3"><i class="fa fa-check"></i>7M5</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#m6-3"><i class="fa fa-check"></i>7M6</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#h1-3"><i class="fa fa-check"></i>7H1</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#h2-3"><i class="fa fa-check"></i>7H2</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#h3-3"><i class="fa fa-check"></i>7H3</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#h4-3"><i class="fa fa-check"></i>7H4</a></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#h5-2"><i class="fa fa-check"></i>7H5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ulysses.html"><a href="ulysses.html#further-reading-6"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditional.html"><a href="conditional.html"><i class="fa fa-check"></i><b>8</b> Conditional Manatees</a>
<ul>
<li class="chapter" data-level="8.1" data-path="conditional.html"><a href="conditional.html#chapter-notes-7"><i class="fa fa-check"></i><b>8.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="conditional.html"><a href="conditional.html#ruggedness-gdp-model"><i class="fa fa-check"></i>Ruggedness &amp; GDP Model</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditional.html"><a href="conditional.html#questions-7"><i class="fa fa-check"></i><b>8.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="conditional.html"><a href="conditional.html#e1-6"><i class="fa fa-check"></i>8E1</a></li>
<li class="chapter" data-level="" data-path="conditional.html"><a href="conditional.html#e2-5"><i class="fa fa-check"></i>8E2</a></li>
<li class="chapter" data-level="" data-path="conditional.html"><a href="conditional.html#e3-6"><i class="fa fa-check"></i>8E3</a></li>
<li class="chapter" data-level="" data-path="conditional.html"><a href="conditional.html#m1-5"><i class="fa fa-check"></i>8M1</a></li>
<li class="chapter" data-level="" data-path="conditional.html"><a href="conditional.html#m2-5"><i class="fa fa-check"></i>8M2</a></li>
<li class="chapter" data-level="" data-path="conditional.html"><a href="conditional.html#m3-5"><i class="fa fa-check"></i>8M3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="markov_chain.html"><a href="markov_chain.html"><i class="fa fa-check"></i><b>9</b> Markov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="9.1" data-path="markov_chain.html"><a href="markov_chain.html#chapter-notes-8"><i class="fa fa-check"></i><b>9.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="markov_chain.html"><a href="markov_chain.html#simulating-king-markovs-journey-a-metropolis-algorithm"><i class="fa fa-check"></i>Simulating King Markov’s Journey (A Metropolis Algorithm)</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="markov_chain.html"><a href="markov_chain.html#questions-8"><i class="fa fa-check"></i><b>9.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="markov_chain.html"><a href="markov_chain.html#e1-7"><i class="fa fa-check"></i>9E1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov_chain.html"><a href="markov_chain.html#further-reading-7"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big_entropy.html"><a href="big_entropy.html"><i class="fa fa-check"></i><b>10</b> Big Entropy and the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="10.1" data-path="big_entropy.html"><a href="big_entropy.html#chapter-notes-9"><i class="fa fa-check"></i><b>10.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="big_entropy.html"><a href="big_entropy.html#maximum-entropy"><i class="fa fa-check"></i>Maximum Entropy</a></li>
<li class="chapter" data-level="" data-path="big_entropy.html"><a href="big_entropy.html#generalized-linear-models"><i class="fa fa-check"></i>Generalized Linear Models</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="big_entropy.html"><a href="big_entropy.html#questions-9"><i class="fa fa-check"></i><b>10.2</b> Questions</a></li>
<li class="chapter" data-level="" data-path="big_entropy.html"><a href="big_entropy.html#further-resources"><i class="fa fa-check"></i>Further Resources</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="god_spiked.html"><a href="god_spiked.html"><i class="fa fa-check"></i><b>11</b> God Spiked the Integers</a>
<ul>
<li class="chapter" data-level="11.1" data-path="god_spiked.html"><a href="god_spiked.html#chapter-notes-10"><i class="fa fa-check"></i><b>11.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#binomial-regression"><i class="fa fa-check"></i>Binomial Regression</a></li>
<li class="chapter" data-level="11.1.1" data-path="god_spiked.html"><a href="god_spiked.html#poisson-regression"><i class="fa fa-check"></i><b>11.1.1</b> Poisson Regression</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#multinomial-and-categorical-models"><i class="fa fa-check"></i>Multinomial and Categorical Models</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="god_spiked.html"><a href="god_spiked.html#questions-10"><i class="fa fa-check"></i><b>11.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#e1-8"><i class="fa fa-check"></i>11E1</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#e2-6"><i class="fa fa-check"></i>11E2</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#e3-7"><i class="fa fa-check"></i>11E3</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#e4-6"><i class="fa fa-check"></i>11E4</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#m1-6"><i class="fa fa-check"></i>11M1</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#m2-6"><i class="fa fa-check"></i>11M2</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#m3-6"><i class="fa fa-check"></i>11M3</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#m4-4"><i class="fa fa-check"></i>11M4</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#m5-4"><i class="fa fa-check"></i>11M5</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#m6-4"><i class="fa fa-check"></i>11M6</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#m7-2"><i class="fa fa-check"></i>11M7</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#m8"><i class="fa fa-check"></i>11M8</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#h1-4"><i class="fa fa-check"></i>11H1</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#h2-4"><i class="fa fa-check"></i>11H2</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#h3-4"><i class="fa fa-check"></i>11H3</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#h4-4"><i class="fa fa-check"></i>11H4</a></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#h5-3"><i class="fa fa-check"></i>11H5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="god_spiked.html"><a href="god_spiked.html#further-resources-1"><i class="fa fa-check"></i>Further Resources</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="monsters_mixtures.html"><a href="monsters_mixtures.html"><i class="fa fa-check"></i><b>12</b> Monsters and Mixtures</a>
<ul>
<li class="chapter" data-level="12.1" data-path="monsters_mixtures.html"><a href="monsters_mixtures.html#chapter-notes-11"><i class="fa fa-check"></i><b>12.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="monsters_mixtures.html"><a href="monsters_mixtures.html#over-dispersed-counts"><i class="fa fa-check"></i>Over-Dispersed Counts</a></li>
<li class="chapter" data-level="" data-path="monsters_mixtures.html"><a href="monsters_mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i>Zero-Inflated Outcomes</a></li>
<li class="chapter" data-level="" data-path="monsters_mixtures.html"><a href="monsters_mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i>Ordered Categorical Outcomes</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="monsters_mixtures.html"><a href="monsters_mixtures.html#questions-11"><i class="fa fa-check"></i><b>12.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="monsters_mixtures.html"><a href="monsters_mixtures.html#e1-9"><i class="fa fa-check"></i>12E1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="monsters_mixtures.html"><a href="monsters_mixtures.html#further-resources-2"><i class="fa fa-check"></i>Further Resources</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="models_memory.html"><a href="models_memory.html"><i class="fa fa-check"></i><b>13</b> Models With Memory</a>
<ul>
<li class="chapter" data-level="13.1" data-path="models_memory.html"><a href="models_memory.html#chapter-notes-12"><i class="fa fa-check"></i><b>13.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="models_memory.html"><a href="models_memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i>More Than One Type of Cluster</a></li>
<li class="chapter" data-level="" data-path="models_memory.html"><a href="models_memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i>Divergent Transitions and Non-Centered Priors</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="models_memory.html"><a href="models_memory.html#questions-12"><i class="fa fa-check"></i><b>13.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="models_memory.html"><a href="models_memory.html#e1-10"><i class="fa fa-check"></i>13E1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="models_memory.html"><a href="models_memory.html#further-resources-3"><i class="fa fa-check"></i>Further Resources</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="covariance.html"><a href="covariance.html"><i class="fa fa-check"></i><b>14</b> Adventures in Covariance</a>
<ul>
<li class="chapter" data-level="14.1" data-path="covariance.html"><a href="covariance.html#chapter-notes-13"><i class="fa fa-check"></i><b>14.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="covariance.html"><a href="covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i>Varying Slopes by Construction</a></li>
<li class="chapter" data-level="" data-path="covariance.html"><a href="covariance.html#instruments-and-causal-designs"><i class="fa fa-check"></i>Instruments and Causal Designs</a></li>
<li class="chapter" data-level="" data-path="covariance.html"><a href="covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i>Continuous Categories and the Gaussian Process</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="covariance.html"><a href="covariance.html#questions-13"><i class="fa fa-check"></i><b>14.2</b> Questions</a>
<ul>
<li class="chapter" data-level="" data-path="covariance.html"><a href="covariance.html#e1-11"><i class="fa fa-check"></i>14E1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="covariance.html"><a href="covariance.html#further-resources-4"><i class="fa fa-check"></i>Further Resources</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="missing_data.html"><a href="missing_data.html"><i class="fa fa-check"></i><b>15</b> Missing Data and Other Opportunities</a>
<ul>
<li class="chapter" data-level="15.1" data-path="missing_data.html"><a href="missing_data.html#chapter-notes-14"><i class="fa fa-check"></i><b>15.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="missing_data.html"><a href="missing_data.html#measurement-error"><i class="fa fa-check"></i>Measurement Error</a></li>
<li class="chapter" data-level="" data-path="missing_data.html"><a href="missing_data.html#missing-data"><i class="fa fa-check"></i>Missing Data</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="missing_data.html"><a href="missing_data.html#questions-14"><i class="fa fa-check"></i><b>15.2</b> Questions</a></li>
<li class="chapter" data-level="" data-path="missing_data.html"><a href="missing_data.html#further-reading-8"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="generalized.html"><a href="generalized.html"><i class="fa fa-check"></i><b>16</b> Generalized Linear Madness</a>
<ul>
<li class="chapter" data-level="16.1" data-path="generalized.html"><a href="generalized.html#chapter-notes-15"><i class="fa fa-check"></i><b>16.1</b> Chapter Notes</a>
<ul>
<li class="chapter" data-level="" data-path="generalized.html"><a href="generalized.html#geometric-people"><i class="fa fa-check"></i>Geometric People</a></li>
<li class="chapter" data-level="" data-path="generalized.html"><a href="generalized.html#hidden-minds-and-observed-behaviour"><i class="fa fa-check"></i>Hidden Minds and Observed Behaviour</a></li>
<li class="chapter" data-level="" data-path="generalized.html"><a href="generalized.html#ordinary-differential-nut-cracking"><i class="fa fa-check"></i>Ordinary Differential Nut Cracking</a></li>
<li class="chapter" data-level="" data-path="generalized.html"><a href="generalized.html#population-dynamics"><i class="fa fa-check"></i>Population Dynamics</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="generalized.html"><a href="generalized.html#questions-15"><i class="fa fa-check"></i><b>16.2</b> Questions</a></li>
<li class="chapter" data-level="" data-path="generalized.html"><a href="generalized.html#further-reading-9"><i class="fa fa-check"></i>Further Reading</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Rethinking Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="covariance" class="section level1" number="14">
<h1><span class="header-section-number">Chapter 14</span> Adventures in Covariance</h1>
<div id="chapter-notes-13" class="section level2" number="14.1">
<h2><span class="header-section-number">14.1</span> Chapter Notes</h2>
<div id="varying-slopes-by-construction" class="section level3 unnumbered">
<h3>Varying Slopes by Construction</h3>
<p>The chapter introduces a simulation exercise to explain varying effects models. We have a population of cafes, and are interested in waiting times. As in the previous chapter, we’ll allow intercepts to vary, with partial pooling across cafes. But we’re also interested in the effect of the predictor afternoon (i.e. whether you are getting coffee in the morning or afternoon). We want to also allow the slopes to vary, and to pool across cafes. This is a <em>varying effects</em> strategy.</p>
<p>More than this, the key addition here is that we also want to allow our intercepts and slopes to covary, pooling information across intercepts and slopes.</p>
<p>We’re going to use a multi-variate normal distribution to generate a population of cafes. We need a vector of means and a variance-covariance matrix:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="covariance.html#cb249-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fl">3.5</span> </span>
<span id="cb249-2"><a href="covariance.html#cb249-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb249-3"><a href="covariance.html#cb249-3" aria-hidden="true" tabindex="-1"></a>sigma_a <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb249-4"><a href="covariance.html#cb249-4" aria-hidden="true" tabindex="-1"></a>sigma_b <span class="ot">&lt;-</span> <span class="fl">0.5</span> </span>
<span id="cb249-5"><a href="covariance.html#cb249-5" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="fl">0.7</span>)</span>
<span id="cb249-6"><a href="covariance.html#cb249-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-7"><a href="covariance.html#cb249-7" aria-hidden="true" tabindex="-1"></a>Mu <span class="ot">&lt;-</span> <span class="fu">c</span>(a,b)</span></code></pre></div>
<p>Where</p>
<ul>
<li><span class="math inline">\(a\)</span> is average morning wait time</li>
<li><span class="math inline">\(b\)</span> is average difference in wait time between morning and afternoon</li>
<li>we have the standard deviations in the intercepts and slopes</li>
<li><span class="math inline">\(\rho\)</span> is correlation between intercepts and slopes</li>
<li><span class="math inline">\(\mu\)</span> is the vector of means</li>
</ul>
<p>We could build the variance covariance matrix directly it should look like this:</p>
<p><span class="math display">\[
\begin{pmatrix}
\sigma_\alpha^2 &amp; \sigma_\alpha \sigma_\beta \rho \\
\sigma_\alpha \sigma_\beta \rho &amp; \sigma_\beta^2 
\end{pmatrix}
\]</span></p>
<p>Instead we decompose it, in a way that treats the standard deviations and correlations separately, because this will become useful in setting priors</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="covariance.html#cb250-1" aria-hidden="true" tabindex="-1"></a>sigmas <span class="ot">&lt;-</span> <span class="fu">c</span>(sigma_a,sigma_b)  </span>
<span id="cb250-2"><a href="covariance.html#cb250-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-3"><a href="covariance.html#cb250-3" aria-hidden="true" tabindex="-1"></a>Rho <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="fu">c</span>(<span class="dv">1</span>,rho,rho,<span class="dv">1</span>) , <span class="at">nrow=</span><span class="dv">2</span> ) </span>
<span id="cb250-4"><a href="covariance.html#cb250-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-5"><a href="covariance.html#cb250-5" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(sigmas) <span class="sc">%*%</span> Rho <span class="sc">%*%</span> <span class="fu">diag</span>(sigmas)</span></code></pre></div>
<p>i.e.</p>
<p><span class="math display">\[
\begin{pmatrix}
\sigma_\alpha^2 &amp; \sigma_\alpha \sigma_\beta \rho \\
\sigma_\alpha \sigma_\beta \rho &amp; \sigma_\beta^2 
\end{pmatrix}
=
\begin{pmatrix}
\sigma_\alpha &amp; 0 \\
0 &amp; \sigma_\beta 
\end{pmatrix}
\begin{pmatrix}
1 &amp;  \rho \\
 \rho &amp; 1 
\end{pmatrix}
\begin{pmatrix}
\sigma_\alpha &amp; 0 \\
0 &amp; \sigma_\beta 
\end{pmatrix}
\]</span></p>
<p>That’s the setup, here’s the simulation part, with a plot of the data, that shows how the intercepts and slopes covary.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="covariance.html#cb251-1" aria-hidden="true" tabindex="-1"></a>N_cafes <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb251-2"><a href="covariance.html#cb251-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-3"><a href="covariance.html#cb251-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb251-4"><a href="covariance.html#cb251-4" aria-hidden="true" tabindex="-1"></a>vary_effects <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">mvrnorm</span>(N_cafes, Mu, Sigma))<span class="sc">%&gt;%</span></span>
<span id="cb251-5"><a href="covariance.html#cb251-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">intercepts =</span> V1, <span class="at">slopes =</span> V2)</span>
<span id="cb251-6"><a href="covariance.html#cb251-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-7"><a href="covariance.html#cb251-7" aria-hidden="true" tabindex="-1"></a>vary_effects <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(<span class="at">cafe =</span> <span class="dv">1</span><span class="sc">:</span>N_cafes,vary_effects)</span>
<span id="cb251-8"><a href="covariance.html#cb251-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-9"><a href="covariance.html#cb251-9" aria-hidden="true" tabindex="-1"></a>plot_cafe_data <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> vary_effects, <span class="fu">aes</span>(<span class="at">x =</span> intercepts, <span class="at">y =</span> slopes))<span class="sc">+</span></span>
<span id="cb251-10"><a href="covariance.html#cb251-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>)</span>
<span id="cb251-11"><a href="covariance.html#cb251-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-12"><a href="covariance.html#cb251-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (l <span class="cf">in</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.3</span>,<span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="fl">0.99</span>)){</span>
<span id="cb251-13"><a href="covariance.html#cb251-13" aria-hidden="true" tabindex="-1"></a>  plot_cafe_data <span class="ot">&lt;-</span> plot_cafe_data <span class="sc">+</span> </span>
<span id="cb251-14"><a href="covariance.html#cb251-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_ellipse</span>(<span class="at">type =</span> <span class="st">&quot;norm&quot;</span>,<span class="at">level =</span> l)}</span>
<span id="cb251-15"><a href="covariance.html#cb251-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-16"><a href="covariance.html#cb251-16" aria-hidden="true" tabindex="-1"></a>plot_cafe_data</span></code></pre></div>
<p><img src="14-covariance_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Each point is a cafe.</p>
<p>We now simulate 10 visits to each cafe:</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="covariance.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">22</span>) </span>
<span id="cb252-2"><a href="covariance.html#cb252-2" aria-hidden="true" tabindex="-1"></a>data_cafe <span class="ot">&lt;-</span> <span class="fu">tibble</span>( <span class="at">cafe=</span> <span class="fu">rep</span>( <span class="dv">1</span><span class="sc">:</span>N_cafes , <span class="at">each=</span><span class="dv">10</span> ), </span>
<span id="cb252-3"><a href="covariance.html#cb252-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">afternoon=</span><span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,<span class="dv">10</span><span class="sc">*</span>N_cafes<span class="sc">/</span><span class="dv">2</span>))<span class="sc">%&gt;%</span></span>
<span id="cb252-4"><a href="covariance.html#cb252-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(vary_effects, <span class="at">by =</span> <span class="st">&quot;cafe&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb252-5"><a href="covariance.html#cb252-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wait =</span> <span class="fu">rnorm</span>(<span class="dv">200</span>,<span class="at">mean  =</span> intercepts <span class="sc">+</span> slopes <span class="sc">*</span> afternoon , <span class="at">sd =</span> <span class="fl">0.5</span> ))</span></code></pre></div>
<p>Now we fit a model to see if we can get back the data generating process. The model looks like this:</p>
<p><span class="math display">\[
\begin{aligned}
W_i &amp;\sim \text{Normal}(\mu_i, \sigma) \\
\mu_i &amp;= \alpha_{\text{CAFE}[i]} + \beta_{\text{CAFE}[i]}A_i \\
\\
\begin{bmatrix}
\alpha_{\text{CAFE}[i]} \\
\beta_{\text{CAFE}[i]}
\end{bmatrix}
&amp;\sim \text{MVNormal}\left( 
\begin{bmatrix}
\alpha \\
\beta
\end{bmatrix}
, S
\right) &amp;&amp; \text{population of varying effects}\\
\\
S &amp;= \begin{pmatrix}
\sigma_\alpha &amp; 0  \\
 0 &amp; \sigma_\beta
\end{pmatrix}
R
\begin{pmatrix}
\sigma_\alpha &amp; 0  \\
 0 &amp; \sigma_\beta
\end{pmatrix} &amp;&amp; \text{construct covariance matrix} \\
\\
\alpha &amp;\sim \text{Normal}(5,2) &amp;&amp; \text{prior for average intercept}\\
\beta &amp;\sim \text{Normal}(-1,0.5) &amp;&amp; \text{prior for average slope} \\
\sigma &amp;\sim \text{Exponential}(1) &amp;&amp; \text{prior std dev within cafes} \\
\sigma_\alpha &amp;\sim \text{Exponential}(1) &amp;&amp; \text{prior std dev among intercepts}\\
\sigma_\beta &amp;\sim \text{Exponential}(1) &amp;&amp; \text{prior std dev among slopes}\\
R &amp;\sim \text{LKJcorr}(2) &amp;&amp; \text{prior for correlation matrix}
\end{aligned}
\]</span></p>
<p>After running, we plot the posterior correlation between intercepts and slopes. In our simulation data, there is a negative correlation: busy cafes have larger differences in wait times between morning and afternoon. Our model reflects this:</p>
<p><img src="14-covariance_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<blockquote>
<p>Revisit: The book includes a section on constructing a model with more than two varying effects, using the chimp example. This section is especially useful because it demonstrates a non-centered parameterisation for this kinds of model using Cholesky decomposition.</p>
</blockquote>
</div>
<div id="instruments-and-causal-designs" class="section level3 unnumbered">
<h3>Instruments and Causal Designs</h3>
<p>We return to the problem of estimating the effect of education on wages. We expect there to be some unobserved factors that may confound inference:</p>
<p><img src="14-covariance_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>We can’t close the backdoor path, because we have not observed U. But we might be able to use an <em>instrumental variable</em> to make inferences. An instrumental variable <span class="math inline">\(Q\)</span> must be:</p>
<ol style="list-style-type: decimal">
<li>Independent of U</li>
<li>Not independent of E</li>
<li>Q must have no influence on W except through E</li>
</ol>
<p>The book notes that 1 and 3 in particular, are not testable, and can be strong assumptions.</p>
<p>Assuming we have an instrumental variable, our DAG now looks like:</p>
<p><img src="14-covariance_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>How do we use <span class="math inline">\(Q\)</span>. The book suggesting thinking of Q in this example as the quarter of the year a person is born in, which has an influence on how much education a person receives. The chapter simulates some data:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="covariance.html#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">73</span>) </span>
<span id="cb253-2"><a href="covariance.html#cb253-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">500</span> </span>
<span id="cb253-3"><a href="covariance.html#cb253-3" aria-hidden="true" tabindex="-1"></a>U_sim <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( N ) </span>
<span id="cb253-4"><a href="covariance.html#cb253-4" aria-hidden="true" tabindex="-1"></a>Q_sim <span class="ot">&lt;-</span> <span class="fu">sample</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span> , <span class="at">size=</span>N , <span class="at">replace=</span><span class="cn">TRUE</span> ) </span>
<span id="cb253-5"><a href="covariance.html#cb253-5" aria-hidden="true" tabindex="-1"></a>E_sim <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( N , U_sim <span class="sc">+</span> Q_sim ) </span>
<span id="cb253-6"><a href="covariance.html#cb253-6" aria-hidden="true" tabindex="-1"></a>W_sim <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( N , U_sim <span class="sc">+</span> <span class="dv">0</span><span class="sc">*</span>E_sim ) </span>
<span id="cb253-7"><a href="covariance.html#cb253-7" aria-hidden="true" tabindex="-1"></a>data_edu_sim <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">W=</span><span class="fu">standardize</span>(W_sim) , </span>
<span id="cb253-8"><a href="covariance.html#cb253-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">E=</span><span class="fu">standardize</span>(E_sim) ,</span>
<span id="cb253-9"><a href="covariance.html#cb253-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">Q=</span><span class="fu">standardize</span>(Q_sim) )</span></code></pre></div>
<p>You can see that in the simulated data, education has no causal effect on wages. The first model attempted is a straightforward regression of wages on education:</p>
<p><span class="math display">\[
\begin{aligned}
W &amp;\sim N(\mu_i, \sigma)\\
\mu_i &amp;= \alpha_W + \beta_{EW}E\\
\alpha_W &amp;\sim N(0,0.2)\\
\beta_{EW} &amp;\sim N(0,0.5)\\
\sigma &amp;\sim \text{Exp}(1)
\end{aligned}
\]</span></p>
<p>The model believes that education leads to higher wages (you can see that <span class="math inline">\(b_{EW}\)</span> is very far from 0):</p>
<pre><code>##               mean         sd       5.5%     94.5%    n_eff     Rhat4
## aW    -0.001419763 0.04103712 -0.0668210 0.0614210 2058.644 0.9999916
## bEW    0.397312055 0.04067676  0.3330058 0.4587898 1922.806 1.0005218
## sigma  0.918514205 0.02924823  0.8724036 0.9659672 1900.922 1.0034956</code></pre>
<p>Next we add <span class="math inline">\(Q\)</span> as a predictor:</p>
<p><span class="math display">\[
\begin{aligned}
W &amp;\sim N(\mu_i, \sigma)\\
\mu_i &amp;= \alpha_W + \beta_{EW}E + \beta_{QW}Q\\
\alpha_W &amp;\sim N(0,0.2)\\
\beta_{EW} &amp;\sim N(0,0.5)\\
\beta_{QW} &amp;\sim N(0,0.5)\\
\sigma &amp;\sim \text{Exp}(1)
\end{aligned}
\]</span></p>
<p>And the results are worse:</p>
<pre><code>##                mean         sd        5.5%       94.5%    n_eff     Rhat4
## aW    -0.0002878362 0.03732442 -0.05972346  0.05953473 1940.322 0.9988731
## bEW    0.6355551170 0.04867284  0.55926847  0.71532664 1195.392 1.0002084
## bQW   -0.4058662475 0.04678752 -0.47877007 -0.33126016 1205.308 0.9991839
## sigma  0.8575132195 0.02795544  0.81467929  0.90481446 1552.985 1.0008698</code></pre>
<p>The estimated effect of education on wages is even larger, and the model also thinks that <span class="math inline">\(Q\)</span> is correlated with wages even when <span class="math inline">\(E\)</span> is included in the model. We know from the simulation that <span class="math inline">\(Q\)</span> has no effect on wages except through E; the error comes from the fact that E is a collider of <span class="math inline">\(Q\)</span> and <span class="math inline">\(U\)</span>.</p>
<p>The chapter goes on to describe how <span class="math inline">\(Q\)</span> should be used, starting by writing the generative version of the model (assuming the DAG).</p>
<p>According to the DAG, wages are a function of education, and our unobserved confound:</p>
<p><span class="math display">\[
\begin{aligned}
W_i &amp;\sim N(\mu_{W,i},\sigma_W)\\
\mu_{W,i} &amp;= \alpha_W + \beta_{EW}E_i + U_i
\end{aligned}
\]</span>
Education is a function of quarter of birth and the unobserved confound:</p>
<p><span class="math display">\[
\begin{aligned}
E_i &amp;\sim N(\mu_{E,i},\sigma_E)\\
\mu_{E,i} &amp;= \alpha_E + \beta_{QE}Q_i + U_i
\end{aligned}
\]</span>
We assume even numbers of people born in each quarter:</p>
<p><span class="math display">\[
Q \sim \text{Categorical}([0.25,0.25,0.25,0.25])
\]</span>
For now we assume U is normally distributed with mean 0 and standard deviation 1:</p>
<p><span class="math display">\[
U_i \sim N(0,1)
\]</span></p>
<p>In order to create a statistical model out of all of this, we use a <em>multivariate linear model</em>:</p>
<p><span class="math display">\[
\begin{aligned}
\begin{pmatrix} W_i \\ E_i \end{pmatrix} &amp;\sim \text{MVNormal}(\begin{pmatrix} \mu_{W,i} \\ \mu_{E,i} \end{pmatrix},S)\\
\mu_{W,i} &amp;= \alpha_W + \beta_{EW}E_i \\
\mu_{E,i} &amp;= \alpha_E + \beta_{QE}Q_i
\end{aligned}
\]</span>
What’s happening here is that wages and education are both simultaneously outcomes of our regression. The <span class="math inline">\(S\)</span> here is analogous to <span class="math inline">\(\sigma\)</span> in the above simple linear regressions - it’s meant to capture residual correlations between pairs of <span class="math inline">\(W\)</span> and <span class="math inline">\(E\)</span> (e.g. from the action of our unobserved confound).</p>
<p>Here are the results:</p>
<pre><code>##                   mean         sd        5.5%      94.5%     n_eff     Rhat4
## aE        0.0008915069 0.03433353 -0.05523862 0.05541958 1480.0990 0.9996156
## aW        0.0006545851 0.04377868 -0.07079820 0.07273627 1401.6666 1.0010062
## bQE       0.5891858335 0.03498143  0.53501613 0.64443475 1411.4764 0.9993527
## bEW      -0.0463663122 0.07308362 -0.16794360 0.06406582  777.4085 1.0020241
## Rho[1,1]  1.0000000000 0.00000000  1.00000000 1.00000000       NaN       NaN
## Rho[1,2]  0.5402627720 0.05073347  0.45610957 0.62018750  750.5671 1.0018643
## Rho[2,1]  0.5402627720 0.05073347  0.45610957 0.62018750  750.5671 1.0018643
## Rho[2,2]  1.0000000000 0.00000000  1.00000000 1.00000000       NaN       NaN
## Sigma[1]  1.0241176895 0.04590810  0.95699685 1.10006935  767.6010 1.0025145
## Sigma[2]  0.8085983475 0.02547070  0.76929886 0.85086392 1633.9111 1.0003105</code></pre>
<p>The model now correctly believes that the causal effect of education on wages is close to zero. The residual correlation between wages and education, <span class="math inline">\(\rho_{1,2}\)</span>, is positive, which reflects the influence of <span class="math inline">\(U\)</span>.</p>
<p>Endnotes 208 and 209 point to some real-world attempts to use instrumental variables for inference.</p>
<p>Revisit: The chapter includes a short discussion of the front-door criterion, which I first read about in Judea Pearl’s <em>Book of Why</em>. Then there is a second example that uses a custom covariance matrix. This time to make inferences about social relations in a community in Nicaragua.</p>
</div>
<div id="continuous-categories-and-the-gaussian-process" class="section level3 unnumbered">
<h3>Continuous Categories and the Gaussian Process</h3>
<p>The challenge of this section is to extend our application of varying effects from unordered categories to continuous variables. To do this the chapter introduces <em>Gaussian process regression</em>. The chapter returns to the chapter 11 data set of tool use in historic Oceanic societies, this time adding a measure of geographic distance to the model.</p>
<pre><code>##             Ml  Ti  SC  Ya  Fi  Tr  Ch  Mn  To  Ha
## Malekula   0.0 0.5 0.6 4.4 1.2 2.0 3.2 2.8 1.9 5.7
## Tikopia    0.5 0.0 0.3 4.2 1.2 2.0 2.9 2.7 2.0 5.3
## Santa Cruz 0.6 0.3 0.0 3.9 1.6 1.7 2.6 2.4 2.3 5.4
## Yap        4.4 4.2 3.9 0.0 5.4 2.5 1.6 1.6 6.1 7.2
## Lau Fiji   1.2 1.2 1.6 5.4 0.0 3.2 4.0 3.9 0.8 4.9
## Trobriand  2.0 2.0 1.7 2.5 3.2 0.0 1.8 0.8 3.9 6.7
## Chuuk      3.2 2.9 2.6 1.6 4.0 1.8 0.0 1.2 4.8 5.8
## Manus      2.8 2.7 2.4 1.6 3.9 0.8 1.2 0.0 4.6 6.7
## Tonga      1.9 2.0 2.3 6.1 0.8 3.9 4.8 4.6 0.0 5.0
## Hawaii     5.7 5.3 5.4 7.2 4.9 6.7 5.8 6.7 5.0 0.0</code></pre>
<p>Here’s the model we’ll be using:</p>
<p><span class="math display">\[
\begin{aligned}
T_i &amp;\sim \text{Poisson}(\lambda_i) \\
\lambda_i &amp;= \exp(k_{\text{SOC}[i]}) \alpha P_i^\beta / \gamma\\
\\
\begin{pmatrix}
k_1 \\
k_2 \\
k_3 \\
\dots \\
k_{10}
\end{pmatrix}
&amp;\sim \text{MVNormal}\left( 
\begin{pmatrix}
0 \\
0 \\
0 \\
\dots \\
0
\end{pmatrix}
, K
\right) &amp;&amp; \text{prior for intercepts}\\
\\
K_{ij} &amp;= \eta^2 \exp(-\rho^2D^2_{ij}) + \delta_{ij}\sigma^2 &amp;&amp; \text{covariance matrix}
\end{aligned}
\]</span>
Here the <span class="math inline">\(\lambda_i\)</span> term is the model from chapter 11 with an additional term for varying intercept <span class="math inline">\(k_{\text{SOC}[i]}\)</span>. Negative values of <span class="math inline">\(k_\text{SOC[i]}\)</span> will reduce <span class="math inline">\(\lambda\)</span>, and positive values will increase it.</p>
<p>Why are the entries of the covariance matrix defined like that?</p>
<ul>
<li>The <span class="math inline">\(\exp(-\rho^2D^2_{ij})\)</span> term means that covariance between societies <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> declines exponentially with the square of the distance between them. The exact rate is controlled by <span class="math inline">\(\rho\)</span>.</li>
<li><span class="math inline">\(\eta^2\)</span> is the maximum covariance between any two societies.</li>
<li>In the <span class="math inline">\(\delta_{ij}\sigma^2\)</span> term, <span class="math inline">\(\delta_{ij}\)</span> is the Kronecker delta. This term would be used if we had more than one observation for society and wanted to allow for additional covariance when <span class="math inline">\(i=j\)</span>.</li>
</ul>
<p>Here are the parameter results:</p>
<pre><code>##               mean         sd        5.5%      94.5%     n_eff    Rhat4
## k[1]  -0.148402659 0.30998543 -0.63955874 0.33646864  709.9680 1.005093
## k[2]   0.002684859 0.30056597 -0.45053691 0.49759916  633.2755 1.004251
## k[3]  -0.050550296 0.28174896 -0.47895698 0.40597849  598.4924 1.004261
## k[4]   0.366865490 0.26729507 -0.02193611 0.81699311  657.3474 1.005273
## k[5]   0.094786551 0.26006232 -0.28204444 0.53608437  697.9420 1.002621
## k[6]  -0.360295041 0.27160317 -0.80016738 0.03490379  818.9144 1.003139
## k[7]   0.157534273 0.25409633 -0.20737781 0.56643565  678.2727 1.003498
## k[8]  -0.192210414 0.25940191 -0.58630755 0.22291150  748.3814 1.003753
## k[9]   0.277474804 0.24967771 -0.08590088 0.69005578  705.6751 1.003134
## k[10] -0.150614677 0.34512273 -0.70713486 0.39019117 1112.6261 1.000693
## g      0.602461754 0.57198391  0.07419879 1.71741660 1607.5003 1.003247
## b      0.278706970 0.08672352  0.14322593 0.42380396 1306.5750 1.002605
## a      1.390190386 1.10746784  0.21896477 3.40762055 2166.0644 1.000575
## etasq  0.193184148 0.20287420  0.02551770 0.55632958  989.9122 1.001779
## rhosq  1.387124588 1.72623165  0.08278087 4.67127800 1864.7903 1.001385</code></pre>
<p>These are a little difficult to interpret, but we can plot the Gaussian process function to get a sense of how the model expects covariance to change with increasing distance:</p>
<p><img src="14-covariance_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>I’ve drawn 250 lines for each plot. The bold line in the right hand plot is the posterior mean. Because each society is assigned a parameter, and the model includes a covariance matrix, we can also make inferences about which societies are correlated. The chapter produces a matrix of correlations and plots them.</p>
<p>Revisit: The chapter closes with a fun rundown of phylogenetic regression. Here we use Gaussian processes in a model that includes phylogenetic distance, as opposed to physical distance.</p>
</div>
</div>
<div id="questions-13" class="section level2" number="14.2">
<h2><span class="header-section-number">14.2</span> Questions</h2>
<div id="e1-11" class="section level3 unnumbered">
<h3>14E1</h3>
<div id="question-100" class="section level4 unnumbered">
<h4>Question</h4>
</div>
<div id="answer-100" class="section level4 unnumbered">
<h4>Answer</h4>
</div>
</div>
</div>
<div id="further-resources-4" class="section level2 unnumbered">
<h2>Further Resources</h2>
<p>Endnote 204 lists a handful of resources for non-centered parameterisation:</p>
<ul>
<li>Model determination using sampling-based methods - Gelfand (1996)</li>
<li>Updating schemes, correlation structure, blocking and parameterisation for the Gibbs sampler - Roberts and Sahu (1997)</li>
<li>A general framework for the parametrization of hierarchical models - Papaspiliopoulos et al. (2007)</li>
<li>Hamiltonian Monte Carlo for hierarchical models - Betancourt and Girolami (2013)</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="models_memory.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="missing_data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/14-covariance.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
